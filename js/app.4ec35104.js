(function(e){function t(t){for(var i,s,o=t[0],l=t[1],c=t[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&d.push(n[s][0]),n[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=a[0]))}return e}var i={},n={app:0},r=[];function s(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=i,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;r.push([1,"chunk-vendors"]),a()})({0:function(e,t){},"0386":function(e,t,a){e.exports=a.p+"img/darkmode.a447d0e4.jpg"},"0554":function(e,t,a){"use strict";a.r(t),t["default"]="#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nuniform float currentTime;\nvarying float vPercentComplete;\n\nvoid main(void) {\n\n  if (vPercentComplete == -1.0) discard;\n\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  // gl_FragColor = picking_filterPickingColor(gl_FragColor)\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"},"0c3c":function(e,t,a){"use strict";a("3600")},"0f40":function(e,t,a){},1:function(e,t,a){e.exports=a("cd49")},"11f4":function(e,t,a){},"12fd":function(e,t,a){},1751:function(e,t,a){},"18ab":function(e,t,a){},"1bf3":function(e,t,a){},"1ce1":function(e,t,a){e.exports=a.p+"img/thumb-v6.4c765466.png"},2:function(e,t){},2012:function(e,t,a){"use strict";a("3302")},"23ef":function(e,t,a){},"2af4":function(e,t,a){},3:function(e,t){},"301c":function(e,t,a){e.exports=a.p+"img/banner.98b1b57a.jpg"},3302:function(e,t,a){},3352:function(e,t,a){"use strict";a("23ef")},3432:function(e,t,a){"use strict";a("cf49")},"358c":function(e,t,a){"use strict";a("6fb9")},3600:function(e,t,a){},"36f6":function(e,t,a){e.exports=a.p+"img/geosimlab-logo.495d709a.webp"},"37d7":function(e,t,a){},"39e4":function(e,t,a){},"3b17":function(e,t,a){"use strict";a("1751")},"3bd2":function(e,t,a){},"44bf":function(e,t,a){"use strict";a("a40e")},"469e":function(e,t,a){},"4e04":function(e,t,a){},"50da":function(e,t,a){},"553b":function(e,t,a){},"55b3":function(e,t,a){},"566a":function(e,t,a){e.exports=function(){return new Worker(a.p+"98d14dad7c9a79e58e1a.worker.js")}},"57a3":function(e,t){var a="<p>AVÖV - Räumlich und zeitlich hochauflösende Evaluation und Optimierung automatisierter und vernetzter Bedienkonzepte im öffentlichen Verkehr</p> ";e.exports=a},"57cf":function(e,t,a){},5837:function(e,t){var a='<p>Tel Aviv University, Department of Geography and Human Environment <br> Porter School of Environment and Earth Sciences, Faculty of Exact Sciences</p> <p>More information about the project: <a href="https://geosimlab.org">https://geosimlab.org</a></p> <p>Partner: Jerusalem municipality, Transportation Planning Department</p> ';e.exports=a},"5c0b":function(e,t,a){"use strict";a("9c0c")},"64f3":function(e,t,a){},"655d":function(e,t,a){"use strict";a("50da")},"677a":function(e,t,a){"use strict";a("469e")},"67eb":function(e,t,a){},"69bd":function(e,t,a){"use strict";a("67eb")},"6b0c":function(e,t,a){e.exports=function(){return new Worker(a.p+"c21c593d2461a8db0eb9.worker.js")}},"6bc8":function(e,t,a){"use strict";a("4e04")},"6fb9":function(e,t,a){},"6ff4":function(e,t,a){},"74c5":function(e,t,a){"use strict";a("6ff4")},7710:function(e,t,a){},"78a4":function(e,t,a){"use strict";a("aa63")},7995:function(e,t,a){},"80bd":function(e,t,a){"use strict";a("57cf")},"818f":function(e,t,a){var i=a("4719"),n=a("301c"),r=a("a7f5"),s=a("b944"),o=i(n),l=i(r),c=i(s),u='<img src="'+o+'"> <p>Website and visulations built using <a href="https://vuejs.org">Vue</a> and <a href="https://threejs.org">Three.js</a>.</p> <hr> <img src="'+l+'" width="40%"> <br/> <br/> <img src="'+c+'" width="40%"> <br/> <br/> <br/> <br/> ';e.exports=u},8237:function(e,t,a){e.exports=a.p+"img/tau-logo.9ef9279e.png"},"83c7":function(e,t,a){"use strict";a("d429")},"85e2":function(e,t,a){e.exports=a.p+"img/v3-thumb.507b4f45.png"},8739:function(e,t,a){"use strict";a("f759")},8838:function(e,t,a){"use strict";a("0f40")},"88f6":function(e,t,a){"use strict";a("e6e2")},"90da":function(e,t,a){"use strict";a("9bba")},"920e":function(e,t,a){"use strict";a("18ab")},"986a":function(e,t,a){"use strict";a("3bd2")},"9bba":function(e,t,a){},"9c0c":function(e,t,a){},"9deb":function(e,t,a){"use strict";a("c1b3")},a278:function(e,t,a){"use strict";a.r(t),t["default"]="// fragment shader: pixel colors\nuniform float simulationTime;\n\n// passed in from vertex shader:\nvarying float skip;\nvarying float atRest;\n\nvec4 getColor() {\n\n    if (atRest == 1.0) {\n        return vec4(0.0, 0.5, 0.2, 1.0);\n    }\n\n    return vec4(1.0, 1.0, 0.5, 1.0);\n}\n\n\nvoid main() {\n    // don't do anything if this trip is currently out of time bounds\n    if (skip == 1.0) {\n\n        gl_FragColor = vec4(0,0,0,0);\n\n    } else {\n\n        gl_FragColor = getColor();\n\n    }\n}\n"},a40e:function(e,t,a){},a6cb:function(e,t,a){"use strict";a("37d7")},a722:function(e,t,a){"use strict";a("11f4")},a7f5:function(e,t,a){e.exports=a.p+"img/matsim-logo-blue.33e6b1c3.png"},aa63:function(e,t,a){},acace:function(e,t,a){"use strict";a("ef1a")},b944:function(e,t,a){e.exports=a.p+"img/tu-logo.e3c4ff96.png"},bdf3:function(e,t,a){"use strict";a("7710")},c1b3:function(e,t,a){},c450:function(e,t){},cd49:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i,n,r,s=a("2b0e"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{"full-page-app":e.state.isFullScreen},attrs:{id:"app"}},[a("div",{attrs:{id:"nav"}},[e.state.breadcrumbs.length>0?a("div",{staticClass:"breadcrumbs-bar",style:{paddingLeft:e.state.isFullScreen?"0.75rem":""}},[a("nav",{staticClass:"breadcrumb",attrs:{"aria-label":"breadcrumbs"}},[a("ul",e._l(e.state.breadcrumbs,(function(t,i){return a("li",{key:t.label+t.url,on:{click:[function(a){return e.clickedLink(t.url)},function(a){return a.ctrlKey?e.openNewTab(t.url):null},function(a){return a.metaKey?e.openNewTab(t.url):null}],mouseup:function(a){return"button"in a&&1!==a.button?null:e.openNewTab(t.url)}}},[a("p",[e._v(e._s(t.label))])])})),0)])]):e._e()]),a("div",{staticClass:"center-area nav-padding"},[a("login-panel",{staticClass:"login-panel"}),a("router-view",{staticClass:"main-content"})],1),e.state.isFullScreen?e._e():a("div",{staticClass:"footer"},[a("p",[e._v("Jerusalem project © 2020 Geosimulation and Spatial Analysis Lab.")]),e._m(0)])])},l=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[e._v("More info about Geosimlab:"),a("a",{attrs:{href:"https://www.geosimlab.org"}},[e._v(" https://www.geosimlab.org")])])}],c=a("1da1"),u=a("d4ec"),h=a("bee2"),d=a("262e"),m=a("2caf"),p=(a("96cf"),a("9ab4")),f=a("e192"),v=a.n(f),b=a("60a3"),g=(a("4ec9"),a("d3b7"),a("3ca3"),a("ddb0"),a("99af"),a("2f62"));(function(e){e[e["INFO"]=0]="INFO",e[e["WARNING"]=1]="WARNING"})(i||(i={})),function(e){e["LightMode"]="light",e["DarkMode"]="dark"}(n||(n={})),function(e){e["Susceptible"]="susceptible",e["InfectedButNotContagious"]="infectedButNotContagious",e["Contagious"]="contagious"}(r||(r={}));var y,S={text:"#000",background:"#ccccc4",links:"#ffffff",susceptible:"#999900",infectedButNotContagious:"#0077ff",contagious:"#bb0044",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#000",recovered:"#116622"},k={text:"#fff",background:"#181518",links:"#445577",susceptible:"#bbbb44",infectedButNotContagious:"#00dddd",contagious:"#ff2299",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#fff",recovered:"#116622"},j={light:"mapbox://styles/mapbox/light-v10",dark:"mapbox://styles/grauwelf/ck5wauof50m0y1iogrdjoavsn"};(function(e){e[e["line"]=0]="line",e[e["box"]=1]="box"})(y||(y={}));var O={projects:[{name:"Jerusalem SAV",url:"jlm-drt",description:"Multimodal transportation system of Jerusalem",svn:"https://grauwelf.github.io/geosimlab-drt-data",need_password:!1,thumbnail:"/motus-viz/thumb-jerusalem.jpg"}]},w=O;s["default"].use(g["a"]);var x=new g["a"].Store({state:{debug:!0,authAttempts:0,breadcrumbs:[],credentials:{fake:"fake"},isFullScreen:!1,needLoginForUrl:"",statusMessage:"loading",svnProjects:w.projects,colorScheme:n.DarkMode,visualizationTypes:new Map},getters:{},mutations:{requestLogin:function(e,t){e.needLoginForUrl=t},registerPlugin:function(e,t){console.log("PLUGIN:",t.kebabName),e.visualizationTypes.set(t.kebabName,t)},setBreadCrumbs:function(e,t){e.breadcrumbs=t},setCredentials:function(e,t){var a=btoa("".concat(t.username,":").concat(t.pw));e.credentials[t.url]=a,e.authAttempts++},setFullScreen:function(e,t){e.isFullScreen=t},setStatus:function(e,t){e.statusMessage=t}},actions:{},modules:{}}),C=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},T=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"colophon-content"}},[i("div",{staticClass:"logo",staticStyle:{width:"100%"}},[i("a",{attrs:{href:"https://tau.ac.il",target:"_blank"}},[i("img",{attrs:{src:a("8237")}})])]),i("div",{staticClass:"team"},[e._v("Geosimlab Head")]),i("p",[e._v("Itzhak Benenson, Prof")]),i("div",{staticClass:"team"},[e._v("Geosimlab Team")]),i("p",[e._v("Aleksey Ogulenko, Dr")]),i("p",[e._v("Ido Klein, Dr")]),i("p",[e._v("Golan Ben-Dor")]),i("div",{staticClass:"team"},[e._v("Contact")]),i("p",{staticClass:"nonbreak"},[i("a",{attrs:{href:"mailto:bennya@tauex.tau.ac.il"}},[e._v("Email")])]),i("div",{staticClass:"team"},[e._v("More information")]),i("p",{staticClass:"nonbreak"},[i("a",{attrs:{href:"https://geosimlab.org",target:"_blank"}},[e._v("Geosimlab")])]),i("div",{staticClass:"team"},[e._v("Partners")]),i("div",{staticClass:"partners"},[i("p",[i("a",{attrs:{href:"https://www.jerusalem.muni.il/",target:"_blank"}},[e._v("Jerusalem municipality")])])]),i("div",{staticClass:"team"},[e._v("Credits")]),i("div",{staticClass:"partners"},[i("p",[e._v("This website is based on the interactive visualization for project")]),i("p",[i("a",{attrs:{href:"https://avoev-vsp.github.io",target:"_blank"}},[e._v("AVÖV/AVOEV ")])])])])}],_={name:"Colophon",components:{}},R=_,E=(a("78a4"),a("2877")),D=Object(E["a"])(R,C,T,!1,null,"a72b5be4",null),F=D.exports,A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sidebar-page"},[i("section",{staticClass:"sidebar-layout"},[i("b-sidebar",{attrs:{type:"is-light",fullheight:e.fullheight,fullwidth:e.fullwidth,overlay:e.overlay,right:e.right,open:e.open},on:{"update:open":function(t){e.open=t}}},[i("div",{staticClass:"all-stuff"},[i("div",{staticClass:"block"},[i("a",{attrs:{href:"/"}},[i("img",{staticClass:"vsp-logo",attrs:{src:a("e046"),alt:"TU Berlin VSP Department"}})])]),i("b-menu-list",{attrs:{label:"Login Required"}}),i("p",{staticClass:"my-label"},[e._v(e._s(e.whichLogin)+": access to this site requires a login.")]),i("b-menu-list",{attrs:{label:"Username"}}),i("b-input",{attrs:{placeholder:"VSP username",maxlength:"30"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),i("b-menu-list",{attrs:{label:"Password"}}),i("b-input",{attrs:{type:"password","password-reveal":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),i("b-button",{staticClass:"my-space is-primary",attrs:{disabled:!e.username||!e.password},on:{click:e.clickedLogin}},[e._v("Login")])],1)])],1)])},L=[],P=(a("4de4"),a("b0c0"),function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.username="",e.password="",e.expandOnHover=!0,e.fullheight=!0,e.fullwidth=!1,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.right=!1,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e.open=!1,e}return Object(h["a"])(a,[{key:"showLoginPanel",value:function(){this.open=""!==this.globalState.needLoginForUrl}},{key:"panelMayBeClosing",value:function(){this.open||x.commit("requestLogin","")}},{key:"whichLogin",get:function(){var e=this;try{var t=this.globalState.svnProjects.filter((function(t){return t.url===e.globalState.needLoginForUrl}))[0];return t.name}catch(a){}return"this site"}},{key:"clickedLogin",value:function(){x.commit("setCredentials",{url:this.globalState.needLoginForUrl,username:this.username,pw:this.password}),this.globalState.needLoginForUrl=""}}]),a}(b["c"]));Object(p["a"])([Object(b["d"])("globalState.needLoginForUrl")],P.prototype,"showLoginPanel",null),Object(p["a"])([Object(b["d"])("open")],P.prototype,"panelMayBeClosing",null),P=Object(p["a"])([Object(b["a"])({components:{},props:{}})],P);var M=P,z=M,N=(a("920e"),Object(E["a"])(z,A,L,!1,null,"2682e7c8",null)),I=N.exports,V=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sidebar-page"},[i("section",{staticClass:"sidebar-layout"},[i("b-sidebar",{attrs:{position:"static",mobile:e.mobile,"expand-on-hover":e.expandOnHover,reduce:e.reduce,type:e.theme,open:""}},[i("div",{staticClass:"all-stuff"},[i("div",{staticClass:"block"},[i("a",{attrs:{href:"/"}},[i("img",{staticClass:"vsp-logo",attrs:{src:a("e046"),alt:"TU Berlin VSP Department"}})])]),i("b-menu",{staticClass:"is-custom-mobile"},[i("b-menu-list",{attrs:{label:"Run Browser"}},e._l(e.projects,(function(t){return i("b-menu-item",{key:t.url,attrs:{icon:"folder",label:t.name,active:e.isActive(t)},on:{click:function(a){return e.clickedProject(t)}}})})),1)],1)],1)])],1)])},B=[],H=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.expandOnHover=!0,e.fullheight=!0,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e}return Object(h["a"])(a,[{key:"crumbsChanged",value:function(){}},{key:"isActive",value:function(e){var t=this.globalState.breadcrumbs;return!(t.length<2)&&(console.log(t[1]),console.log({item:e}),t[1].label===e.name)}},{key:"clickedProject",value:function(e){var t="/"+e.url;this.$router.push({path:t})}}]),a}(b["c"]);Object(p["a"])([Object(b["d"])("globalState.breadcrumbs")],H.prototype,"crumbsChanged",null),H=Object(p["a"])([Object(b["a"])({components:{},props:{}})],H);var q=H,Y=q,U=(a("3352"),Object(E["a"])(Y,V,B,!1,null,"d6946bdc",null)),G=U.exports,W=v.a;W.accessToken="pk.eyJ1IjoiZ3JhdXdlbGYiLCJhIjoiY2swem13cDV2MDRqODNtbzRjNHZ1ZnFzcyJ9.NfEs3GesvTdxL3_Wycw6QQ";var $=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.state=x.state,e}return Object(h["a"])(a,[{key:"clickedLink",value:function(e){this.$router.push({path:e})}},{key:"openNewTab",value:function(e){window.open(e,"_blank")}},{key:"toggleFullScreen",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t?(document.body.classList.add("full-screen-page"),document.documentElement.style.overflowY="auto"):(document.body.classList.remove("full-screen-page"),document.documentElement.style.overflowY=null),e.next=3,this.$nextTick();case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),a}(b["c"]);Object(p["a"])([Object(b["d"])("state.isFullScreen")],$.prototype,"toggleFullScreen",null),$=Object(p["a"])([Object(b["a"])({components:{SideNavBar:G,LoginPanel:I,Colophon:F}})],$);var X=$,J=X,Z=(a("5c0b"),Object(E["a"])(J,o,l,!1,null,null,null)),K=Z.exports,Q=a("b85c"),ee=a("8c4f"),te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"home"}},[a("div",{staticClass:"page-area"},[e._m(0),a("div",{staticClass:"content"},[a("div",{staticClass:"main"},[a("h2",[e._v("Select the model :")]),a("svn-projects",{staticClass:"gap"}),a("h2",[e._v("More information")]),a("div",{staticClass:"readme",domProps:{innerHTML:e._s(e.readmeBottom)}})],1)])]),a("colophon",{staticClass:"colophon"})],1)},ae=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"banner"},[i("div",{staticClass:"logo-lab"},[i("img",{attrs:{src:a("36f6")}}),i("div",{staticClass:"logo-text"},[i("h2",[e._v("Multi-Agent Transportation Model of Jerusalem")])])])])}],ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[a("div",{staticClass:"card-image",style:{"background-image":"url("+e.thumbnail+")"}}),a("div",{staticClass:"card-title"},[e._v(e._s(e.viz.title))]),a("div",{staticClass:"card-id"},[a("div",{staticClass:"card-endnotes"},[e._v(e._s(e.vizNumber))])]),a("div",{staticClass:"card-subtitle"},[e._v(e._s(e.viz.subtitle))]),a("div",{staticClass:"card-date"},[e._v(e._s(e.viz.date))])])},ne=[],re=(a("fb6a"),function(e){Object(d["a"])(i,e);var t=Object(m["a"])(i);function i(){return Object(u["a"])(this,i),t.apply(this,arguments)}return Object(h["a"])(i,[{key:"vizNumber",get:function(){return this.viz.url.slice(1)}},{key:"thumbnail",get:function(){if(this.viz.url.indexOf("v3")>-1){var e=a("85e2");return e}if(this.viz.url.indexOf("timelapse")>-1){var t=a("85e2");return t}var i=a("1ce1");return i}}]),i}(b["c"]));Object(p["a"])([Object(b["b"])({required:!0})],re.prototype,"viz",void 0),re=Object(p["a"])([Object(b["a"])({props:{viz:{}}})],re);var se=re,oe=se,le=(a("d469"),Object(E["a"])(oe,ie,ne,!1,null,"7b286f98",null)),ce=le.exports,ue=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"vue-component"}},e._l(e.sources,(function(t){return a("div",{key:t.url,staticClass:"project",on:{click:[function(a){return e.openProjectPage(t)},function(a){return a.metaKey?e.openProjectTab(t):null},function(a){return a.ctrlKey?e.openProjectTab(t):null}],mouseup:function(a){return"button"in a&&1!==a.button?null:e.openProjectTab(t)}}},[a("img",{attrs:{src:t.thumbnail}}),a("div",{staticClass:"desc"},[a("h3",[e._v(e._s(t.name))]),a("p",[e._v(e._s(t.description))])])])})),0)},he=[],de=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.sources=[],e}return Object(h["a"])(a,[{key:"mounted",value:function(){this.sources=x.state.svnProjects}},{key:"openProjectPage",value:function(e){this.$router.push({name:e.url})}},{key:"openProjectTab",value:function(e){window.open(e,"_blank")}}]),a}(b["c"]);de=Object(p["a"])([Object(b["a"])({components:{},props:{}})],de);var me=de,pe=me,fe=(a("69bd"),Object(E["a"])(pe,ue,he,!1,null,"069dede8",null)),ve=fe.exports,be=a("57a3"),ge=a("5837"),ye=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.state=x.state,e.readme=be,e.readmeBottom=ge,e}return Object(h["a"])(a,[{key:"mounted",value:function(){x.commit("setBreadCrumbs",[])}}]),a}(b["c"]);ye=Object(p["a"])([Object(b["a"])({components:{Colophon:F,SvnProjects:ve,VizCard:ce}})],ye);var Se=ye,ke=Se,je=(a("e0fd"),Object(E["a"])(ke,te,ae,!1,null,"f526ad6a",null)),Oe=je.exports,we=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"project-component"}},[e.myState.svnProject?a("div",{staticClass:"project-bar"},[a("div",{staticClass:"details"},[e.globalState.breadcrumbs.length?a("h2",[e._v(e._s(e.globalState.breadcrumbs[e.globalState.breadcrumbs.length-1].label))]):e._e(),a("p",[e._v(e._s(e.myState.svnProject.description))])]),e._m(0)]):e._e(),e.myState.svnProject?a("div",{staticClass:"details"},[e.myState.errorStatus?a("div",{staticClass:"badnews",domProps:{innerHTML:e._s(e.myState.errorStatus)}}):e._e(),a("div",{staticClass:"curated-sections"},[a("div",{staticClass:"readme-header"},[e.myState.readme?a("div",{staticClass:"curate-content markdown",domProps:{innerHTML:e._s(e.myState.readme)}}):e._e()]),e.myState.folders.length>1?a("h3",{staticClass:"curate-heading"},[e._v(" Runs")]):e._e(),e.myState.folders.length>1?a("div",{staticClass:"curate-content"},e._l(e.myState.folders,(function(t){return a("div",{key:t.name,staticClass:"folder",class:{fade:e.myState.isLoading},on:{click:[function(a){return e.openOutputFolder(t,!1)},function(a){return a.metaKey?e.openOutputFolder(t,!0):null},function(a){return a.ctrlKey?e.openOutputFolder(t,!0):null}],mouseup:function(a){return"button"in a&&1!==a.button?null:e.openOutputFolder(t,!0)}}},[a("p",[e._v(e._s(t))])])})),0):e._e(),e.myState.vizes.length?a("h3",{staticClass:"curate-heading"},[e._v("Analysis")]):e._e(),e.myState.vizes.length?a("div",{staticClass:"curate-content"},[a("div",{staticClass:"viz-table"},e._l(e.myState.vizes,(function(t,i){return a("div",{key:t.config,staticClass:"viz-item",on:{click:[function(t){return e.clickedVisualization(i,!1)},function(t){return t.metaKey?e.clickedVisualization(i,!0):null},function(t){return t.ctrlKey?e.clickedVisualization(i,!0):null}],mouseup:function(t){return"button"in t&&1!==t.button?null:e.clickedVisualization(i,!0)}}},[a("div",{staticClass:"viz-frame"},[a("p",[e._v(e._s(t.title))]),a(t.component,{tag:"component",staticClass:"maxheight",style:{"pointer-events":"image-view"===t.component?"auto":"none"},attrs:{yamlConfig:t.config,fileApi:e.myState.svnRoot,subfolder:e.myState.subfolder,thumbnail:!0},on:{title:function(t){return e.updateTitle(i,t)}}})],1)])})),0)]):e._e()])]):e._e()])},xe=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"logo"},[i("img",{attrs:{height:"160",src:a("36f6")}})])}],Ce=(a("1276"),a("ac1f"),a("d81d"),a("2ca0"),a("d4cd")),Te=a.n(Ce),_e=a("d15e"),Re=a("db05"),Ee=a.n(Re),De=a("8f3c"),Fe=a.n(De),Ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app",oncontextmenu:"return false"}},[e.thumbnail?e._e():a("div",{staticClass:"nav"},[a("p",{staticClass:"big xtitle"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?a("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):e._e()]),e.thumbnail?e._e():a("trip-viz",{staticClass:"anim",attrs:{simulationTime:e.simulationTime,paths:e.$options.paths,drtRequests:e.$options.drtRequests,drtRejected:e.$options.drtRejected,traces:e.$options.traces,colors:e.COLOR_OCCUPANCY,settingsShowLayers:e.SETTINGS,center:e.vizDetails.center,searchEnabled:e.searchEnabled,vehicleLookup:e.vehicleLookup,onClick:e.handleClick}}),e.isLoaded&&!e.thumbnail?a("div",{staticClass:"right-side"},[a("collapsible-panel",{attrs:{darkMode:!0,width:"180",direction:"right"}},[a("div",{staticClass:"big clock"},[a("p",[e._v(e._s(e.myState.clock))])]),a("div",{staticClass:"panel-items"},[a("legend-colors",{staticClass:"legend-block",attrs:{title:"Requests:",items:e.legendRequests}}),a("div",{staticClass:"capacity-legend"},[e.legendItems.length?a("legend-colors",{staticClass:"legend-block-left",attrs:{title:"Occupancy:",items:e.legendItems.slice(0,e.MAX_CAPACITY/2+1)}}):e._e(),e.legendItems.length?a("legend-colors",{staticClass:"legend-block-right",attrs:{items:e.legendItems.slice(e.MAX_CAPACITY/2+1,e.MAX_CAPACITY+1)}}):e._e()],1),a("div",{staticClass:"search-panel"},[a("p",{staticClass:"speed-label",style:{margin:"1rem 0 0 0",color:e.textColor.text}},[e._v("Search:")]),a("form",{attrs:{autocomplete:"off"}}),a("div",{staticClass:"field"},[a("p",{staticClass:"control has-icons-left"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],staticClass:"input is-small",attrs:{type:"email",placeholder:"Search..."},domProps:{value:e.searchTerm},on:{input:function(t){t.target.composing||(e.searchTerm=t.target.value)}}}),a("span",{staticClass:"icon is-small is-left"},[a("i",{staticClass:"fas fa-search"})])])])]),a("settings-panel",{staticClass:"settings-area",attrs:{items:e.SETTINGS},on:{click:e.handleSettingChange}}),a("div",{staticClass:"speed-block"},[a("p",{staticClass:"speed-label",style:{color:e.textColor.text}},[e._v("Speed:"),a("br"),e._v(e._s(e.speed)+"x")]),a("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}})],1)],1)])],1):e._e(),a("div",{staticClass:"bottom-area"},[!e.thumbnail&&e.isLoaded?a("playback-controls",{staticClass:"playback-stuff",attrs:{timeStart:e.timeStart,timeEnd:e.timeEnd,isRunning:e.myState.isRunning,currentTime:e.simulationTime},on:{click:e.toggleSimulation,time:e.setTime}}):e._e()],1)],1)},Le=[],Pe=a("2909"),Me=(a("b64b"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("ace4"),a("159b"),a("8a79"),a("4971")),ze=a.n(Me),Ne=a("f206"),Ie=a("89ab"),Ve=a.n(Ie),Be=a("7783"),He=a("b562"),qe=a("f908"),Ye=a("faeb"),Ue=a.n(Ye),Ge=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"outer"},[a("div",{staticClass:"body",style:{order:"left"===e.direction?2:1,maxWidth:e.collapsed?0:e.width+"px"}},[a("div",{staticClass:"content",style:{width:e.width+"px"}},[e._t("default")],2)]),a("div",{staticClass:"xbutton",style:{order:"left"===e.direction?1:2,borderRadius:e.collapsed?"4px":"0px"},on:{click:e.handleClick}},[a("div",{staticClass:"rotate",style:{transform:"rotate("+(e.collapsed?180:360)+"deg)"}},[e._v(e._s("left"===e.direction?"<":">"))])])])},We=[],$e=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.collapsed=void 0!==e.initialCollapsed&&e.initialCollapsed,e}return Object(h["a"])(a,[{key:"handleClick",value:function(){this.collapsed=!this.collapsed}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!0})],$e.prototype,"width",void 0),Object(p["a"])([Object(b["b"])({required:!1})],$e.prototype,"initialCollapsed",void 0),Object(p["a"])([Object(b["b"])({required:!0})],$e.prototype,"direction",void 0),Object(p["a"])([Object(b["b"])({required:!0})],$e.prototype,"darkMode",void 0),$e=Object(p["a"])([b["a"]],$e);var Xe=$e,Je=Xe,Ze=(a("2012"),Object(E["a"])(Je,Ge,We,!1,null,"1b5a96ac",null)),Ke=Ze.exports,Qe=(a("a4d3"),a("e01a"),a("ab5b")),et=a.n(Qe);function tt(e){var t=e.items.map((function(t){return et.a.createElement("li",{key:e.title+t.key},et.a.createElement("div",{style:{width:"100%",height:"".concat(Math.max(1,3*(1*t.value-1)+3),"px"),backgroundColor:"rgb(".concat(t.color,")")}}),t.label&&et.a.createElement("div",{style:{marginBottom:"0.5rem"}},t.label))}));return et.a.createElement("div",null,et.a.createElement("h4",{style:{color:"white",textAlign:"left",fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.8rem"}},e.title),et.a.createElement("p",null,e.description),et.a.createElement("ul",{style:{listStyle:"none",padding:0,margin:0}},t))}var at=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"vue-component"}},[a("div",{staticClass:"buttons"},[a("div",{staticClass:"playpause",on:{click:e.toggleSimulation}},[e.isRunning?a("i",{staticClass:"button-icon fa fa-1x fa-pause"}):a("i",{staticClass:"button-icon fa fa-1x fa-play"})])]),a("vue-slider",e._b({staticClass:"slider",on:{dragging:e.dragging,"drag-start":e.dragStart,"drag-end":e.dragEnd},model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.sliderOptions,!1))],1)},it=[],nt=a("3c87"),rt=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.sliderValue=0,e.sliderOptions={min:0,max:1e6,clickable:!1,dotSize:30,duration:0,lazy:!0,tooltip:"active","tooltip-placement":"top","tooltip-formatter":function(t){return e.convertSecondsToClockTimeMinutes(t)}},e.pauseWhileDragging=!1,e}return Object(h["a"])(a,[{key:"toggleSimulation",value:function(){this.$emit("click")}},{key:"convertSecondsToClockTimeMinutes",value:function(e){var t=this.getSecondsFromSlider(e);try{var a=nt(t),i=("00"+a.minutes).slice(-2);return"".concat(a.hours,":").concat(i)}catch(n){return"00:00"}}},{key:"dragStart",value:function(){this.isRunning&&(this.pauseWhileDragging=!0,this.$emit("click"))}},{key:"dragEnd",value:function(){this.pauseWhileDragging&&this.$emit("click"),this.pauseWhileDragging=!1}},{key:"dragging",value:function(e){this.$emit("time",this.getSecondsFromSlider(e))}},{key:"onKeyPressed",value:function(e){"Space"===e.code&&this.toggleSimulation()}},{key:"getSecondsFromSlider",value:function(e){var t=(this.timeEnd-this.timeStart)*e/1e6;return t===this.timeEnd&&(t=this.timeEnd-1),t}},{key:"handleTimeChanged",value:function(){this.sliderValue=1e6*(this.currentTime-this.timeStart)/(this.timeEnd-this.timeStart)}},{key:"mounted",value:function(){window.addEventListener("keyup",this.onKeyPressed)}},{key:"beforeDestroy",value:function(){window.removeEventListener("keyup",this.onKeyPressed)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!0})],rt.prototype,"isRunning",void 0),Object(p["a"])([Object(b["b"])({required:!0})],rt.prototype,"timeStart",void 0),Object(p["a"])([Object(b["b"])({required:!0})],rt.prototype,"timeEnd",void 0),Object(p["a"])([Object(b["b"])({required:!0})],rt.prototype,"currentTime",void 0),Object(p["a"])([Object(b["d"])("currentTime")],rt.prototype,"handleTimeChanged",null),rt=Object(p["a"])([Object(b["a"])({components:{VueSlider:ze.a},props:{}})],rt);var st=rt,ot=st,lt=(a("ec6c"),Object(E["a"])(ot,at,it,!1,null,"62be466c",null)),ct=lt.exports,ut=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"settings-panel-content"},[a("h4",[e._v("Show / hide")]),e._l(Object.keys(e.items),(function(t){return a("div",{key:t,staticClass:"row"},[a("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.items[t],labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(a){return e.$emit("click",t)}}}),a("label",[e._v(e._s(t))])],1)}))],2)},ht=[],dt=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!0})],dt.prototype,"items",void 0),dt=Object(p["a"])([Object(b["a"])({components:{ToggleButton:Ne["ToggleButton"]}})],dt);var mt=dt,pt=mt,ft=(a("6bc8"),Object(E["a"])(pt,ut,ht,!1,null,"5e73ffb0",null)),vt=ft.exports,bt=a("3835"),gt=a("50fd"),yt=a("ee06"),St=a("2a18"),kt=a("f2b6"),jt=a("c98a"),Ot=a("45eb"),wt=a("7e84"),xt=a("60a4"),Ct={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},Tt=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return Object(h["a"])(a,[{key:"getShaders",value:function(){var e=Object(Ot["a"])(Object(wt["a"])(a.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if (timeEnd == -1.0 || timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","fs:#main-start":"      if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(Ot["a"])(Object(wt["a"])(a.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props.currentTime;e.uniforms=Object.assign({},e.uniforms,{currentTime:t}),Object(Ot["a"])(Object(wt["a"])(a.prototype),"draw",this).call(this,e)}}]),a}(xt["a"]);Tt.layerName="DrtRequestArcLayer",Tt.defaultProps=Ct;a("aff5"),a("a9e3"),a("cfc3");var _t,Rt=a("2b88"),Et=a("050f"),Dt=a("2bb8"),Ft=a("01a6"),At=a("ca47"),Lt=a("d22f"),Pt=a("ade3"),Mt=(a("90d7"),a("07ac"),a("31d5")),zt=a("a7bc"),Nt=a("7f94"),It=a("9c99"),Vt=a("2418"),Bt=a("ae9c"),Ht=a("261f"),qt=1024,Yt=4,Ut=function(){},Gt=(_t={},Object(Pt["a"])(_t,Ft["a"].TEXTURE_MIN_FILTER,Ft["a"].LINEAR_MIPMAP_LINEAR),Object(Pt["a"])(_t,Ft["a"].TEXTURE_MAG_FILTER,Ft["a"].LINEAR),Object(Pt["a"])(_t,Ft["a"].TEXTURE_WRAP_S,Ft["a"].CLAMP_TO_EDGE),Object(Pt["a"])(_t,Ft["a"].TEXTURE_WRAP_T,Ft["a"].CLAMP_TO_EDGE),_t);function Wt(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function $t(e,t,a,i){return a===t.width&&i===t.height?t:(e.canvas.height=i,e.canvas.width=a,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,a,i),e.canvas)}function Xt(e){return e&&(e.id||e.url)}function Jt(e,t,a,i){var n=t.width,r=t.height,s=Object(Mt["a"])(t,{width:a,height:i});return Object(zt["b"])(t,s,{targetX:0,targetY:0,targetZ:0,width:n,height:r}),t.delete(),s}function Zt(e,t,a){for(var i=0;i<t.length;i++){var n=t[i],r=n.icon,s=n.xOffset,o=Xt(r);e[o]=Object.assign({},r,{x:s,y:a})}}function Kt(e){for(var t=e.icons,a=e.buffer,i=e.mapping,n=void 0===i?{}:i,r=e.xOffset,s=void 0===r?0:r,o=e.yOffset,l=void 0===o?0:o,c=e.rowHeight,u=void 0===c?0:c,h=e.canvasWidth,d=[],m=0;m<t.length;m++){var p=t[m],f=Xt(p);if(!n[f]){var v=p.height,b=p.width;s+b+a>h&&(Zt(n,d,l),s=0,l=u+l+a,u=0,d=[]),d.push({icon:p,xOffset:s}),s=s+b+a,u=Math.max(u,v)}}return d.length>0&&Zt(n,d,l),{mapping:n,rowHeight:u,xOffset:s,yOffset:l,canvasWidth:h,canvasHeight:Wt(u+l+a)}}function Qt(e,t,a){if(!e||!t)return null;a=a||{};var i,n={},r=Object(Bt["a"])(e),s=r.iterable,o=r.objectInfo,l=Object(Q["a"])(s);try{for(l.s();!(i=l.n()).done;){var c=i.value;o.index++;var u=t(c,o),h=Xt(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");n[h]||a[h]&&u.url===a[h].url||(n[h]=u)}}catch(d){l.e(d)}finally{l.f()}return n}var ea=function(){function e(t,a){var i=a.onUpdate,n=void 0===i?Ut:i;Object(u["a"])(this,e),this.gl=t,this.onUpdate=n,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Yt,this._canvasWidth=qt,this._canvasHeight=0,this._canvas=null}return Object(h["a"])(e,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?Xt(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t=e.loadOptions,a=e.autoPacking,i=e.iconAtlas,n=e.iconMapping,r=e.data,s=e.getIcon;t&&(this._loadOptions=t),void 0!==a&&(this._autoPacking=a),s&&(this._getIcon=s),n&&(this._mapping=n),i&&this._updateIconAtlas(i),this._autoPacking&&(r||s)&&"undefined"!==typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}},{key:"isLoaded",get:function(){return 0===this._pendingCount}},{key:"_updateIconAtlas",value:function(e){this._texture&&(this._texture.delete(),this._texture=null),e instanceof Nt["a"]?(e.setParameters(Gt),this._externalTexture=e,this.onUpdate()):e&&(this._texture=new Nt["a"](this.gl,{data:e,parameters:Gt}),this.onUpdate())}},{key:"_updateAutoPacking",value:function(e){var t=Object.values(Qt(e,this._getIcon,this._mapping)||{});if(t.length>0){var a=Kt({icons:t,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),i=a.mapping,n=a.xOffset,r=a.yOffset,s=a.rowHeight,o=a.canvasHeight;this._rowHeight=s,this._mapping=i,this._xOffset=n,this._yOffset=r,this._canvasHeight=o,this._texture||(this._texture=new Nt["a"](this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:Gt})),this._texture.height!==this._canvasHeight&&(this._texture=Jt(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(t)}}},{key:"_loadIcons",value:function(e){var t,a=this,i=this._canvas.getContext("2d"),n=Object(Q["a"])(e);try{var r=function(){var e=t.value;a._pendingCount++,Object(Vt["a"])(e.url,It["a"],a._loadOptions).then((function(t){var n=Xt(e),r=a._mapping[n],s=r.x,o=r.y,l=r.width,c=r.height,u=$t(i,t,l,c);a._texture.setSubImageData({data:u,x:s,y:o,width:l,height:c}),a._texture.generateMipmap(),a.onUpdate()})).catch((function(e){Ht["a"].error(e)()})).finally((function(){a._pendingCount--}))};for(n.s();!(t=n.n()).done;)r()}catch(s){n.e(s)}finally{n.f()}}}]),e}(),ta=a("f863").default,aa=a("0554").default,ia=[0,0,0,255],na={iconAtlas:{type:"object",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},noAlloc:!0,iconStill:{type:"object",value:null},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:ia},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getPathStart:{type:"accessor",value:null},getPathEnd:{type:"accessor",value:null},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},currentTime:{type:"number",value:0},pickable:{type:"boolean",value:!0}},ra=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return Object(h["a"])(a,[{key:"getShaders",value:function(){return Object(Ot["a"])(Object(wt["a"])(a.prototype),"getShaders",this).call(this,{vs:ta,fs:aa,modules:[Rt["a"],Et["a"]]})}},{key:"initializeState",value:function(){var e=this;this.state={iconManager:new ea(this.context.gl,{onUpdate:function(){return e._onUpdate()}})};var t=this.getAttributeManager();t.addInstanced({instanceTimestamps:{size:1,accessor:"getTimeStart"},instanceTimestampsNext:{size:1,accessor:"getTimeEnd"},instanceStartPositions:{size:2,accessor:"getPathStart"},instanceEndPositions:{size:2,accessor:"getPathEnd"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColors:{size:this.props.colorFormat.length,type:Ft["a"].UNSIGNED_BYTE,normalized:!0,transition:!0,accessor:"getColor",defaultValue:ia},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){var t=e.oldProps,i=e.props,n=e.changeFlags;Object(Ot["a"])(Object(wt["a"])(a.prototype),"updateState",this).call(this,{props:i,oldProps:t,changeFlags:n});var r=this.getAttributeManager(),s=i.iconAtlas,o=i.iconMapping,l=i.data,c=i.getIcon,u=this.state.iconManager;u.setProps({loadOptions:i.loadOptions});var h=!1,d=s||this.internalState.isAsyncPropLoading("iconAtlas");if(d?(t.iconAtlas!==i.iconAtlas&&u.setProps({iconAtlas:s,autoPacking:!1}),t.iconMapping!==i.iconMapping&&(u.setProps({iconMapping:o}),h=!0)):u.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&(u.setProps({data:l,getIcon:c}),h=!0),h&&(r.invalidate("instanceOffsets"),r.invalidate("instanceIconFrames")),n.extensionsChanged){var m=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(m)}),r.invalidateAll()}}},{key:"isLoaded",get:function(){return Object(Ot["a"])(Object(wt["a"])(a.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(){Object(Ot["a"])(Object(wt["a"])(a.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,a=this.props,i=a.sizeScale,n=a.sizeMinPixels,r=a.sizeMaxPixels,s=a.sizeUnits,o=a.billboard,l=a.alphaCutoff,c=a.currentTime,u=a.iconStill,h=a.pickable,d=this.state.iconManager,m=this.context.viewport,p=d.getTexture();p&&p.loaded&&this.state.model.setUniforms(Object.assign({},t,{iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeScale:i*("pixels"===s?m.metersPerPixel:1),sizeMinPixels:n,sizeMaxPixels:r,billboard:o,alphaCutoff:l,currentTime:c,pickable:h,iconStillOffsets:this.getInstanceOffset(u),iconStillFrames:this.getInstanceIconFrame(u)})).draw()}},{key:"_getModel",value:function(e){var t=[-1,-1,-1,1,1,1,1,-1];return new At["a"](e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new Lt["a"]({drawMode:Ft["a"].TRIANGLE_FAN,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}}]),a}(Dt["a"]);ra.layerName="MovingIconLayer",ra.defaultProps=na;var sa=a("125d"),oa={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},la=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return Object(h["a"])(a,[{key:"getShaders",value:function(){var e=Object(Ot["a"])(Object(wt["a"])(a.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if(timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        varying float vTime;\n        uniform float searchFlag;\n      ","fs:#main-start":"        if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (searchFlag == 0.0 && vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(Ot["a"])(Object(wt["a"])(a.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props,i=t.currentTime,n=t.searchFlag;e.uniforms=Object.assign({},e.uniforms,{currentTime:i,searchFlag:n}),Object(Ot["a"])(Object(wt["a"])(a.prototype),"draw",this).call(this,e)}}]),a}(sa["a"]);la.layerName="PathTraceLayer",la.defaultProps=oa;var ca={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!1},diamond:{x:0,y:128,width:128,height:128,mask:!1}},ua="pk.eyJ1IjoiZ3JhdXdlbGYiLCJhIjoiY2swem13cDV2MDRqODNtbzRjNHZ1ZnFzcyJ9.NfEs3GesvTdxL3_Wycw6QQ",ha=new yt["a"]({color:[255,255,255],intensity:1}),da=new St["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),ma=new kt["a"]({ambientLight:ha,pointLight:da}),pa={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[ma]},fa={latitude:52.1,longitude:14,zoom:10,pitch:0,minZoom:2,maxZoom:22},va={time:0,fromX:1,fromY:2,toX:3,toY:4,veh:5,arrival:6};function ba(e){var t="mapbox://styles/grauwelf/ck5wauof50m0y1iogrdjoavsn",a=e.simulationTime,i=e.paths,n=e.traces,r=e.drtRequests,s=e.drtRejected,o=e.settingsShowLayers,l=e.center,c=e.vehicleLookup,u=e.searchEnabled,h=e.onClick,d=pa,m=Object.assign({},fa);m.latitude=l[1],m.longitude=l[0];var p=3,f=Object(Qe["useState"])({}),v=Object(bt["a"])(f,2),b=v[0],g=v[1],y=[];function S(){console.log(b),b.object?h(b.object.v):h(null)}function k(e){var t=e.hoverInfo,a=t.object,i=t.x,n=t.y;if(!a)return null;var r=c[a.v];return et.a.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#ddddeedd",borderLeft:"6px solid green",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#223",padding:"1rem 1rem",position:"absolute",left:i+40,top:n-30}},et.a.createElement("big",null,et.a.createElement("b",null,"Vehicle: ",r)),et.a.createElement("div",null,"Passengers: ",a.occ," "))}return o["Routes"]&&y.push(new la({id:"Routes",data:n,currentTime:a,getSourcePosition:function(e){return e.p0},getTargetPosition:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getColor:function(t){return e.colors[t.occ]},getWidth:function(e){return 3*(e.occ+1)-1},opacity:.9,widthMinPixels:2,rounded:!1,shadowEnabled:!1,searchFlag:u?1:0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:g})),o["Vehicles"]&&y.push(new ra({id:"Vehicles",data:i,getPathStart:function(e){return e.p0},getPathEnd:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getIcon:function(e){return"vehicle"},getColor:function(t){return e.colors[t.occ]},iconMoving:"vehicle",iconStill:"diamond",getSize:u?56:44,opacity:1,currentTime:a,shadowEnabled:!1,noAlloc:!0,iconAtlas:"/motus-viz/icon-atlas.png",iconMapping:ca,sizeScale:1,billboard:!0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:g})),o["DRT Requests"]&&y.push(new Tt({id:"DRT Requests",data:r,currentTime:a,getSourcePosition:function(e){return[e[va.fromX],e[va.fromY]]},getTargetPosition:function(e){return[e[va.toX],e[va.toY]]},getTimeStart:function(e){return e[va.time]},getTimeEnd:function(e){return e[va.arrival]},getSourceColor:[17,192,0],getTargetColor:[200,255,224],getWidth:p,opacity:.5,searchFlag:u?1:0})),o["DRT Rejections"]&&y.push(new Tt({id:"DRT Rejections",data:s,currentTime:a,getSourcePosition:function(e){return[e[va.fromX],e[va.fromY]]},getTargetPosition:function(e){return[e[va.toX],e[va.toY]]},getTimeStart:function(e){return e[va.time]},getTimeEnd:function(e){return e[va.arrival]},getSourceColor:[192,17,0],getTargetColor:[255,224,200],getWidth:p,opacity:.5,searchFlag:u?1:0})),et.a.createElement(jt["a"],{layers:y,effects:d.effects,pickingRadius:5,initialViewState:m,controller:!0,getCursor:function(){return"pointer"},onClick:S},et.a.createElement(gt["a"],{reuseMaps:!0,mapStyle:t,mapOptions:{logoPosition:"bottom-right"},preventStyleDiffing:!0,mapboxApiAccessToken:ua}),k({hoverInfo:b}))}a("5319"),a("466d");var ga=a("df7c"),ya=a.n(ga),Sa=function(){function e(t){Object(u["a"])(this,e),this.urlId=t.url,this.needsAuth=t.need_password,this.baseUrl=t.svn,t.svn.endsWith("/")||(this.baseUrl+="/")}return Object(h["a"])(e,[{key:"cleanURL",value:function(e){var t=this.baseUrl+e.replace(/^0-9a-zA-Z_\-\/:+/i,"");return t=t.replaceAll("//","/"),t=t.replace("https:/","https://"),t=t.replace("http:/","http://"),t}},{key:"_getFileResponse",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.replace(/^0-9a-zA-Z_\-\/:+/i,""),a=ya.a.normalize(a),a=this.baseUrl+a,i={},n=x.state.credentials[this.urlId],this.needsAuth&&(i["Authorization"]="Basic ".concat(n)),r=new Request(a,{headers:i}),e.next=9,fetch(r).then((function(e){if(200!=e.status)throw console.log("Status:",e.status),e;return e}));case 9:return s=e.sent,e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileText",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return a=e.sent,e.abrupt("return",a.text());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileJson",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileBlob",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return a=e.sent,e.abrupt("return",a.blob());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDirectory",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("HTTP: get",t),a=t,a.endsWith("/")||(a+="/"),e.next=5,this._getFileResponse(a);case 5:return i=e.sent,e.next=8,i.text();case 8:return n=e.sent,e.abrupt("return",this.buildListFromHtml(n));case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildListFromHtml",value:function(e){return e.indexOf("<ul>")>-1?this.buildListFromSVN(e):e.indexOf("<table>")>-1?this.buildListFromApache24(e):{dirs:[],files:[]}}},{key:"buildListFromSVN",value:function(e){var t,a=/"(.*?)"/,i=[],n=[],r=e.split("\n"),s=Object(Q["a"])(r);try{for(s.s();!(t=s.n()).done;){var o=t.value,l=o.indexOf('<li><a href="');if(!(l<0)){var c=o.match(a);if(c){var u=c[1];"../"!==u&&(u.endsWith("/")?i.push(u.substring(0,u.length-1)):n.push(u))}}}}catch(h){s.e(h)}finally{s.f()}return{dirs:i,files:n}}},{key:"buildListFromApache24",value:function(e){var t,a=/"(.*?)"/,i=[],n=[],r=e.split("\n"),s=Object(Q["a"])(r);try{for(s.s();!(t=s.n()).done;){var o=t.value;if(!(o.indexOf('<th "')>-1)&&!(o.indexOf("[PARENTDIR]")>-1)){var l=o.indexOf('<td><a href="');if(!(l<0)){var c=o.substring(l).match(a);if(c){var u=c[1];"../"!==u&&(u.endsWith("/")?i.push(u.substring(0,u.length-1)):n.push(u))}}}}}catch(h){s.e(h)}finally{s.f()}return{dirs:i,files:n}}}]),e}(),ka=Sa,ja=a("b8ae");b["c"].use(ja["VuePlugin"]);var Oa=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,255],1:[165,0,38],2:[215,48,39],3:[244,109,67],4:[253,174,97],5:[254,224,139],6:[217,239,139],7:[166,217,106],8:[102,189,99],9:[26,152,80],10:[0,104,55]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Vehicles:!0,Routes:!1,"DRT Requests":!1,"DRT Rejections":!1},e.MAX_CAPACITY=10,e.LEGEND_LINE_WIDTH=2,e.REJECTED_DURATION=900,e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:y.line,color:e.COLOR_OCCUPANCY[t],value:e.LEGEND_LINE_WIDTH,key:t,label:t}})),e.legendRequests=[{type:y.line,color:[17,192,0],value:1,key:0,label:"Accepted"},{type:y.line,color:[192,17,0],value:1,key:1,label:"Rejected"}],e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:"",center:[6.5,51]},e.myState={statusMessage:"",clock:"00:00",colorScheme:n.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.timeStart=0,e.timeEnd=86400,e.traces=Object(Be["a"])([]),e.paths=Object(Be["a"])([]),e.requests=Object(Be["a"])([]),e.rejected=Object(Be["a"])([]),e.simulationTime=21600,e.timeElapsedSinceLastFrame=0,e.searchTerm="",e.searchEnabled=!1,e.globalState=x.state,e.isDarkMode=e.myState.colorScheme===n.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e.isPausedDueToHiding=!1,e}return Object(h["a"])(a,[{key:"handleSettingChange",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this.SETTINGS[t]=!this.SETTINGS[t],this.updateDatasetFilters(),this.simulationTime+=1;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[14,52.1]),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 12:a=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",a),this.buildThumbnail();case 15:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Ve.a.arraybuffer(t);case 7:a=e.sent,i=this.arrayBufferToBase64(a),i&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(i,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===n.DarkMode,this.updateLegendColors()}},{key:"handleSearch",value:function(){var e,t,a,i,n,r,s=this.vehicleLookupString[this.searchTerm];s>-1?(console.log("vehicle",s),null===(e=this.pathVehicle)||void 0===e||e.filterExact(s),null===(t=this.traceVehicle)||void 0===t||t.filterExact(s),null===(a=this.requestVehicle)||void 0===a||a.filterExact(s),this.requestStart.filterAll(),this.requestEnd.filterAll(),this.rejectedStart.filterAll(),this.rejectedEnd.filterAll(),this.searchEnabled=!0):(console.log("nope"),null===(i=this.pathVehicle)||void 0===i||i.filterAll(),null===(n=this.traceVehicle)||void 0===n||n.filterAll(),null===(r=this.requestVehicle)||void 0===r||r.filterAll(),this.searchEnabled=!1);this.updateDatasetFilters()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",a=new Uint8Array(e),i=a.byteLength,n=0;n<i;n++)t+=String.fromCharCode(a[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===n.DarkMode?t:e}},{key:"setWallClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock="".concat(e<10?"0":"").concat(e).concat(t<10?":0":":").concat(t)}},{key:"setTime",value:function(e){this.simulationTime=e,this.setWallClock(),this.traceStart&&this.pathStart&&this.requestStart&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.searchEnabled||(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0]),this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0]),this.rejectedStart.filter([0,this.simulationTime]),this.rejectedEnd.filter([this.simulationTime,1/0]))),this.$options.paths=this.paths.allFiltered(),this.$options.traces=this.traces.allFiltered(),this.$options.drtRequests=this.requests.allFiltered(),this.$options.drtRejected=this.rejected.allFiltered()}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.timeElapsedSinceLastFrame=Date.now(),this.myState.isRunning&&0===this.speed&&(this.speed=1),this.myState.isRunning&&this.animate()}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.generateBreadcrumbs(),this.updateLegendColors(),this.setWallClock(),this.myState.statusMessage="/ Loading files...",console.log("Loading files"),e.next=14,this.loadFiles();case 14:return t=e.sent,a=t.trips,i=t.drtRequests,n=t.drtRejected,console.log("Parsing vehicles trajectories"),this.myState.statusMessage="/ Calculating locations...",e.next=22,this.parseVehicles(a);case 22:return this.paths=e.sent,this.pathStart=this.paths.dimension((function(e){return e.t0})),this.pathEnd=this.paths.dimension((function(e){return e.t1})),this.pathVehicle=this.paths.dimension((function(e){return e.v})),console.log("Process routes..."),this.myState.statusMessage="/ Processing routes...",e.next=30,this.parseRouteTraces(a);case 30:return this.traces=e.sent,this.traceStart=this.traces.dimension((function(e){return e.t0})),this.traceEnd=this.traces.dimension((function(e){return e.t1})),this.traceVehicle=this.traces.dimension((function(e){return e.v})),console.log("Sort requests..."),this.myState.statusMessage="/ Sorting requests...",e.next=38,this.parseDrtRequests(i);case 38:return this.requests=e.sent,this.requestStart=this.requests.dimension((function(e){return e[0]})),this.requestEnd=this.requests.dimension((function(e){return e[6]})),this.requestVehicle=this.requests.dimension((function(e){return e[5]})),console.log("Sorting rejected requests..."),e.next=45,this.parseDrtRejected(n);case 45:this.rejected=e.sent,this.rejectedStart=this.rejected.dimension((function(e){return e[0]})),this.rejectedEnd=this.rejected.dimension((function(e){return e[0]+r.REJECTED_DURATION})),console.log("GO!"),this.myState.statusMessage="",document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.myState.isRunning=!0,this.timeElapsedSinceLastFrame=Date.now(),this.animate();case 54:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseDrtRequests",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.vehicleLookup.length){a=Object(Q["a"])(t);try{for(a.s();!(i=a.n()).done;){n=i.value;try{n[5]=this.vehicleLookupString[n[5]]}catch(r){}}}catch(s){a.e(s)}finally{a.f()}}return e.abrupt("return",Object(Be["a"])(t));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"parseDrtRejected",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=Object(Q["a"])(t);try{for(a.s();!(i=a.n()).done;)n=i.value,n[5]=-1}catch(r){a.e(r)}finally{a.f()}return e.abrupt("return",Object(Be["a"])(t));case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"parseVehicles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=[],i=-1,e.next=4,qe["forEachAsync"](t,(function(e){var t=e.path,r=e.timestamps,s=e.passengers;i++,n.vehicleLookup[i]=e.id,n.vehicleLookupString[e.id]=i;for(var o=0;o<e.path.length-1;o++)a.push({t0:r[o],t1:r[o+1],p0:t[o],p1:t[o+1],v:i,occ:s[o]})}));case 4:return e.abrupt("return",Object(Be["a"])(a));case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateDatasetFilters",value:function(){this.traceStart&&this.pathStart&&this.requestStart&&(this.SETTINGS.Routes&&(this.searchEnabled?(this.traceStart.filterAll(),this.traceEnd.filterAll()):(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0])),this.$options.traces=this.traces.allFiltered()),this.SETTINGS.Vehicles&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.$options.paths=this.paths.allFiltered()),this.SETTINGS["DRT Requests"]&&(this.searchEnabled?(this.requestStart.filterAll(),this.requestEnd.filterAll()):(this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0])),this.$options.drtRequests=this.requests.allFiltered()),this.SETTINGS["DRT Rejections"]&&(this.searchEnabled?(this.rejectedStart.filterAll(),this.rejectedEnd.filterAll()):(this.rejectedStart.filter([0,this.simulationTime]),this.rejectedEnd.filter([this.simulationTime,1/0])),this.$options.drtRejected=this.rejected.allFiltered()))}},{key:"animate",value:function(){if(this.myState.isRunning){var e=Date.now()-this.timeElapsedSinceLastFrame;this.timeElapsedSinceLastFrame+=e,this.simulationTime+=e*this.speed*.06,this.updateDatasetFilters(),this.setWallClock(),window.requestAnimationFrame(this.animate)}}},{key:"handleVisibilityChange",value:function(){this.isPausedDueToHiding&&!document.hidden?(console.log("unpausing"),this.isPausedDueToHiding=!1,this.toggleSimulation()):this.myState.isRunning&&document.hidden&&(console.log("pausing"),this.isPausedDueToHiding=!0,this.toggleSimulation())}},{key:"parseRouteTraces",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return 0,a=-1,i=[],e.next=5,qe["forEachAsync"](t,(function(e){a++;for(var t=e.timestamps[0],n=e.timestamps[0],r=[],s=function(s){n=e.timestamps[s],e.path[s][0]===e.path[s-1][0]&&e.path[s][1]===e.path[s-1][1]?(r.forEach((function(t){t.t1=e.timestamps[s-1]})),i.push.apply(i,Object(Pe["a"])(r)),r=[],t=n):r.push({t0:t,p0:e.path[s-1],p1:e.path[s],v:a,occ:e.passengers[s-1]})},o=1;o<e.path.length;o++)s(o);r.forEach((function(e){e.t1=n})),i.push.apply(i,Object(Pe["a"])(r))}));case 5:return e.abrupt("return",Object(Be["a"])(i));case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){document.removeEventListener("visibilityChange",this.handleVisibilityChange),x.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"loadFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],a=[],i=[],e.prev=3,!this.vizDetails.drtTrips.endsWith("json")){e.next=13;break}return e.next=7,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 7:n=e.sent,t=n.trips,a=n.drtRequests,i=a.filter((function(e){return e[5]<0})).map((function(e){return e.concat(e[0]+c.REJECTED_DURATION)})),e.next=32;break;case 13:if(!this.vizDetails.drtTrips.endsWith("gz")){e.next=32;break}return e.next=16,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.drtTrips);case 16:if(r=e.sent,!r){e.next=23;break}return e.next=20,Object(He["a"])(r);case 20:e.t0=e.sent,e.next=24;break;case 23:e.t0=null;case 24:return s=e.t0,e.next=27,qe["run"](Ue.a.inflateAsync(s,{to:"string"}));case 27:o=e.sent,l=JSON.parse(o),t=l.trips,a=l.drtRequests,i=a.filter((function(e){return e[5]<0})).map((function(e){return e.concat(e[0]+c.REJECTED_DURATION)}));case 32:e.next=38;break;case 34:e.prev=34,e.t1=e["catch"](3),console.error(e.t1),this.myState.statusMessage=""+e.t1;case 38:return e.abrupt("return",{trips:t,drtRequests:a,drtRejected:i});case 39:case"end":return e.stop()}}),e,this,[[3,34]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===n.DarkMode?n.LightMode:n.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],Oa.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Oa.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Oa.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Oa.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],Oa.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("state.colorScheme")],Oa.prototype,"swapTheme",null),Object(p["a"])([Object(b["d"])("searchTerm")],Oa.prototype,"handleSearch",null),Oa=Object(p["a"])([Object(b["a"])({components:{CollapsiblePanel:Ke,SettingsPanel:vt,LegendColors:tt,TripViz:ba,VueSlider:ze.a,PlaybackControls:ct,ToggleButton:Ne["ToggleButton"]}})],Oa),x.commit("registerPlugin",{kebabName:"vehicle-animation",prettyName:"Trip Viewer",description:"Deck.gl based trip viewer",filePatterns:["viz-vehicles*.y?(a)ml"],component:Oa});var wa=Oa,xa=wa,Ca=(a("986a"),Object(E["a"])(xa,Ae,Le,!1,null,"43fdb030",null)),Ta=Ca.exports,_a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"xy-hexagons",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?a("xy-hex-layer",{staticClass:"anim",attrs:{center:e.center,data:e.requests,extrude:e.extrudeTowers,radius:e.radius,maxHeight:e.maxHeight}}):e._e(),e.isLoaded&&!e.thumbnail?a("div",{staticClass:"left-side"},[a("collapsible-panel",{attrs:{darkMode:!0,width:"250",direction:"left"}},[a("div",{staticClass:"panel-items"},[a("p",{staticClass:"big xtitle"},[e._v(e._s(e.vizDetails.title))]),a("p",[e._v(e._s(e.vizDetails.description))])])])],1):e._e(),e.isLoaded&&!e.thumbnail?a("div",{staticClass:"right-side"},[a("collapsible-panel",{attrs:{darkMode:!0,width:"150",direction:"right"}},[a("div",{staticClass:"panel-items"},[a("div",{staticClass:"panel-item"},[a("p",{staticClass:"speed-label"},[e._v("Aggregate")]),a("div",{staticClass:"buttons has-addons"},e._l(Object.keys(e.aggregations),(function(t){return a("button",{key:t,staticClass:"button is-small is-dark",class:{"is-danger":e.activeAggregation===t},on:{click:function(a){return e.handleOrigDest(t)}}},[e._v(e._s(t))])})),0)]),a("div",{staticClass:"panel-item"},[a("p",{staticClass:"speed-label"},[e._v("Show in 3D")]),a("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.extrudeTowers,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.extrudeTowers=!e.extrudeTowers}}})],1),a("div",{staticClass:"panel-item"},[a("p",{staticClass:"speed-label"},[e._v("Max Height: "+e._s(e.maxHeight))]),a("vue-slider",{staticClass:"speed-slider",attrs:{min:100,max:1e3,interval:50,duration:0,dotSize:16,tooltip:"none"},model:{value:e.maxHeight,callback:function(t){e.maxHeight=t},expression:"maxHeight"}})],1),a("div",{staticClass:"panel-item"},[a("p",{staticClass:"speed-label"},[e._v("Radius: "+e._s(e.radius))]),a("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:1e3,interval:5,duration:0,dotSize:16,tooltip:"none"},model:{value:e.radius,callback:function(t){e.radius=t},expression:"radius"}})],1)])])],1):e._e(),!e.thumbnail&&e.myState.statusMessage?a("div",{staticClass:"nav"},[a("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},Ra=[],Ea=(a("f00c"),a("b680"),a("4ce1")),Da="pk.eyJ1IjoiZ3JhdXdlbGYiLCJhIjoiY2swem13cDV2MDRqODNtbzRjNHZ1ZnFzcyJ9.NfEs3GesvTdxL3_Wycw6QQ",Fa=new yt["a"]({color:[255,255,255],intensity:1}),Aa=new St["a"]({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),La=new St["a"]({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]}),Pa=new kt["a"]({ambientLight:Fa,pointLight1:Aa,pointLight2:La}),Ma={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},za={zoom:9,minZoom:5,maxZoom:15,pitch:40,bearing:0},Na=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]];function Ia(e){var t=e.object;if(!t||!t.position||!t.position.length)return null;var a=t.position[1],i=t.position[0],n=t.points.length;return{text:"    ".concat(n," Pickups\n    latitude: ").concat(Number.isFinite(a)?a.toFixed(6):"","\n    longitude: ").concat(Number.isFinite(i)?i.toFixed(6):"","\n    ")}}function Va(e){var t=e.data,a=void 0===t?[]:t,i=e.mapStyle,n=void 0===i?"mapbox://styles/mapbox/dark-v9":i,r=e.radius,s=void 0===r?100:r,o=e.upperPercentile,l=void 0===o?100:o,c=e.coverage,u=void 0===c?.8:c,h=e.extrude,d=void 0===h||h,m=e.maxHeight,p=void 0===m?500:m,f=e.center,v=void 0===f?[14.34,52.3]:f,b=Object(bt["a"])(v,2),g=b[0],y=b[1],S=Object.assign(za,{longitude:g,latitude:y}),k=[new Ea["a"]({id:"hexlayer",colorRange:Na,coverage:u,data:a,autoHighlight:!0,elevationRange:[0,p],elevationScale:a&&a.length?50:0,extruded:d,getPosition:function(e){return e},pickable:!0,radius:s,upperPercentile:l,material:Ma,transitions:{elevationScale:{type:"interpolation",duration:1e3}}})];return et.a.createElement(jt["a"],{layers:k,effects:[Pa],initialViewState:S,controller:!0,getTooltip:Ia},et.a.createElement(gt["a"],{reuseMaps:!0,mapStyle:n,preventStyleDiffing:!0,mapboxApiAccessToken:Da}))}b["c"].use(ja["VuePlugin"]);var Ba=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.radius=100,e.maxHeight=500,e.extrudeTowers=!0,e.vizDetails={title:"",description:"",file:"",projection:"",thumbnail:"",data:{}},e.myState={statusMessage:"",colorScheme:n.DarkMode,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.requests=[],e.searchTerm="",e.searchEnabled=!1,e.globalState=x.state,e.isDarkMode=e.myState.colorScheme===n.DarkMode,e.isLoaded=!1,e.activeAggregation="",e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.center=[0,0],e.rawRequests=[],e.aggregations={},e}return Object(h["a"])(a,[{key:"handleOrigDest",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.activeAggregation=t,a=this.aggregations[t],this.requests=this.rawRequests.map((function(e){return[e[a[0]],e[a[1]]]}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.fileSystem)return[];var e,t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(i+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+i}))}}catch(s){n.e(s)}finally{n.f()}return t.push({label:this.vizDetails.title,url:"#"}),x.commit("setBreadCrumbs",t),t}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 11:a=this.vizDetails.title?this.vizDetails.title:"Hex Aggregation",this.$emit("title",a);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Ve.a.arraybuffer(t);case 7:a=e.sent,i=this.arrayBufferToBase64(a),i&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(i,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===n.DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",a=new Uint8Array(e),i=a.byteLength,n=0;n<i;n++)t+=String.fromCharCode(a[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===n.DarkMode?t:e}},{key:"findCenter",value:function(e){var t="";for(t in this.aggregations)break;for(var a=this.aggregations[t][0],i=this.aggregations[t][1],n=0,r=0,s=0,o=0;o<e.length;o+=64)s++,n+=e[o][a],r+=e[o][i];return n/=s,r/=s,[n,r]}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.generateBreadcrumbs(),this.myState.statusMessage="Dateien laden...",console.log("loading files"),e.next=11,this.loadFiles();case 11:t=e.sent,a=t.dataArray,this.rawRequests=a,this.aggregations=this.parseAggregations(),this.center=this.findCenter(this.rawRequests),this.isLoaded=!0,this.buildThumbnail(),console.log("Sort DRT requests..."),this.myState.statusMessage="Sort DRT requsts...",this.handleOrigDest(Object.keys(this.aggregations)[0]),this.myState.statusMessage="";case 22:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseAggregations",value:function(){var e,t={},a=Object(Q["a"])(this.vizDetails.data.aggregations);try{for(a.s();!(e=a.n()).done;){var i=e.value;t[i.title]=[i.x,i.y]}}catch(n){a.e(n)}finally{a.f()}return t}},{key:"beforeDestroy",value:function(){x.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"loadFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!this.vizDetails.file.endsWith("json")){e.next=9;break}return e.next=5,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.file);case 5:a=e.sent,t=a[this.vizDetails.data.elements],e.next=26;break;case 9:if(!this.vizDetails.file.endsWith("gz")){e.next=26;break}return e.next=12,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.file);case 12:if(i=e.sent,!i){e.next=19;break}return e.next=16,Object(He["a"])(i);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:return n=e.t0,e.next=23,qe["run"](Ue.a.inflateAsync(n,{to:"string"}));case 23:r=e.sent,s=JSON.parse(r),t=s[this.vizDetails.data.elements];case 26:e.next=32;break;case 28:e.prev=28,e.t1=e["catch"](1),console.error(e.t1),this.myState.statusMessage=""+e.t1;case 32:return e.abrupt("return",{dataArray:t});case 33:case"end":return e.stop()}}),e,this,[[1,28]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===n.DarkMode?n.LightMode:n.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],Ba.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Ba.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Ba.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Ba.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],Ba.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("state.colorScheme")],Ba.prototype,"swapTheme",null),Ba=Object(p["a"])([Object(b["a"])({components:{CollapsiblePanel:Ke,XyHexLayer:Va,VueSlider:ze.a,ToggleButton:Ne["ToggleButton"]}})],Ba),x.commit("registerPlugin",{kebabName:"xy-hexagons",prettyName:"XY Aggregator",description:"Collects XY data into geographic hexagons",filePatterns:["viz-xy*.y?(a)ml"],component:Ba});var Ha=Ba,qa=Ha,Ya=(a("fe05"),Object(E["a"])(qa,_a,Ra,!1,null,"257e0d62",null)),Ua=Ya.exports,Ga=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app"}},[!e.thumbnail&&e.vizDetails.network?i("animation-view",{staticClass:"anim",attrs:{vizState:e.myState,speed:e.speed,fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,vizDetails:e.vizDetails},on:{loaded:e.toggleLoaded}}):e._e(),e.thumbnail?e._e():i("modal-markdown-dialog",{class:{"is-active":e.showHelp},attrs:{id:"help-dialog",title:"DRT Vehicles",md:"@/assets/animation-helptext.md",buttons:["OK"]},on:{click:function(t){return e.clickedCloseHelp()}}}),e.thumbnail?e._e():i("div",{staticClass:"nav"},[i("p",{staticClass:"big day"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?i("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):i("p",{staticClass:"big time"},[e._v(e._s(e.myState.clock))])]),i("div",{staticClass:"right-side"},[e.isLoaded?i("div",{staticClass:"morestuff"},[i("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}}),i("p",{staticClass:"speed-label",style:{color:e.textColor.text}},[e._v(e._s(e.speed)+"x speed")])],1):e._e()]),e.isLoaded?i("playback-controls",{staticClass:"playback-stuff",on:{click:e.toggleSimulation}}):e._e(),e.isLoaded?i("div",{staticClass:"extra-buttons"},[i("div",{staticClass:"help-button",attrs:{title:"info"},on:{click:e.clickedHelp}},[i("i",{staticClass:"help-button-text fa fa-1x fa-question"})]),i("img",{staticClass:"theme-button",attrs:{src:a("0386"),title:"dark/light theme"},on:{click:e.rotateColors}})]):e._e()],1)},Wa=[],$a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"anim-container"}})},Xa=[],Ja=(a("9911"),a("9037")),Za=a("5a89"),Ka=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(e,i,n){var r;Object(u["a"])(this,a),r=t.call(this),r.tripsPerAgent={},r.midX=i,r.midY=n;for(var s=[],o=[],l=0,c=Object.keys(e);l<c.length;l++){var h=c[l],d=e[h];r.buildWaypoints(d,s,o)}return r.setAttribute("position",new Za["f"](s,3)),r.setAttribute("position2",new Za["f"](o,3)),r}return Object(h["a"])(a,[{key:"buildWaypoints",value:function(e,t,a){var i=e.time.length;if(!(i<2)){var n=0;if(0!==e.time[0]){var r=e.path[0][0]-this.midX,s=e.path[0][1]-this.midY,o=e.time[0];t.push(r,s,0),a.push(r,s,o),n++}for(var l=0;l<i-1;l++){var c=e.path[l][0]-this.midX,u=e.path[l][1]-this.midY,h=e.time[l];t.push(c,u,h);var d=e.path[l+1][0]-this.midX,m=e.path[l+1][1]-this.midY,p=e.time[l+1];a.push(d,m,p),n++}this.tripsPerAgent[e.id]=n}}}]),a}(Za["b"]),Qa=Ka,ei=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.call(this),e.SIMULATION_PERCENT="sim-percent",e.DRAG="sim-drag",e}return a}(b["c"]);ei=Object(p["a"])([b["a"]],ei);var ti,ai,ii,ni=new ei,ri=ni,si=Object(E["a"])(ri,ti,ai,!1,null,null,null),oi=si.exports,li=(a("fb2c"),a("25f0"),"initialize"),ci="error",ui="result",hi=(self,function(){function e(t){var a=this;Object(u["a"])(this,e),this.promises=new Map,this.worker=t,this.handleMessageDelegate=function(e){return a.handleWorkerMessage(e)},this.worker.addEventListener("message",this.handleMessageDelegate)}return Object(h["a"])(e,[{key:"destroy",value:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessageDelegate),this.worker.terminate())}},{key:"postAsyncWorkerMessage",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t,a,i){var n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={call:{method:t,parameters:a},id:this.generatePromiseId()},i?this.worker.postMessage(n,i):this.worker.postMessage(n,[]),e.abrupt("return",new Promise((function(e,t){r.promises.set(n.id,{resolve:e,reject:t})})));case 3:case"end":return e.stop()}}),e,this)})));function t(t,a,i){return e.apply(this,arguments)}return t}()},{key:"handleWorkerMessage",value:function(e){Date.now();var t=e.data;switch(t.type){case ci:this.handleError(t);break;case ui:this.handleEvent(t);break;default:console.error("unknown message type: "+t.type)}}},{key:"handleError",value:function(e){console.error("Error in Worker: "+e.error),this.promises.has(e.id)&&(this.promises.get(e.id).reject(e.error),this.promises.delete(e.id))}},{key:"handleEvent",value:function(e){this.promises.has(e.id)&&(this.promises.get(e.id).resolve(e.result),this.promises.delete(e.id))}},{key:"generatePromiseId",value:function(){var e=new Uint32Array(8);return crypto.getRandomValues(e),e.reduce((function(e,t){return e+("0"+t.toString(16)).slice(-2)}),"")}}]),e}()),di=a("566a"),mi=a.n(di);(function(e){e["FetchXML"]="FetchXML"})(ii||(ii={}));var pi=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.call(this,new mi.a)}return Object(h["a"])(a,[{key:"fetchXML",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(ii.FetchXML,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(li,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new a,e.next=3,i.initialize(t);case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),a}(hi),fi=function(e){Object(d["a"])(i,e);var t=Object(m["a"])(i);function i(){var e;return Object(u["a"])(this,i),e=t.apply(this,arguments),e.timeFactor=600,e.myState=e.vizState,e.timeDirection=1,e.vertexShader=a("e9b2").default,e.fragmentShader=a("a278").default,e.globalState=x.state,e.colors=e.myState.colorScheme==n.DarkMode?k:S,e.simulationTime=0,e.animationTimeSinceUnpaused=0,e.clock=new Za["c"](!1),e.nextClockUpdateTime=0,e.scene=new Za["p"],e.renderer=new Za["y"]({antialias:!0}),e.network={nodes:{},links:{}},e.OrbitControl=a("d1f5"),e.linkMaterial=new Za["i"]({color:e.colors.links}),e.xRange=[1e25,-1e25],e.yRange=[1e25,-1e25],e.midpointX=36e4,e.midpointY=5715e3,e.tripList={},e.wasSimulationRunning=!0,e.networkLayers=[],e.tempStreamBuffer="",e}return Object(h["a"])(i,[{key:"speedChanged",value:function(){this.myState.isRunning=!0;var e=this.speed<0?-1:1;e!==this.timeDirection&&(this.clock.stop(),this.clock=new Za["c"](!1),this.timeDirection=e,this.clock.start(),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused),console.log("done flip"))}},{key:"playPauseSim",value:function(){this.myState.isRunning?(this.clock.start(),requestAnimationFrame(this.animate)):(this.clock.stop(),this.clock=new Za["c"](!1),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused))}},{key:"switchColorScheme",value:function(e){this.colors=e==n.LightMode?S:k,this.scene.background=new Za["d"](this.colors.background);var t=this.scene.getObjectByName("network");t&&this.scene.remove(t),this.linkMaterial.dispose(),this.linkMaterial=new Za["i"]({color:this.colors.links});var a,i=Object(Q["a"])(this.networkLayers);try{for(i.s();!(a=i.n()).done;){var r=a.value,s=r.name,o=this.scene.getObjectByName(s);o&&this.scene.remove(o);var l=new Za["j"](r.geometry,this.linkMaterial);l.name=s,this.scene.add(l)}}catch(c){i.e(c)}finally{i.f()}}},{key:"mounted",value:function(){this.setInitialClockTime(),this.setupSimulation(),this.setupDragListener(),window.addEventListener("resize",this.onWindowResize,!1),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)}},{key:"setInitialClockTime",value:function(){var e=""+this.$route.query.start;if(e&&NaN!=parseInt(e)){var t=parseInt(e);t>=0&&(this.simulationTime=t,this.setVisibleClock(),this.$nextTick())}}},{key:"handleVisibilityChange",value:function(){console.log("window visibility changed!! hidden:",document.hidden)}},{key:"setupDragListener",value:function(){var e=this;oi.$on(oi.DRAG,(function(t){-1===t?(e.wasSimulationRunning=e.myState.isRunning,e.myState.isRunning=!1):-2===t?e.myState.isRunning=e.wasSimulationRunning:(e.simulationTime=e.nextClockUpdateTime=t,e.animate())}))}},{key:"exitSimulation",value:function(){this.clock=new Za["c"](!1),this.simulationTime=0,this.nextClockUpdateTime=0,this.timeDirection=1;while(this.scene.children.length)this.scene.remove(this.scene.children[0])}},{key:"beforeDestroy",value:function(){this.exitSimulation(),window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("visibilityChange",this.handleVisibilityChange),oi.$off(oi.DRAG),this.agentMaterial&&this.agentMaterial.dispose(),this.agentGeometry&&this.agentGeometry.dispose();var e,t=Object(Q["a"])(this.networkLayers);try{for(t.s();!(e=t.n()).done;){var a=e.value;a.geometry.dispose()}}catch(i){t.e(i)}finally{t.f()}this.linkMaterial.dispose(),this.scene.dispose()}},{key:"onWindowResize",value:function(){if(this.container=document.getElementById("anim-container"),this.container&&this.camera){this.renderer.domElement;this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}}},{key:"setupSimulation",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.initScene(),this.myState.statusMessage="loading agents",e.next=4,this.loadTrips();case 4:return this.finishedLoadingTrips(),e.next=7,this.addNetworkToScene();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startSimulation",value:function(){this.$emit("loaded",!0),this.myState.isShowingHelp||(this.clock.start(),this.animate(),this.myState.isRunning=!0)}},{key:"networkLayerAdder",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t,a,i){var n,r,s,o,l,c,u,h,d,m,p,f,v,b,g,y=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=2e4,!(i>a.length)){e.next=5;break}return this.myState.statusMessage="",this.startSimulation(),e.abrupt("return");case 5:for(r=[],s=i,o=i+n>a.length?a.length:i+n,l=0,c=s;c<o;c++)u=a[c],h=t[u.from],d=t[u.to],h&&d?(m=new Za["x"](h.x,h.y,0),p=new Za["x"](d.x,d.y,0),f=(new Za["b"]).setFromPoints([m,p]),r.push(f)):(l++,l<20&&console.log({badlink:u}));v=Ja["a"].mergeBufferGeometries(r),b=new Za["j"](v,this.linkMaterial),b.name="network"+i,this.scene.add(b),this.camera&&this.renderer.render(this.scene,this.camera),this.networkLayers.push(b),v.dispose(),g=i+n,setTimeout((function(){y.networkLayerAdder(t,a,g)}),1);case 19:case"end":return e.stop()}}),e,this)})));function t(t,a,i){return e.apply(this,arguments)}return t}()},{key:"createNodesAndLinksFromXML",value:function(e){var t,a=e,i=a.network.nodes[0].node,n=a.network.links[0].link,r=Object(Q["a"])(i);try{for(r.s();!(t=r.n()).done;){var s=t.value,o=s.$;o.x=parseFloat(o.x),o.y=parseFloat(o.y),this.network.nodes[o.id]=o}}catch(d){r.e(d)}finally{r.f()}var l,c=Object(Q["a"])(n);try{for(c.s();!(l=c.n()).done;){var u=l.value,h=u.$;this.network.links[h.id]=h}}catch(d){c.e(d)}finally{c.f()}}},{key:"addNetworkToScene",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="loading network",this.networkLayers=[],e.prev=2,this.myState.fileSystem){e.next=5;break}return e.abrupt("return");case 5:return console.log({vizDetails:this.vizDetails}),e.next=8,pi.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 8:return this._roadFetcher=e.sent,e.next=11,this._roadFetcher.fetchXML();case 11:for(i in t=e.sent,this._roadFetcher.destroy(),console.log({xml:t}),this.createNodesAndLinksFromXML(t),a={},this.network.nodes)n=this.network.nodes[i],a[i]={x:n.x-this.midpointX,y:n.y-this.midpointY};this.networkLayerAdder(a,Object.values(this.network.links),0),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](2),console.error({e:e.t0}),this.myState.statusMessage=""+e.t0;case 24:case"end":return e.stop()}}),e,this,[[2,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadTrips",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.tripList={},e.prev=1,e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 4:t=e.sent,a=Object(Q["a"])(t.split("\n"));try{for(a.s();!(i=a.n()).done;)n=i.value,n&&(r=JSON.parse(n),this.tripList[r.id]=r)}catch(s){a.e(s)}finally{a.f()}e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"finishedLoadingTrips",value:function(){this.agentGeometry&&this.agentGeometry.dispose(),this.agentGeometry=new Qa(this.tripList,this.midpointX,this.midpointY),this.agentMaterial||(this.agentMaterial=new Za["q"]({uniforms:{simulationTime:{value:0},colorLinks:{value:new Za["d"](this.colors.links)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,blending:Za["l"],depthTest:!0,transparent:!0}));var e=new Za["n"](this.agentGeometry,this.agentMaterial);e.name="agents";var t=this.scene.getObjectByName("agents");t&&this.scene.remove(t),this.scene.add(e),this.camera&&this.renderer.render(this.scene,this.camera),this.myState.statusMessage="loading network"}},{key:"initScene",value:function(){if(this.container=document.getElementById("anim-container"),this.container){this.scene.background=new Za["d"](this.colors.background),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.container.appendChild(this.renderer.domElement);var e=1,t=1e5;this.camera=new Za["m"](170,this.container.clientWidth/this.container.clientHeight,e,t),this.cameraControls=new this.OrbitControl.MapControls(this.camera,this.renderer.domElement),this.cameraControls.enablePan=!0,this.cameraControls.screenSpacePanning=!0,this.cameraControls.enableZoom=!0,this.cameraControls.enableRotate=!1,this.camera.position.set(0,0,750),this.camera.lookAt(0,0,-1),this.cameraControls.update(),this.renderer.render(this.scene,this.camera)}}},{key:"moveCameraWhilePaused",value:function(){this.camera&&(this.myState.isRunning||(this.renderer.render(this.scene,this.camera),this.cameraControls.update(),requestAnimationFrame(this.moveCameraWhilePaused)))}},{key:"setVisibleClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock=(e<10?"0":"")+e+(t<10?":0":":")+t}},{key:"animate",value:function(){var e=this.clock.getElapsedTime(),t=this.timeFactor*this.speed*(e-this.animationTimeSinceUnpaused);this.animationTimeSinceUnpaused=e,this.simulationTime=this.simulationTime+t,this.simulationTime<0&&(this.myState.isRunning=!1,this.simulationTime=0),this.agentMaterial&&(this.agentMaterial.uniforms["simulationTime"].value=this.simulationTime),this.simulationTime*this.timeDirection>=this.nextClockUpdateTime*this.timeDirection&&(this.setVisibleClock(),this.nextClockUpdateTime+=60*this.timeDirection,oi.$emit(oi.SIMULATION_PERCENT,this.simulationTime/86400)),this.camera&&this.renderer.render(this.scene,this.camera),this.cameraControls.update(),this.myState.isRunning&&requestAnimationFrame(this.animate)}}]),i}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],fi.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],fi.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],fi.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],fi.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["b"])({required:!0})],fi.prototype,"speed",void 0),Object(p["a"])([Object(b["b"])({required:!0})],fi.prototype,"vizState",void 0),Object(p["a"])([Object(b["b"])({required:!0})],fi.prototype,"vizDetails",void 0),Object(p["a"])([Object(b["d"])("speed")],fi.prototype,"speedChanged",null),Object(p["a"])([Object(b["d"])("myState.isRunning")],fi.prototype,"playPauseSim",null),Object(p["a"])([Object(b["d"])("myState.colorScheme")],fi.prototype,"switchColorScheme",null),fi=Object(p["a"])([b["a"]],fi);var vi=fi,bi=vi,gi=(a("bdf3"),Object(E["a"])(bi,$a,Xa,!1,null,"4a5ee08a",null)),yi=gi.exports,Si=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal"},[a("div",{staticClass:"modal-background"}),a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[e._v(e._s(e.title))]),a("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){return e.clicked("close")}}})]),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"content"},[a("div",{staticClass:"my-html",domProps:{innerHTML:e._s(e.html)}})])]),a("footer",{staticClass:"modal-card-foot"},[1==e.buttons.length?a("button",{staticClass:"button is-link",on:{click:function(t){return e.clicked(e.buttons[0])}}},[e._v(e._s(e.buttons[0]))]):e._e(),e._l(e.buttons.slice(1),(function(t){return a("button",{key:t,staticClass:"button",on:{click:function(a){return e.clicked(t)}}},[e._v(e._s(t))])}))],2)])])},ki=[],ji=function(e){Object(d["a"])(i,e);var t=Object(m["a"])(i);function i(){var e;return Object(u["a"])(this,i),e=t.apply(this,arguments),e.html="",e}return Object(h["a"])(i,[{key:"mounted",value:function(){this.html=a("818f")}},{key:"clicked",value:function(e){this.$emit("click",e)}}]),i}(b["c"]);Object(p["a"])([Object(b["b"])({required:!0})],ji.prototype,"title",void 0),Object(p["a"])([Object(b["b"])({required:!0})],ji.prototype,"md",void 0),Object(p["a"])([Object(b["b"])({required:!0})],ji.prototype,"buttons",void 0),ji=Object(p["a"])([Object(b["a"])({components:{},props:{}})],ji);var Oi=ji,wi=Oi,xi=(a("a722"),Object(E["a"])(wi,Si,ki,!1,null,"5b9cdc97",null)),Ci=xi.exports,Ti=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"vue-component"}},[a("vue-slider",e._b({staticClass:"slider",on:{dragging:e.dragging,"drag-start":e.dragStart,"drag-end":e.dragEnd},model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.sliderOptions,!1)),a("div",{staticClass:"buttons"},[a("div",{staticClass:"playpause",on:{click:e.toggleSimulation}},[e.state.isRunning?a("i",{staticClass:"button-icon fa fa-1x fa-pause"}):a("i",{staticClass:"button-icon fa fa-1x fa-play"})])])],1)},_i=[],Ri=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.state=x.state,e.sliderValue=0,e.maxSliderVal=1e5,e.sliderOptions={min:0,max:e.maxSliderVal-1,clickable:!1,dotSize:20,duration:0,lazy:!0,tooltip:"active","tooltip-placement":"top","tooltip-formatter":function(t){return e.convertSecondsToClockTimeMinutes(t)}},e}return Object(h["a"])(a,[{key:"toggleSimulation",value:function(){this.$emit("click")}},{key:"convertSecondsToClockTimeMinutes",value:function(e){var t=this.getSecondsFromSlider(e);try{var a=nt(t),i=("00"+a.minutes).slice(-2);return"".concat(a.hours,":").concat(i)}catch(n){return"00:00"}}},{key:"dragStart",value:function(){console.log("start"),oi.$emit(oi.DRAG,-1)}},{key:"dragEnd",value:function(){console.log("end"),oi.$emit(oi.DRAG,-2)}},{key:"dragging",value:function(e){oi.$emit(oi.DRAG,this.getSecondsFromSlider(e))}},{key:"onKeyPressed",value:function(e){"Space"===e.code&&this.toggleSimulation()}},{key:"getSecondsFromSlider",value:function(e){var t=e/this.maxSliderVal*86400;return 86400===t&&(t=86399),t}},{key:"mounted",value:function(){var e=this;oi.$on(oi.SIMULATION_PERCENT,(function(t){e.sliderValue=Math.floor(e.maxSliderVal*t)})),window.addEventListener("keyup",this.onKeyPressed)}},{key:"beforeDestroy",value:function(){oi.$off(oi.SIMULATION_PERCENT),window.removeEventListener("keyup",this.onKeyPressed)}}]),a}(b["c"]);Ri=Object(p["a"])([Object(b["a"])({components:{VueSlider:ze.a},props:{}})],Ri);var Ei=Ri,Di=Ei,Fi=(a("3b17"),Object(E["a"])(Di,Ti,_i,!1,null,"c89e86a2",null)),Ai=Fi.exports,Li=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:""},e.myState={statusMessage:"",clock:"00:00",colorScheme:n.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.globalState=x.state,e.isDarkMode=e.myState.colorScheme===n.DarkMode,e.isLoaded=!1,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e}return Object(h["a"])(a,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 11:a=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",a),this.buildThumbnail();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Ve.a.arraybuffer(t);case 7:a=e.sent,i=this.arrayBufferToBase64(a),i&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(i,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===n.DarkMode,this.updateLegendColors()}},{key:"arrayBufferToBase64",value:function(e){for(var t="",a=new Uint8Array(e),i=a.byteLength,n=0;n<i;n++)t+=String.fromCharCode(a[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){var e=this.myState.colorScheme==n.LightMode?S:k;this.legendBits=[{label:"susceptible",color:e.susceptible},{label:"latently infected",color:e.infectedButNotContagious},{label:"contagious",color:e.contagious},{label:"symptomatic",color:e.symptomatic},{label:"seriously ill",color:e.seriouslyIll},{label:"critical",color:e.critical},{label:"recovered",color:e.recovered}]}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===n.DarkMode?t:e}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.myState.isRunning&&0===this.speed&&(this.speed=1)}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.showHelp=!1,this.updateLegendColors();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){x.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"clickedHelp",value:function(){console.log("HEEELP!"),this.myState.isRunning=!1,this.showHelp=!0,this.myState.isShowingHelp=this.showHelp}},{key:"clickedCloseHelp",value:function(){this.showHelp=!1,this.myState.isShowingHelp=this.showHelp,this.myState.isRunning=!0}},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===n.DarkMode?n.LightMode:n.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],Li.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Li.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Li.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Li.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],Li.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("state.colorScheme")],Li.prototype,"swapTheme",null),Li=Object(p["a"])([Object(b["a"])({components:{AnimationView:yi,ModalMarkdownDialog:Ci,PlaybackControls:Ai,VueSlider:ze.a,ToggleButton:Ne["ToggleButton"]}})],Li),x.commit("registerPlugin",{kebabName:"agent-animation",prettyName:"Agent Animation",description:"birds",filePatterns:["viz-agent-anim*.y?(a)ml"],component:Li});var Pi=Li,Mi=Pi,zi=(a("74c5"),Object(E["a"])(Mi,Ga,Wa,!1,null,"a5660b2a",null)),Ni=zi.exports,Ii=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gl-viz",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?a("link-gl-layer",{staticClass:"anim",attrs:{geojson:e.geojsonData,build:e.csvData,base:e.csvBase,buildData:e.buildData,baseData:e.baseData,showDiffs:e.showDiffs,colors:e.selectedColorRamp,scaleWidth:e.scaleWidth,dark:e.isDarkMode,center:e.center}}):e._e(),e.thumbnail?e._e():a("div",{staticClass:"right-side"},[a("collapsible-panel",{attrs:{darkMode:e.isDarkMode,width:"256",direction:"right"}},[a("div",{staticClass:"panel-items"},[a("div",{staticClass:"panel-item"},[a("h3",[e._v(e._s(e.vizDetails.title))]),a("p",[e._v(e._s(e.vizDetails.description))])]),a("div",{staticClass:"panel-item"},[a("config-panel",{attrs:{header:e.csvData.header,activeColumn:e.csvData.activeColumn,scaleWidth:e.scaleWidth,selectedColorRamp:e.selectedColorRamp,csvData:e.csvData,useSlider:e.vizDetails.useSlider},on:{colors:e.clickedColorRamp,column:e.handleNewDataColumn,slider:e.handleNewDataColumn,scale:e.handleScaleWidthChanged}})],1),e.csvBase.header.length?a("div",{staticClass:"panel-item diff-section"},[a("p",[a("b",[e._v("Show differences")])]),a("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.showDiffs,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.showDiffs=!e.showDiffs}}})],1):e._e()])])],1),!e.thumbnail&&e.myState.statusMessage?a("div",{staticClass:"nav"},[a("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},Vi=[],Bi=(a("cb29"),a("a434"),a("369b")),Hi=a.n(Bi),qi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"time-slider-main-content"},[a("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},Yi=[],Ui=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.sliderValue=e.stops[0]||"...",e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,adsorb:!0,marks:e.stops.filter((function(e,t){return t%6===0})),contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},"tooltip-placement":"bottom",data:e.stops},e}return Object(h["a"])(a,[{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])()],Ui.prototype,"useRange",void 0),Object(p["a"])([Object(b["b"])({required:!0})],Ui.prototype,"stops",void 0),Object(p["a"])([Object(b["d"])("useRange")],Ui.prototype,"changeUseRange",null),Object(p["a"])([Object(b["d"])("sliderValue")],Ui.prototype,"sliderChangedEvent",null),Ui=Object(p["a"])([Object(b["a"])({components:{"vue-slider":ze.a}})],Ui);var Gi=Ui,Wi=Gi,$i=(a("3432"),Object(E["a"])(Wi,qi,Yi,!1,null,"0b2d8627",null)),Xi=$i.exports,Ji=function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"config-panel"},[t.useSlider?i("div",{staticClass:"panel-item"},[t._m(0),t.activeColumn<0?i("button",{staticClass:"button full-width is-warning is-loading",attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"}}):i("time-slider",{staticClass:"time-slider",attrs:{useRange:!1,stops:t.csvData.header},on:{change:t.debounceTimeSlider}})],1):t._e(),t.useSlider?t._e():i("div",{staticClass:"panel-item"},[t._m(1),i("div",{staticClass:"dropdown full-width",class:{"is-active":t.isButtonActive}},[i("div",{staticClass:"dropdown-trigger"},[i("button",{staticClass:"full-width is-warning button",class:{"is-loading":t.activeColumn<0},attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"},on:{click:t.handleClickDropdown}},[i("b",[t._v(t._s(t.buttonTitle))]),t._m(2)])]),i("div",{staticClass:"dropdown-menu",style:{"max-height":"24rem","overflow-y":"auto",border:"1px solid #ccc"},attrs:{id:"dropdown-menu-column-selector",role:"menu"}},[i("div",{staticClass:"dropdown-content"},t._l(t.header,(function(e){return i("a",{staticClass:"dropdown-item",on:{click:function(a){return t.handleSelectColumn(e)}}},[t._v(t._s(e))])})),0)])])]),i("div",{staticClass:"panel-item",class:{"vert-space":!t.useSlider}},[t._m(3),i("div",{staticClass:"options",staticStyle:{display:"flex","flex-direction":"column"}},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.scaleWidthValue,expression:"scaleWidthValue",modifiers:{number:!0}}],staticClass:"input",domProps:{value:t.scaleWidthValue},on:{input:function(e){e.target.composing||(t.scaleWidthValue=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])]),t.activeColumn>-1?i("div",{staticClass:"panel-item color-picker"},[i("p",[i("b",[t._v("Colors"),i("div",{staticClass:"dropdown full-width",class:{"is-active":t.isColorButtonActive}},[i("div",{staticClass:"dropdown-trigger"},[i("img",{staticClass:"color-button",attrs:{src:"/colors/scale-"+t.selectedColorRamp+".png"},on:{click:function(){return e.isColorButtonActive=!e.isColorButtonActive}}})]),i("div",{staticClass:"dropdown-menu",attrs:{id:"dropdown-menu-color-selector",role:"menu"}},[i("div",{staticClass:"dropdown-content",style:{padding:"0 0"}},t._l(Object.keys(t.colorRamps),(function(e){return i("a",{staticClass:"dropdown-item",style:{padding:"0.25rem 0.25rem"},on:{click:function(a){return t.handleColorRamp(e)}}},[i("img",{attrs:{src:"/colors/scale-"+e+".png"}}),i("p",{style:{lineHeight:"1rem",marginBottom:"0.25rem"}},[t._v(t._s(e))])])})),0)])])])])]):t._e()])},Zi=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("b",[e._v("Time of Day")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("b",[e._v("Select Column")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon is-small"},[a("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("b",[e._v("Bandwidths")])])}],Ki=a("b012"),Qi=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.isButtonActive=!1,e.isColorButtonActive=!1,e.scaleWidthValue="250",e.colorRamps={viridis:{png:"scale-viridis.png"},inferno:{png:"scale-inferno.png"},bluered:{png:"scale-salinity.png",diff:!0},picnic:{png:"scale-picnic.png"}},e.debounceScale=Object(Ki["debounce"])(e.gotNewScale,500),e.debounceTimeSlider=Object(Ki["debounce"])(e.changedTimeSlider,250),e}return Object(h["a"])(a,[{key:"mounted",value:function(){this.scaleWidthValue=""+this.scaleWidth}},{key:"handleScaleChanged",value:function(){isNaN(parseFloat(this.scaleWidthValue))||this.debounceScale()}},{key:"gotNewScale",value:function(){this.$emit("scale",parseFloat(this.scaleWidthValue))}},{key:"changedTimeSlider",value:function(e){console.log("new slider!",e),e.length&&1===e.length&&(e=e[0]),this.$emit("slider",e)}},{key:"buttonTitle",get:function(){return-1===this.activeColumn?"Loading":this.header[this.activeColumn]}},{key:"handleClickDropdown",value:function(){this.isButtonActive=!this.isButtonActive}},{key:"handleColorRamp",value:function(e){console.log(e),this.isColorButtonActive=!1,this.$emit("colors",e)}},{key:"clearDropdown",value:function(){console.log("boop"),this.isButtonActive=!1}},{key:"handleSelectColumn",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("panel: selected",t),this.isButtonActive=!1,this.$emit("column",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!0})],Qi.prototype,"activeColumn",void 0),Object(p["a"])([Object(b["b"])({required:!0})],Qi.prototype,"header",void 0),Object(p["a"])([Object(b["b"])({required:!0})],Qi.prototype,"scaleWidth",void 0),Object(p["a"])([Object(b["b"])({required:!0})],Qi.prototype,"csvData",void 0),Object(p["a"])([Object(b["b"])({required:!0})],Qi.prototype,"useSlider",void 0),Object(p["a"])([Object(b["b"])({required:!0})],Qi.prototype,"selectedColorRamp",void 0),Object(p["a"])([Object(b["d"])("scaleWidthValue")],Qi.prototype,"handleScaleChanged",null),Qi=Object(p["a"])([Object(b["a"])({components:{TimeSlider:Xi}})],Qi);var en=Qi,tn=en,an=(a("da6a"),a("c450")),nn=a.n(an),rn=Object(E["a"])(tn,Ji,Zi,!1,null,"55f10c4c",null);"function"===typeof nn.a&&nn()(rn);var sn,on=rn.exports,ln=a("6b0f"),cn=a("548a"),un=a("595c"),hn=a.n(un),dn="pk.eyJ1IjoiZ3JhdXdlbGYiLCJhIjoiY2swem13cDV2MDRqODNtbzRjNHZ1ZnFzcyJ9.NfEs3GesvTdxL3_Wycw6QQ";(function(e){e[e["offset"]=0]="offset",e[e["coordFrom"]=1]="coordFrom",e[e["coordTo"]=2]="coordTo"})(sn||(sn={}));Object(ln["a"])().domain([0,.1,.2,.3,.4,.5,.6,.7,.8,.9]).range([[26,152,80],[102,189,99],[166,217,106],[217,239,139],[255,255,191],[254,224,139],[253,174,97],[244,109,67],[215,48,39],[168,0,0]]),Object(cn["a"])().clamp(!0).domain([0,200]).range([10,2e3]);var mn={latitude:38,longitude:-100,zoom:10};function pn(e){var t=e.geojson,a=void 0===t?[]:t,i=e.center,n=void 0===i?[]:i,r=e.colors,s=void 0===r?"viridis":r,o=e.dark,l=void 0!==o&&o,c=e.scaleWidth,u=void 0===c?250:c,h=e.build,d=void 0===h?{}:h,m=(e.base,e.buildData),p=void 0===m?new Float32Array:m,f=e.baseData,v=void 0===f?new Float32Array:f,b=e.showDiffs,g=void 0!==b&&b,y=d.header,S=d.headerMax,k=d.activeColumn,O=p,w=Object(bt["a"])(n,2),x=w[0],C=w[1],T=Object.assign(mn,{longitude:x,latitude:C}),_=Object(Qe["useState"])({}),R=Object(bt["a"])(_,2),E=R[0],D=R[1],F=hn()({colormap:s,nshades:20,format:"rba"}).map((function(e){return[e[0],e[1],e[2],255]})),A=Object(ln["a"])().domain(new Array(20).fill(0).map((function(e,t){return.05*t}))).range(F),L=l?[80,80,80,40]:[212,212,212,40],P=[0,0,0,0],M=A(0),z=A(1),N=function(e){var t=O[e[sn.offset]];if(!t)return P;if(g){var a=v[e[sn.offset]],i=t-a;return 0===i?0:a<t?z:M}var n=Math.log(t)/Math.log(S[k]);return n<1e-4?L:A(n)},I=function(e){var t=O[e[sn.offset]];if(g){var a=v[e[sn.offset]],i=Math.abs(t-a);return i/u}return t/u};function V(){console.log("click!")}function B(e){var t=e.hoverInfo,a=t.object,i=t.x,n=t.y;if(!a)return null;var r=O[a[sn.offset]],s=0,o=void 0;if(g)s=v[a[sn.offset]],o=r-s;else if(void 0===r)return null;var c=s?et.a.createElement("p",null,"+/- Base: ",o):null;return et.a.createElement("div",{className:"tooltip",style:{backgroundColor:l?"#445":"white",color:l?"white":"#222",padding:"1rem 1rem",position:"absolute",left:i+4,top:n-80,boxShadow:"0px 2px 10px #22222266"}},et.a.createElement("big",null,et.a.createElement("b",null,y[k])),et.a.createElement("p",null,r),c)}var H=[new sa["a"]({id:"linkLayer",data:a,widthUnits:"pixels",widthMinPixels:0,widthMaxPixels:200,pickable:!0,opacity:.8,autoHighlight:!0,parameters:{depthTest:!1},getSourcePosition:function(e){return e[sn.coordFrom]},getTargetPosition:function(e){return e[sn.coordTo]},getColor:N,getWidth:I,onHover:D,updateTriggers:{getColor:{showDiffs:g,dark:l,colors:s,activeColumn:k},getWidth:{showDiffs:g,scaleWidth:u,activeColumn:k}},transitions:{getColor:350,getWidth:350}})];return et.a.createElement(jt["a"],{layers:H,initialViewState:T,controller:!0,pickingRadius:5,getCursor:function(){return"pointer"},onClick:V},et.a.createElement(gt["a"],{reuseMaps:!0,mapStyle:l?j.dark:j.light,preventStyleDiffing:!0,mapboxApiAccessToken:dn}),B({hoverInfo:E}))}b["c"].use(ja["VuePlugin"]);var fn=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.buildColumnValues=[],e.baseColumnValues=[],e.center=[13.45,52.53],e.isButtonActiveColumn=!1,e.scaleWidth=250,e.showDiffs=!1,e.showTimeRange=!1,e.geojsonData=[],e.selectedColorRamp="viridis",e.vizDetails={title:"",description:"",csvFile:"",csvBase:"",useSlider:!1,shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,thumbnail:"",sum:!1},e.myState={statusMessage:"",fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.csvData={header:[],headerMax:[],rows:new Float32Array,activeColumn:-1},e.csvBase={header:[],headerMax:[],rows:new Float32Array,activeColumn:-1},e.buildData=new Float32Array,e.baseData=new Float32Array,e.linkOffsetLookup={},e.numLinks=0,e.globalState=x.state,e.isDarkMode=e.globalState.colorScheme===n.DarkMode,e.isLoaded=!1,e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.csvFilesToLoad=[],e}return Object(h["a"])(a,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.fileSystem)return[];var e,t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(i+="".concat(r,"/"),t.push({label:r,url:"/"+this.myState.fileSystem.url+i}))}}catch(s){n.e(s)}finally{n.f()}return t.push({label:this.vizDetails.title,url:"#"}),x.commit("setBreadCrumbs",t),t}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 11:a=this.vizDetails.title?this.vizDetails.title:"Network Links",this.$emit("title",a);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Ve.a.arraybuffer(t);case 7:a=e.sent,i=this.arrayBufferToBase64(a),i&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(i,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===n.DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",a=new Uint8Array(e),i=a.byteLength,n=0;n<i;n++)t+=String.fromCharCode(a[n]);return window.btoa(t)}},{key:"buttonTitle",get:function(){return-1===this.csvData.activeColumn?"Loading...":this.csvData.header[this.csvData.activeColumn]}},{key:"clickedColorRamp",value:function(e){this.selectedColorRamp=e,console.log(this.selectedColorRamp)}},{key:"handleScaleWidthChanged",value:function(e){console.log(e),this.scaleWidth=e}},{key:"handleNewDataColumn",value:function(e){console.log("handling it:",e);var t=this.csvData.header.indexOf(e);if(-1!==t){if(console.log("got it"),!this.csvData.headerMax[t]){var a=0;this.buildColumnValues[t].forEach((function(e){return a=Math.max(a,e)})),a&&(this.csvData.headerMax[t]=a)}console.log("setting it"),this.buildData=this.buildColumnValues[t],this.baseData=this.baseColumnValues[t],this.csvData.activeColumn=t,this.isButtonActiveColumn=!1,console.log("dit it")}}},{key:"findCenter",value:function(e){return[13.45,52.53]}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.generateBreadcrumbs(),this.myState.statusMessage="Dateien laden...",e.next=10,this.loadGeojsonFeatures();case 10:if(t=e.sent,t){e.next=13;break}return e.abrupt("return");case 13:console.log("5: ok"),this.geojsonData=t,this.isLoaded=!0,this.center=this.findCenter([]),this.buildThumbnail(),this.myState.statusMessage="",console.log("999: ok"),this.loadCSVFiles();case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadGeojsonFeatures",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,n,r,s,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.linkOffsetLookup={},this.numLinks=0,console.log("1: load network"),this.myState.statusMessage="Loading network...",console.log({myState:this.myState}),t="/".concat(this.myState.subfolder,"/").concat(this.vizDetails.geojsonFile),console.log(t),e.next=10,this.myState.fileApi.getFileText(t);case 10:for(a=e.sent,console.log("2: json network"),n=JSON.parse(a),console.log({json:n}),console.log("3: build index"),this.numLinks=n.features.length,r=[],s=0;s<this.numLinks;s++)o=n.features[s],l=[s,o.geometry.coordinates[0],o.geometry.coordinates[1]],r.push(l),this.linkOffsetLookup[o.properties.id]=s;return console.log("4: done!"),console.log({linkElements:r}),e.abrupt("return",r);case 23:return e.prev=23,e.t0=e["catch"](0),this.myState.statusMessage=""+e.t0,this.$store.commit("setStatus",{type:i.WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(this.vizDetails.geojsonFile)}),e.abrupt("return",null);case 28:case"end":return e.stop()}}),e,this,[[0,23]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){x.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"handleClickColumnSelector",value:function(){console.log("click!"),this.isButtonActiveColumn=!this.isButtonActiveColumn}},{key:"loadCSVFiles",value:function(){this.myState.statusMessage="Loading CSV data...",this.csvFilesToLoad=[this.vizDetails.csvFile],this.vizDetails.csvBase&&this.csvFilesToLoad.push(this.vizDetails.csvBase),this.loadCSVFile(this.csvFilesToLoad[0])}},{key:"finishedLoadingCSV",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s,o,l,c,u,h,d,m,p,f=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(a=this.csvFilesToLoad.shift(),console.log("FINISHED PARSING: ",a),this.myState.statusMessage="Analyzing...",i=[],n=t.data[0].length-(this.vizDetails.useSlider?0:1),console.log("number of columns",n),r=0;r<n;r++)i.push(new Float32Array(this.numLinks));s=0,o=Object(Q["a"])(t.data.splice(1)),e.prev=9,c=function(){var e=l.value,t=f.linkOffsetLookup[e[0].toString()];if(void 0===t)return"continue";if(f.vizDetails.useSlider){var a=e.slice(1),n=a.reduce((function(e,t){return e+t}),0);s=Math.max(s,n),i[0][t]=n,a.forEach((function(e,a){i[a+1][t]=e}))}else{var r=e.slice(1);r.forEach((function(e,a){i[a][t]=e}))}},o.s();case 12:if((l=o.n()).done){e.next=18;break}if(u=c(),"continue"!==u){e.next=16;break}return e.abrupt("continue",16);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](9),o.e(e.t0);case 23:return e.prev=23,o.f(),e.finish(23);case 26:h=t.data[0],d=h.slice(1),this.vizDetails.useSlider&&d.unshift("All"),m=d.map((function(e){return e.replace(":00:00","")})),p={header:m,headerMax:this.vizDetails.useSlider?new Array(this.csvData.header.length).fill(s):[],rows:new Float32Array,activeColumn:-1},this.csvFilesToLoad.length?(this.buildColumnValues=i,this.csvData=p,this.handleNewDataColumn(this.csvData.header[0])):this.vizDetails.csvBase?(this.baseColumnValues=i,this.csvBase=p):(this.buildColumnValues=i,this.csvData=p,this.handleNewDataColumn(this.csvData.header[0])),this.csvFilesToLoad.length?(this.myState.statusMessage="Loading CSV Baseline...",this.loadCSVFile(this.csvFilesToLoad[0])):(this.myState.statusMessage="",this.handleNewDataColumn(this.csvData.header[0]));case 33:case"end":return e.stop()}}),e,this,[[9,20,23,26]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadCSVFile",value:function(e){console.log("7a: loading CSV:",e);var t=this.myState.fileApi.cleanURL("".concat(this.myState.subfolder,"/").concat(e));try{Hi.a.parse(t,{download:!0,header:!1,skipEmptyLines:!0,dynamicTyping:!0,worker:!0,complete:this.finishedLoadingCSV})}catch(a){return console.error(a),this.$store.commit("setStatus",{type:i.WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(e)}),{allColumns:[],header:[],headerMax:[]}}}},{key:"changedTimeSlider",value:function(e){console.log("new slider!",e),e.length&&1===e.length&&(e=e[0]),this.handleNewDataColumn(e)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],fn.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],fn.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],fn.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],fn.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],fn.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("globalState.colorScheme")],fn.prototype,"swapTheme",null),fn=Object(p["a"])([Object(b["a"])({components:{CollapsiblePanel:Ke,ConfigPanel:on,LinkGlLayer:pn,TimeSlider:Xi,ToggleButton:Ne["ToggleButton"]}})],fn),x.commit("registerPlugin",{kebabName:"links-gl",prettyName:"Links",description:"Network link attributes",filePatterns:["viz-gl-link*.y?(a)ml"],component:fn});var vn=fn,bn=vn,gn=(a("9deb"),a("ee8b")),yn=a.n(gn),Sn=Object(E["a"])(bn,Ii,Vi,!1,null,"2ede62d7",null);"function"===typeof yn.a&&yn()(Sn);var kn=Sn.exports,jn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{background:e.urlThumbnail},attrs:{id:"link-container"}},[e.thumbnail?e._e():a("div",{staticClass:"map-container"},[a("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.myState.loadingText?e._e():a("left-data-panel",{staticClass:"left-panel"},[a("div",{staticClass:"info-header"},[a("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 1rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?a("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[a("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),a("div",{staticClass:"widgets"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.headers.length>2,expression:"headers.length > 2"}],staticClass:"uhrzeit"},[a("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?a("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),a("label",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var a=e.showTimeRange,i=t.target,n=!!i.checked;if(Array.isArray(a)){var r=null,s=e._i(a,r);i.checked?s<0&&(e.showTimeRange=a.concat([r])):s>-1&&(e.showTimeRange=a.slice(0,s).concat(a.slice(s+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")])],1),a("h4",{staticClass:"heading"},[e._v("Linienbreiten")]),e.headers.length>0?a("scale-slider",{staticClass:"time-slider",attrs:{stops:e.SCALE_STOPS},on:{change:e.bounceScale}}):e._e(),a("label",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showAllRoads,expression:"showAllRoads"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showAllRoads)?e._i(e.showAllRoads,null)>-1:e.showAllRoads},on:{change:function(t){var a=e.showAllRoads,i=t.target,n=!!i.checked;if(Array.isArray(a)){var r=null,s=e._i(a,r);i.checked?s<0&&(e.showAllRoads=a.concat([r])):s>-1&&(e.showAllRoads=a.slice(0,s).concat(a.slice(s+1)))}else e.showAllRoads=n}}}),e._v(" Gesamtes Straßennetz anzeigen")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.loadingText,expression:"myState.loadingText"}],staticClass:"status-blob"},[a("h4",[e._v(e._s(e.myState.loadingText))])])],1)},On=[],wn=(a("498a"),a("c26a")),xn=a("323e"),Cn=a.n(xn),Tn=a("a79f"),_n=a("595b");function Rn(e,t){return Object(Tn["a"])(e,"WGS84",t)}Tn["a"].defs([["EPSG:2048","+proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:31468","+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +datum=potsdam +units=m +no_defs"],["EPSG:25833","+proj=utm +zone=33 +ellps=GRS80 +units=m +no_defs"],["EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs"],["EPSG:2039","+proj=tmerc +lat_0=31.73439361111111 +lon_0=35.20451694444445 +k=1.0000067 +x_0=219529.584 +y_0=626907.39 +ellps=GRS80 +towgs84=-48,55,52,0,0,0,0 +units=m +no_defs"]]),Tn["a"].defs("DK4",Tn["a"].defs("EPSG:31468")),Tn["a"].defs("GK4",Tn["a"].defs("EPSG:31468")),Tn["a"].defs("ITM",Tn["a"].defs("EPSG:2039")),Tn["a"].defs("Cottbus",Tn["a"].defs("EPSG:25833")),Tn["a"].defs("Berlin",Tn["a"].defs("EPSG:31468")),Tn["a"].defs("South Africa",Tn["a"].defs("EPSG:2048"));var En={toLngLat:Rn},Dn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"datapanel"}},[a("div",{staticClass:"content-area",class:{"is-hidden":e.isHidden,bye:e.isLeaving}},[e.title?a("div",{staticClass:"info-header"},[a("h3",{staticStyle:{padding:"0.5rem 3rem","font-size":"1rem","font-weight":"normal",color:"white"}},[e._v(e._s(e.title))])]):e._e(),a("div",{staticClass:"top-area"},[e._t("default")],2)]),a("div",{staticClass:"restore-button",class:{"add-margin":!e.isHidden}},[a("button",{staticClass:"button is-small hide-button",on:{click:e.toggleHidePanel}},[e.isHidden?e._e():a("i",{staticClass:"fa fa-arrow-left"}),e.isHidden?a("i",{staticClass:"fa fa-arrow-right"}):e._e()])])])},Fn=[],An=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.isHidden=!1,e.isLeaving=!1,e}return Object(h["a"])(a,[{key:"toggleHidePanel",value:function(){var e=this;this.isHidden?this.isHidden=!this.isHidden:(this.isLeaving=!0,setTimeout((function(){e.isHidden=!0,e.isLeaving=!1}),300))}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({type:String})],An.prototype,"title",void 0),An=Object(p["a"])([b["a"]],An);var Ln=An,Pn=Ln,Mn=(a("90da"),Object(E["a"])(Pn,Dn,Fn,!1,null,"82194458",null)),zn=Mn.exports,Nn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"time-slider-main-content"},[a("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},In=[],Vn=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.sliderValue=1,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(h["a"])(a,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.scaleSlider.data=this.stops}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!0})],Vn.prototype,"stops",void 0),Object(p["a"])([Object(b["d"])("sliderValue")],Vn.prototype,"sliderChangedEvent",null),Vn=Object(p["a"])([Object(b["a"])({components:{"vue-slider":ze.a}})],Vn);var Bn=Vn,Hn=Bn,qn=(a("acace"),Object(E["a"])(Hn,Nn,In,!1,null,"2fde1874",null)),Yn=qn.exports,Un=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"time-slider-main-content"},[a("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},Gn=[],Wn=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(h["a"])(a,[{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}},{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=nt(e),a=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(a)}catch(i){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=nt(e),a=("00"+t.minutes).slice(-2),i=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(a,":").concat(i)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])()],Wn.prototype,"initialTime",void 0),Object(p["a"])([Object(b["b"])()],Wn.prototype,"useRange",void 0),Object(p["a"])([Object(b["b"])()],Wn.prototype,"stops",void 0),Object(p["a"])([Object(b["d"])("initialTime")],Wn.prototype,"initialTimeChanged",null),Object(p["a"])([Object(b["d"])("useRange")],Wn.prototype,"changeUseRange",null),Object(p["a"])([Object(b["d"])("stops")],Wn.prototype,"setStops",null),Object(p["a"])([Object(b["d"])("sliderValue")],Wn.prototype,"sliderChangedEvent",null),Wn=Object(p["a"])([Object(b["a"])({components:{"vue-slider":ze.a}})],Wn);var $n=Wn,Xn=$n,Jn=(a("83c7"),Object(E["a"])(Xn,Un,Gn,!1,null,"e2ace8c0",null)),Zn=Jn.exports,Kn=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.SCALE_STOPS=[.01,.1,.2,.5,1,2,5,10,100],e.WIDTH_SCALE=.005,e.globalState=x.state,e.showAllRoads=!1,e.mapExtentXYXY=[180,90,-180,-90],e.mapId="m".concat(Math.floor(Math.random()*Math.floor(1e10))),e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,loadingText:"Dateien laden...",visualization:null,project:{}},e.vizDetails={csvFile:"",csvFile2:"",shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,title:"",description:"",thumbnail:"",sum:!1},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.sampleRate=1,e.geojson={},e.headers=[],e.showTimeRange=!1,e.bounceTimeSlider=Object(Ki["debounce"])(e.changedTimeSlider,200),e.bounceScale=Object(Ki["debounce"])(e.changedScale,200),e.currentTimeBin=e.TOTAL_MSG,e.currentScale=e.SCALE_STOPS[0],e.sumElements=[],e.dataset={},e.idLookup={},e.dailyGrandTotal=0,e.dailyTotals=[],e.idColumn="",e.hoveredStateId=null,e.currentChart={},e}return Object(h["a"])(a,[{key:"toggleShowAllRoads",value:function(){this.changedTimeSlider(this.currentTimeBin)}},{key:"toggleShowTimeRange",value:function(){!this.showTimeRange&&this.headers.length&&(this.currentTimeBin=this.headers[0]),this.changedTimeSlider(this.currentTimeBin)}},{key:"destroyed",value:function(){x.commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=7;break}return this.myState.loadingText="",e.abrupt("return");case 7:this.generateBreadcrumbs(),this.setupMap();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this.mapExtentXYXY[0]=Math.min(this.mapExtentXYXY[0],e[0]),this.mapExtentXYXY[1]=Math.min(this.mapExtentXYXY[1],e[1]),this.mapExtentXYXY[2]=Math.max(this.mapExtentXYXY[2],e[0]),this.mapExtentXYXY[3]=Math.max(this.mapExtentXYXY[3],e[1])}},{key:"setMapExtent",value:function(){this.mapExtentXYXY=Object(_n["bbox"])(this.geojson),localStorage.setItem(this.myState.subfolder+"-bounds",JSON.stringify(this.mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:10,bottom:10,right:10,left:250},animate:!1};this.map.fitBounds(this.mapExtentXYXY,e)}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"setupMap",value:function(){try{this.map=new v.a.Map({bearing:0,container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/streets-v11",pitch:0}),this.findCenter(),this.map.on("style.load",this.mapIsReady),this.map.addControl(new v.a.NavigationControl,"top-right")}catch(e){console.log(e)}}},{key:"findCenter",value:function(){try{var e=localStorage.getItem(this.myState.subfolder+"-bounds");if(e){var t=JSON.parse(e),a={top:5,bottom:5,right:5,left:30};this.thumbnail?this.map.fitBounds(t,{animate:!1}):this.map.fitBounds(t,{padding:a,animate:!1})}}catch(i){}}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 10:this.$emit("title",this.vizDetails.title),this.vizDetails.shpFileIdProperty||(this.vizDetails.shpFileIdProperty="Id"),this.sampleRate=this.vizDetails.sampleRate?this.vizDetails.sampleRate:1,this.buildThumbnail(),Cn.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,Ve.a.arraybuffer(t);case 7:a=e.sent,i=this.arrayBufferToBase64(a),i&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(i,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"arrayBufferToBase64",value:function(e){for(var t="",a=new Uint8Array(e),i=a.byteLength,n=0;n<i;n++)t+=String.fromCharCode(a[n]);return window.btoa(t)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"loadFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.myState.loadingText="Dateien laden...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile);case 4:if(t=e.sent,a="",!this.vizDetails.csvFile2){e.next=10;break}return e.next=9,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile2);case 9:a=e.sent;case 10:if(i=null,n=null,r=null,!this.vizDetails.geojsonFile){e.next=28;break}return console.log("reading",this.vizDetails.geojsonFile),e.next=17,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.geojsonFile);case 17:if(s=e.sent,!s){e.next=24;break}return e.next=21,Object(He["a"])(s);case 21:e.t0=e.sent,e.next=25;break;case 24:e.t0=null;case 25:r=e.t0,e.next=41;break;case 28:return console.log("reading",this.vizDetails.shpFile),e.next=31,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.shpFile);case 31:return o=e.sent,e.next=34,Ve.a.arraybuffer(o);case 34:return i=e.sent,e.next=37,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.dbfFile);case 37:return l=e.sent,e.next=40,Ve.a.arraybuffer(l);case 40:n=e.sent;case 41:return e.abrupt("return",{shpFile:i,dbfFile:n,linkFlows:a||t,linkBaseFlows:a?t:a,geojsonFile:r});case 44:return e.prev=44,e.t1=e["catch"](0),console.error({e:e.t1}),this.myState.loadingText=""+e.t1,e.abrupt("return",null);case 49:case"end":return e.stop()}}),e,this,[[0,44]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedTimeSlider",value:function(e){e.length&&1===e.length&&(e=e[0]),this.currentTimeBin=e;var t=this.WIDTH_SCALE*this.currentScale;if(0==this.showTimeRange){this.map.setPaintProperty("my-layer","line-width",["*",t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#ff0",["==",["get",e],null],"#8ca",["<",["get",e],0],"#5f5",this.vizDetails.csvFile2?"#900":"#55b"]);var a=this.showAllRoads?null:["!=",["get",this.currentTimeBin],null];this.map.setFilter("my-layer",a)}else{var i,n=["+"],r=!1,s=Object(Q["a"])(this.headers);try{for(s.s();!(i=s.n()).done;){var o=i.value;o===e[0]&&(r=!0),o!==this.TOTAL_MSG&&(r&&n.push(["get",o]),o===e[1]&&(r=!1))}}catch(l){s.e(l)}finally{s.f()}this.map.setPaintProperty("my-layer","line-width",["*",t,n]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,n]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#0f6",["==",n,null],"#8ca",["<",n,0],"#fc0","#559"])}}},{key:"processHeaders",value:function(e){var t=e.split("\n"),a=t[0].indexOf(";")>0?";":",",i=t[0].split(a).map((function(e){return e.trim()}));this.headers=[this.TOTAL_MSG].concat(i.slice(1))}},{key:"processGeojsonFile",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,qe["run"](Ue.a.inflateAsync(t.geojsonFile,{to:"string"}));case 3:return a=e.sent,i=JSON.parse(a),n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",r=0,e.next=9,qe["forEachAsync"](i.features,(function(e){e.properties&&(e.id=r++,s.idLookup[e.properties[n]]=e.id)}));case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"processShapefile",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,wn["a"](t.shpFile,t.dbfFile);case 3:return a=e.sent,this.myState.loadingText="Converting coordinates...",i=0,n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",r=0,e.next=10,qe["forEachAsync"](a.features,(function(e){e.properties&&(e.id=r++,s.idLookup[e.properties[n]]=e.id);try{"MultiPolygon"===e.geometry.type?s.convertMultiPolygonCoordinatesToWGS84(e):"LineString"===e.geometry.type?s.convertLineStringCoordinatesToWGS84(e):s.convertPolygonCoordinatesToWGS84(e)}catch(t){i++,i<5&&(console.error("ERR with feature: "+e),console.error(t))}}));case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertLineStringCoordinatesToWGS84",value:function(e){var t,a=[],i=e.geometry.coordinates,n=Object(Q["a"])(i);try{for(n.s();!(t=n.n()).done;){var r=t.value,s=En.toLngLat(this.vizDetails.projection,r);a.push(s),this.updateMapExtent(s)}}catch(o){n.e(o)}finally{n.f()}i.length=0,i.push.apply(i,a)}},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,a=Object(Q["a"])(e.geometry.coordinates);try{for(a.s();!(t=a.n()).done;){var i,n=t.value,r=[],s=Object(Q["a"])(n);try{for(s.s();!(i=s.n()).done;){var o=i.value,l=En.toLngLat(this.vizDetails.projection,o);r.push(l)}}catch(c){s.e(c)}finally{s.f()}n.length=0,n.push.apply(n,r)}}catch(c){a.e(c)}finally{a.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,a=Object(Q["a"])(e.geometry.coordinates);try{for(a.s();!(t=a.n()).done;){var i,n=t.value,r=n[0],s=[],o=Object(Q["a"])(r);try{for(o.s();!(i=o.n()).done;){var l=i.value,c=Object(Tn["a"])(this.vizDetails.projection,"WGS84",l);s.push(c)}}catch(u){o.e(u)}finally{o.f()}n[0]=s}}catch(u){a.e(u)}finally{a.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,a=[],i=Object(Q["a"])(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;Array.isArray(n[0])?a.push(this.recurseWGS84(n)):a.push(Object(Tn["a"])(this.vizDetails.projection,"WGS84",n))}}catch(r){i.e(r)}finally{i.f()}return a}},{key:"mapIsReady",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,t){e.next=6;break}return this.myState.loadingText="Fehler mit Dateien, sorry",e.abrupt("return");case 6:if(!this.vizDetails.geojsonFile){e.next=12;break}return e.next=9,this.processGeojsonFile(t);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,this.processShapefile(t);case 14:e.t0=e.sent;case 15:return this.geojson=e.t0,this.setMapExtent(),e.next=19,this.processCSVFiles(t);case 19:return this.processHeaders(t.linkFlows),e.next=22,this.calculateLinkProperties(this.geojson);case 22:return this.addJsonToMap(this.geojson),this.changedScale(1),this.setupMapListeners(),this.myState.loadingText="",e.next=28,this.$nextTick();case 28:Cn.a.done();case 29:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processCSVFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.dataset={},a=",";try{i=t.linkFlows.substring(0,t.linkFlows.indexOf("\n")),i.indexOf(",")>-1?a=",":i.indexOf(";")>-1?a=";":i.indexOf("\t")>-1?a="\t":i.indexOf(" ")>-1&&(a=" ")}catch(o){a=","}return n=Hi.a.parse(t.linkFlows,{header:!0,dynamicTyping:!0,delimiter:a}),r=n.meta.fields[0],this.idColumn=r,e.next=8,qe["forEachAsync"](n.data,(function(e){var t=e[r],a=s.idLookup[t];s.dataset[a]=e}));case 8:if(!t.linkBaseFlows){e.next=11;break}return e.next=11,this.subtractBaseFlows(t.linkBaseFlows,a);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subtractBaseFlows",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t,a){var i,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText=this.vizDetails.sum?"Summen berechnen...":"Differenzen berechnen...",i=Hi.a.parse(t,{header:!0,dynamicTyping:!0,delimiter:a}),n=i.meta.fields[0],r=0,e.next=6,qe["forEachAsync"](i.data,(function(e){var t=e[n],a=s.idLookup[t];if(s.dataset[a]){var i=s.dataset[a];if(s.vizDetails.sum)for(var o=0,l=Object.keys(e);o<l.length;o++){var c=l[o];i[c]=i[c]+e[c]}else for(var u=0,h=Object.keys(e);u<h.length;u++){var d=h[u];i[d]=i[d]-e[d]}s.dataset[a]=i,r++}else{if(!s.vizDetails.sum)for(var m=0,p=Object.keys(e);m<p.length;m++){var f=p[m];isNaN(e[f])||(e[f]=-1*e[f])}s.dataset[a]=e}}));case 6:console.log(r,"total DIFFs happened");case 7:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"calculateLinkProperties",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Berechnen...",e.next=3,qe["forEachAsync"](t.features,(function(e){var t=e.id,i=a.dataset[t];if(i){for(var n=0,r=0,s=Object.keys(i);r<s.length;r++){var o=s[r];if(o!==a.idColumn&&!isNaN(i[o])){var l=i[o]/a.sampleRate;e.properties[o]=l,n+=l,a.dailyTotals[o]||(a.dailyTotals[o]=0),a.dailyTotals[o]+=l}}e.properties[a.TOTAL_MSG]=n}}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addJsonToMap",value:function(e){this.map&&(this.map.addSource("my-data",{data:e,type:"geojson"}),this.map.addLayer({id:"my-layer",source:"my-data",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-offset":["+",.25,["*",.5,["get","width"]]],"line-color":["case",["boolean",["feature-state","hover"],!1],"#fb0","#559"]},layout:{"line-cap":"round"}}))}},{key:"setupMapListeners",value:function(){var e=this;if(this.map){var t="my-layer",a=this;this.map.on("click",t,(function(t){e.clickedOnElement(t)})),this.map.on("mousemove",t,(function(t){e.map&&(e.map.getCanvas().style.cursor=t?"pointer":"auto")})),this.map.on("mouseleave",t,(function(){e.map&&(e.map.getCanvas().style.cursor="auto")})),this.map.on("mousemove",t,(function(e){var t=a.map.queryRenderedFeatures(e.point);t.length>0&&(a.hoveredStateId&&a.map.setFeatureState({source:"my-data",id:a.hoveredStateId},{hover:!1}),a.hoveredStateId=t[0].id,a.map.setFeatureState({source:"my-data",id:a.hoveredStateId},{hover:!0}))})),this.map.on("mouseleave",t,(function(){a.hoveredStateId&&a.map.setFeatureState({source:"my-data",id:a.hoveredStateId},{hover:!1}),a.hoveredStateId=null}))}}},{key:"clickedOnElement",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:if(a=t.features[0],i=[],n=0,!a.properties){e.next=28;break}r=this.headers,s=Object(Q["a"])(r),e.prev=8,s.s();case 10:if((o=s.n()).done){e.next=20;break}if(l=o.value,l!==this.TOTAL_MSG){e.next=14;break}return e.abrupt("continue",18);case 14:c=a.properties[l],c||(c=0),n+=c,i.push({hour:l,trips:c});case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](8),s.e(e.t0);case 25:return e.prev=25,s.f(),e.finish(25);case 28:n||(n=0),u='<p style="text-align: center; min-width: max-content;"><b>Details</b><br/>Insgesamt: '+n+"</p>",n&&(u+='<div id="chart" style="width: 300px; height:250px;"></div>'),this._popup&&this._popup.remove(),this._popup=new v.a.Popup({closeOnClick:!0}).setLngLat(t.lngLat).setHTML(u),this._popup.addTo(this.map),console.log({data:i}),n&&(this.currentChart=new Morris.Bar({element:"chart",data:i,stacked:!0,xkey:"hour",ykeys:["trips"],labels:["Trips"],barColors:["#3377cc"],xLabels:"Uhr",xLabelAngle:90,hideHover:!0,parseTime:!1,resize:!0}));case 36:case"end":return e.stop()}}),e,this,[[8,22,25,28]])})));function t(t){return e.apply(this,arguments)}return t}()}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],Kn.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Kn.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Kn.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Kn.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("showAllRoads")],Kn.prototype,"toggleShowAllRoads",null),Object(p["a"])([Object(b["d"])("showTimeRange")],Kn.prototype,"toggleShowTimeRange",null),Kn=Object(p["a"])([Object(b["a"])({components:{LeftDataPanel:zn,ScaleSlider:Yn,TimeSlider:Zn}})],Kn),x.commit("registerPlugin",{kebabName:"link-volumes",prettyName:"Volumes",description:"Aggregate volumes on network links",filePatterns:["viz-link*.y?(a)ml"],component:Kn});var Qn=Kn,er=Qn,tr=(a("8739"),Object(E["a"])(er,jn,On,!1,null,"1b80fca6",null)),ar=tr.exports,ir=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.myState.yamlConfig?a("div",{attrs:{id:"sankey-container"}},[a("div",{staticClass:"main-area"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.thumbnail,expression:"myState.thumbnail"}],staticClass:"labels"},[a("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[a("h3",{staticClass:"center"},[e._v(e._s(e.vizDetails.title))]),a("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))]),a("p",{staticClass:"center"},[e._v(e._s(e.totalTrips.toLocaleString())+" total trips")])]),a("svg",{attrs:{id:e.cleanConfigId}})])]):e._e()},nr=[],rr=(a("caad"),a("ed18")),sr=a("00a5"),or=a("df19"),lr=a("a968"),cr=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csv:"",title:"",description:""},e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(h["a"])(a,[{key:"cleanConfigId",get:function(){var e=this.myState.yamlConfig.replace(/[\W_]+/g,"");return e}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:this.thumbnail||this.generateBreadcrumbs();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:t=e.sent,t&&(this.jsonChart=this.processInputs(t)),this.loadingText="",this.doD3(),Cn.a.done();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loadingText="Loading files...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 4:return t=e.sent,this.vizDetails=Fe.a.parse(t),this.$emit("title",this.vizDetails.title),e.next=9,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csv);case 9:return a=e.sent,e.abrupt("return",{flows:a});case 13:e.prev=13,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 18:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(e){this.loadingText="Building node graph...";var t=[],a=[],i=[];this.totalTrips=0;var n,r=e.flows.split("\n"),s=Object(Q["a"])(r.slice(1));try{for(s.s();!(n=s.n()).done;){var o=n.value,l=o.trim().split(";");if(l&&!(l.length<2)){t.includes(l[0])||t.push(l[0]),a.includes(l[1])||a.push(l[1]);var c=parseFloat(l[2]);c>0&&(i.push([l[0],l[1],c]),this.totalTrips+=c)}}}catch(v){s.e(v)}finally{s.f()}var u={nodes:[],links:[]},h={},d={};t.forEach((function(e,t){u.nodes.push({id:t,title:e}),h[e]=t})),a.forEach((function(e,a){u.nodes.push({id:a+t.length,title:e}),d[e]=a+t.length}));for(var m=0,p=i;m<p.length;m++){var f=p[m];u.links.push({source:h[f[0]],target:d[f[1]],value:f[2]})}return u}},{key:"doD3",value:function(){var e=this.jsonChart;e.order=[[[4,1,2,3,0,5]],[[6,7,8,9,10,11]]],e.alignTypes=!0,e.alignLinkTypes=!0;var t=Object(rr["sankey"])().extent([[50,-50],[750,800]]).nodeWidth(3),a=Object(or["a"])(lr["a"]),i=Object(rr["sankeyDiagram"])().linkColor((function(e){var t=a(e.source.id);return t+"bb"}));Object(sr["a"])("#"+this.cleanConfigId).datum(t(e)).call(i).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 800 800")}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],cr.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],cr.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],cr.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],cr.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],cr.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("yamlConfig")],cr.prototype,"changedYaml",null),Object(p["a"])([Object(b["d"])("subfolder")],cr.prototype,"changedSubfolder",null),cr=Object(p["a"])([Object(b["a"])({components:{}})],cr),x.commit("registerPlugin",{kebabName:"sankey-diagram",prettyName:"Flow Diagram",description:"Depicts flows between choices",filePatterns:["sankey*.y?(a)ml"],component:cr});var ur=cr,hr=ur,dr=(a("655d"),Object(E["a"])(hr,ir,nr,!1,null,"4b44700b",null)),mr=dr.exports,pr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.myState.yamlConfig?a("div",{attrs:{id:"vega-container"}},[a("div",{staticClass:"main-area"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.thumbnail,expression:"myState.thumbnail"}],staticClass:"labels"},[a("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[a("h3",{staticClass:"center"},[e._v(e._s(e.title))]),a("h5",{staticClass:"center"},[e._v(e._s(e.description))])]),e.hasFacets?a("div",{staticClass:"chart-area center-chart"},[a("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})]):e._e(),e.hasFacets?e._e():a("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})])]):e._e()},fr=[],vr=a("87e7"),br=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={title:"",description:""},e.title="",e.description="",e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(h["a"])(a,[{key:"cleanConfigId",get:function(){return this.myState.yamlConfig.replace(/[\W_]+/g,"")}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:this.thumbnail||this.generateBreadcrumbs();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"hasFacets",get:function(){return!!this.vizDetails&&(!!this.vizDetails.encoding&&!!(this.vizDetails.encoding.facet||this.vizDetails.encoding.row||this.vizDetails.encoding.column))}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:this.vizDetails=e.sent,this.vizDetails&&(this.jsonChart=this.processInputs()),this.loadingText="",Cn.a.done();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={data:{}},e.prev=1,this.loadingText="Loading chart...",e.next=5,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.description=t.description?t.description:"",this.title=t.title?t.title:this.myState.yamlConfig.substring(0,this.myState.yamlConfig.length-10).replace(/_/g," "),this.$emit("title",this.title),e.next=17;break;case 11:return e.prev=11,e.t0=e["catch"](1),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url),e.abrupt("return");case 17:if(!t.data.url){e.next=38;break}if(e.prev=18,a="",i=this.myState.subfolder+"/"+t.data.url,!t.data.url.endsWith(".json")){e.next=28;break}return e.next=24,this.myState.fileApi.getFileJson(i);case 24:a=e.sent,a&&(t.data={values:a}),e.next=33;break;case 28:if(!t.data.url.endsWith(".csv")){e.next=33;break}return e.next=31,this.myState.fileApi.getFileText(i);case 31:a=e.sent,a&&(t.data={values:a,format:{type:"csv"}});case 33:e.next=38;break;case 35:e.prev=35,e.t1=e["catch"](18),console.warn(e.t1);case 38:return e.abrupt("return",t);case 39:case"end":return e.stop()}}),e,this,[[1,11],[18,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){this.loadingText="Building chart...";var e={export:!0,source:!1,compiled:!1,editor:!1},t={actions:!this.thumbnail&&e,hover:!0,scaleFactor:2,padding:{top:2,left:8,right:8,bottom:8}};if(this.thumbnail&&this.vizDetails.encoding)for(var a=0,i=Object.keys(this.vizDetails.encoding);a<i.length;a++){var n=i[a];this.vizDetails.encoding[n].legend=null}Object(vr["a"])("#".concat(this.cleanConfigId),this.vizDetails,t)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],br.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],br.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],br.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],br.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],br.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("yamlConfig")],br.prototype,"changedYaml",null),Object(p["a"])([Object(b["d"])("subfolder")],br.prototype,"changedSubfolder",null),br=Object(p["a"])([Object(b["a"])({components:{}})],br),x.commit("registerPlugin",{kebabName:"vega-lite",prettyName:"Chart",description:"Interactive chart visualization",filePatterns:["*.vega.json"],component:br});var gr=br,yr=gr,Sr=(a("0c3c"),Object(E["a"])(yr,pr,fr,!1,null,"664f8ede",null)),kr=Sr.exports,jr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycomponent",attrs:{id:e.containerId}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.thumbnail&&e.loadingText,expression:"!thumbnail && loadingText"}],staticClass:"status-blob"},[a("p",[e._v(e._s(e.loadingText))])]),e.thumbnail||e.isMobile()?e._e():a("div",{staticClass:"map-complications"},[a("legend-box",{staticClass:"complication",attrs:{rows:e.legendRows}}),a("scale-box",{staticClass:"complication",attrs:{rows:e.scaleRows}})],1),a("div",{staticClass:"map-container"},[a("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.loadingText?e._e():a("left-data-panel",{staticClass:"left-panel"},[a("div",{staticClass:"dashboard-panel"},[a("div",{staticClass:"info-header"},[a("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 3rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?a("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[a("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),a("div",{staticClass:"widgets"},[a("h4",{staticClass:"heading"},[e._v("Time of day")]),e.headers.length>0?a("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),a("label",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var a=e.showTimeRange,i=t.target,n=!!i.checked;if(Array.isArray(a)){var r=null,s=e._i(a,r);i.checked?s<0&&(e.showTimeRange=a.concat([r])):s>-1&&(e.showTimeRange=a.slice(0,s).concat(a.slice(s+1)))}else e.showTimeRange=n}}}),e._v(" Time period")]),a("h4",{staticClass:"heading"},[e._v("Centroids")]),a("div",{staticClass:"white-box"},[a("label",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroids,expression:"showCentroids"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroids)?e._i(e.showCentroids,null)>-1:e.showCentroids},on:{change:function(t){var a=e.showCentroids,i=t.target,n=!!i.checked;if(Array.isArray(a)){var r=null,s=e._i(a,r);i.checked?s<0&&(e.showCentroids=a.concat([r])):s>-1&&(e.showCentroids=a.slice(0,s).concat(a.slice(s+1)))}else e.showCentroids=n}}}),e._v(" Show centroids")]),a("label",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroidLabels,expression:"showCentroidLabels"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroidLabels)?e._i(e.showCentroidLabels,null)>-1:e.showCentroidLabels},on:{change:function(t){var a=e.showCentroidLabels,i=t.target,n=!!i.checked;if(Array.isArray(a)){var r=null,s=e._i(a,r);i.checked?s<0&&(e.showCentroidLabels=a.concat([r])):s>-1&&(e.showCentroidLabels=a.slice(0,s).concat(a.slice(s+1)))}else e.showCentroidLabels=n}}}),e._v(" Show flow volume")])]),a("h4",{staticClass:"heading"},[e._v("Lines")]),a("div",{staticClass:"white-box"},[a("div",{staticClass:"subheading"},[e._v("Line width")]),a("scale-slider",{staticClass:"scale-slider",attrs:{stops:e.scaleValues,initialTime:1},on:{change:e.bounceScaleSlider}}),a("div",{staticClass:"subheading"},[e._v("Hide up to")]),a("line-filter-slider",{staticClass:"scale-slider",attrs:{initialValue:e.lineFilter},on:{change:e.bounceLineFilter}})],1),a("h4",{staticClass:"heading"},[e._v("Totals for")]),a("div",{staticClass:"buttons-bar"},[a("button",{staticClass:"button",class:{"is-link":e.isOrigin,"is-active":e.isOrigin},on:{click:e.clickedOrigins}},[e._v("Origins")]),a("button",{staticClass:"button",class:{"is-link":!e.isOrigin,"is-active":!e.isOrigin},attrs:{hint:"hide"},on:{click:e.clickedDestinations}},[e._v("Destinations")])])],1)])])],1)},Or=[],wr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"legend-container"}},[a("p",{staticClass:"title"},[e._v("Legend:")]),e._l(e.rows,(function(t){return a("div",{staticClass:"legend-item"},["string"===typeof t&&t.includes("#")?a("div",{staticClass:"legend-col",style:{"background-color":t}}):e._e(),"string"!==typeof t||t.includes("#")||"↓"!=t?e._e():a("div",{staticClass:"legend-element1"},[e._v(e._s(t))]),"string"!==typeof t||t.includes("#")||"↓"==t?e._e():a("div",{staticClass:"legend-element2"},[e._v(e._s(t))])])}))],2)},xr=[],Cr=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return Object(h["a"])(a,[{key:"created",value:function(){}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({type:Array,required:!0})],Cr.prototype,"rows",void 0),Cr=Object(p["a"])([b["a"]],Cr);var Tr=Cr,_r=Tr,Rr=(a("cec5"),Object(E["a"])(_r,wr,xr,!1,null,"fcd4bd1a",null)),Er=Rr.exports,Dr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"time-slider-main-content"},[a("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},Fr=[],Ar=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.sliderValue=0,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:0,data:[0,1,2,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,"All"],marks:[0,25,50,75,"All"],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom"},e}return Object(h["a"])(a,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.sliderValue=this.initialValue}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){console.log(e),this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])()],Ar.prototype,"initialValue",void 0),Object(p["a"])([Object(b["b"])()],Ar.prototype,"useRange",void 0),Object(p["a"])([Object(b["b"])()],Ar.prototype,"stops",void 0),Object(p["a"])([Object(b["d"])("stops")],Ar.prototype,"setStops",null),Object(p["a"])([Object(b["d"])("sliderValue")],Ar.prototype,"sliderChangedEvent",null),Ar=Object(p["a"])([Object(b["a"])({components:{"vue-slider":ze.a}})],Ar);var Lr=Ar,Pr=Lr,Mr=(a("a6cb"),Object(E["a"])(Pr,Dr,Fr,!1,null,"0e514f97",null)),zr=Mr.exports,Nr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"scale-container"}},[a("p",{staticClass:"title"},[e._v("Line scale:")]),a("div",{staticClass:"scale-element"},[e._v(e._s("|↔︎|"))]),a("div",{staticClass:"scale-scale"},[e._v(e._s("~ "+this.rows[0]+" rides"))]),a("p")])},Ir=[],Vr=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return Object(h["a"])(a,[{key:"created",value:function(){}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({type:Array,required:!0})],Vr.prototype,"rows",void 0),Vr=Object(p["a"])([b["a"]],Vr);var Br=Vr,Hr=Br,qr=(a("80bd"),Object(E["a"])(Hr,Nr,Ir,!1,null,"0f6e3408",null)),Yr=qr.exports,Ur=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"time-slider-main-content"},[a("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},Gr=[],Wr=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.TOTAL_MSG="All >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(h["a"])(a,[{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}},{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=nt(e),a=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(a)}catch(i){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=nt(e),a=("00"+t.minutes).slice(-2),i=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(a,":").concat(i)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])()],Wr.prototype,"initialTime",void 0),Object(p["a"])([Object(b["b"])()],Wr.prototype,"useRange",void 0),Object(p["a"])([Object(b["b"])()],Wr.prototype,"stops",void 0),Object(p["a"])([Object(b["d"])("initialTime")],Wr.prototype,"initialTimeChanged",null),Object(p["a"])([Object(b["d"])("useRange")],Wr.prototype,"changeUseRange",null),Object(p["a"])([Object(b["d"])("stops")],Wr.prototype,"setStops",null),Object(p["a"])([Object(b["d"])("sliderValue")],Wr.prototype,"sliderChangedEvent",null),Wr=Object(p["a"])([Object(b["a"])({components:{"vue-slider":ze.a}})],Wr);var $r=Wr,Xr=$r,Jr=(a("fc60"),Object(E["a"])(Xr,Ur,Gr,!1,null,"9a42ac2e",null)),Zr=Jr.exports,Kr="All >>",Qr=0,es=[1,3,5,10,25,50,100,150,200,300,400,450,500],ts=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csvFile:"",shpFile:"",dbfFile:"",projection:"",scaleFactor:1,title:"",description:""},e.containerId="c".concat(Math.floor(Math.random()*Math.floor(1e10))),e.mapId="map-"+e.containerId,e.centroids={},e.centroidSource={},e.linkData={},e.spiderLinkFeatureCollection={},e.zoneData={},e.dailyData={},e.marginals={},e.hoveredStateId=0,e.rowName="",e.colName="",e.headers=[],e.geojson={},e.idColumn="",e.showTimeRange=!1,e.showCentroids=!0,e.showCentroidLabels=!0,e.isOrigin=!0,e.selectedCentroid=0,e.maxZonalTotal=0,e.loadingText="Aggregated origin-destination flows",e.project={},e.scaleFactor=1,e.sliderValue=[1,500],e.scaleValues=es,e.currentScale=es[0],e.currentTimeBin=Kr,e.lineFilter=0,e.bounceTimeSlider=Object(Ki["debounce"])(e.changedTimeSlider,100),e.bounceScaleSlider=Object(Ki["debounce"])(e.changedScale,50),e.bounceLineFilter=Object(Ki["debounce"])(e.changedLineFilter,250),e}return Object(h["a"])(a,[{key:"created",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0;case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroyed",value:function(){x.commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:this.thumbnail||this.generateBreadcrumbs(),this.setupMap();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:this.setupMap();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clickedRange",value:function(e){console.log(e)}},{key:"clickedShowCentroids",value:function(){this.updateCentroidLabels()}},{key:"clickedShowCentroidBubbles",value:function(){this.updateCentroidLabels()}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 10:this.$emit("title",this.vizDetails.title),this.scaleFactor=this.vizDetails.scaleFactor,this.projection=this.vizDetails.projection,this.idColumn=this.vizDetails.idColumn?this.vizDetails.idColumn:"id",Cn.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loadingText="Loading data...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csvFile);case 4:return t=e.sent,e.next=7,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.shpFile);case 7:return a=e.sent,e.next=10,Ve.a.arraybuffer(a);case 10:return i=e.sent,e.next=13,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.dbfFile);case 13:return n=e.sent,e.next=16,Ve.a.arraybuffer(n);case 16:return r=e.sent,e.abrupt("return",{shpFile:i,dbfFile:r,odFlows:t});case 20:return e.prev=20,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"legendRows",get:function(){return["#00aa66","#880033","↓","↑"]}},{key:"setupMap",value:function(){this.mymap=new v.a.Map({container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/light-v10",center:[35.2137,31.7683],zoom:9});try{var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(e){var t=JSON.parse(e),a=this.isMobile()?0:1,i={top:50*a,bottom:100*a,right:100*a,left:300*a};this.thumbnail?this.mymap.fitBounds(t,{animate:!1}):this.mymap.fitBounds(t,{padding:i,animate:!1})}}catch(y){}if(this.mymap.on("click",this.handleEmptyClick),this.mymap.on("load",this.mapIsReady),this.mymap.addControl(new v.a.NavigationControl,"top-right"),this.thumbnail){var n,r=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact"),s=Object(Q["a"])(r);try{for(s.s();!(n=s.n()).done;){var o=n.value;o.setAttribute("style","display: none")}}catch(S){s.e(S)}finally{s.f()}r=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-group");var l,c=Object(Q["a"])(r);try{for(c.s();!(l=c.n()).done;){var u=l.value;u.setAttribute("style","display: none")}}catch(S){c.e(S)}finally{c.f()}r=document.getElementsByClassName("mapboxgl-ctrl-logo");var h,d=Object(Q["a"])(r);try{for(d.s();!(h=d.n()).done;){var m=h.value;m.setAttribute("style","display: none")}}catch(S){d.e(S)}finally{d.f()}}else{var p,f=document.getElementsByClassName("mapboxgl-ctrl-logo"),b=Object(Q["a"])(f);try{for(b.s();!(p=b.n()).done;){var g=p.value;g.setAttribute("style","margin-bottom: 3rem;")}}catch(S){b.e(S)}finally{b.f()}}}},{key:"handleEmptyClick",value:function(e){this.fadeUnselectedLinks(-1),this.isMobile()}},{key:"mapIsReady",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,!t){e.next=18;break}return e.next=6,this.processShapefile(t);case 6:return this.geojson=e.sent,e.next=9,this.processHourlyData(t.odFlows);case 9:return e.next=11,this.getDailyDataSummary();case 11:this.marginals=e.sent,this.buildCentroids(this.geojson),this.convertRegionColors(this.geojson),this.addGeojsonToMap(this.geojson),this.setMapExtent(),this.buildSpiderLinks(),this.setupKeyListeners();case 18:this.loadingText="",Cn.a.done();case 20:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isMobile",value:function(){var e=window,t=document,a=t.documentElement,i=t.getElementsByTagName("body")[0],n=e.innerWidth||a.clientWidth||i.clientWidth;e.innerHeight||a.clientHeight||i.clientHeight;return n<640}},{key:"scaleRows",get:function(){return[Math.min(Math.round((1200*Math.pow(this.currentScale,-1)+20)*Math.sqrt(this.scaleFactor)),1e3*this.scaleFactor)]}},{key:"createSpiderLinks",value:function(){var e=this;this.spiderLinkFeatureCollection={type:"FeatureCollection",features:[]};for(var t=0,a=Object.keys(this.linkData);t<a.length;t++){var i=a[t],n=this.linkData[i];if(!(n.daily<=this.lineFilter))try{(function(){var t=e.centroids[n.orig].geometry.coordinates,a=e.centroids[n.dest].geometry.coordinates,r=t[1]-a[1]>0?"#00aa66":"#880033",s=.7,o={id:i,orig:n.orig,dest:n.dest,daily:n.daily,color:r,fade:s};o[Kr]=n.daily,n.values.forEach((function(t,a){o[e.headers[a+1]]=t||0}));var l={type:"Feature",properties:o,geometry:{type:"LineString",coordinates:[t,a]}};e.spiderLinkFeatureCollection.features.push(l)})()}catch(r){}}}},{key:"updateSpiderLinks",value:function(){if(this.createSpiderLinks(),this.selectedCentroid)this.fadeUnselectedLinks(this.selectedCentroid);else{var e=this.mymap;e.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}}},{key:"buildSpiderLinks",value:function(){this.createSpiderLinks(),this.mymap.addSource("spider-source",{data:this.spiderLinkFeatureCollection,type:"geojson"}),this.mymap.addLayer({id:"spider-layer",source:"spider-source",type:"line",paint:{"line-color":["get","color"],"line-width":["*",.002*this.scaleFactor,["get","daily"]],"line-offset":["*",.5,["get","daily"]],"line-opacity":["get","fade"]}},"centroid-layer"),this.changedScale(this.currentScale);var e=this;this.mymap.on("click","spider-layer",(function(t){e.clickedOnSpiderLink(t)})),this.mymap.on("mousemove","spider-layer",(function(t){e.mymap.getCanvas().style.cursor=t?"pointer":"grab"})),this.mymap.on("mouseleave","spider-layer",(function(){e.mymap.getCanvas().style.cursor="grab"}))}},{key:"clickedOrigins",value:function(){this.isOrigin=!0,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"clickedDestinations",value:function(){this.isOrigin=!1,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"updateCentroidLabels",value:function(){var e=this.isOrigin?"{dailyFrom}":"{dailyTo}",t=this.isOrigin?"widthFrom":"widthTo";this.mymap.getLayer("centroid-layer")&&this.mymap.removeLayer("centroid-layer"),this.mymap.getLayer("centroid-label-layer")&&this.mymap.removeLayer("centroid-label-layer"),this.showCentroids&&this.mymap.addLayer({id:"centroid-layer",source:"centroids",type:"circle",paint:{"circle-color":"#ec0","circle-radius":["get",t],"circle-stroke-width":3,"circle-stroke-color":"white"}}),this.showCentroidLabels&&this.mymap.addLayer({id:"centroid-label-layer",source:"centroids",type:"symbol",layout:{"text-field":e,"text-size":11},paint:this.showCentroids?{}:{"text-halo-color":"white","text-halo-width":2}})}},{key:"unselectAllCentroids",value:function(){this.fadeUnselectedLinks(-1),this.selectedCentroid=0}},{key:"clickedOnCentroid",value:function(e){e.originalEvent.stopPropagating=!0;var t=e.features[0].properties,a=t.id;a!==this.selectedCentroid?(this.selectedCentroid=a,this.fadeUnselectedLinks(a)):this.unselectAllCentroids()}},{key:"fadeUnselectedLinks",value:function(e){var t,a=this.mymap,i=Object(Q["a"])(this.spiderLinkFeatureCollection.features);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=n.properties.id.split(":"),s=r[0]===String(e)||r[1]===String(e)?.7:Qr;-1===e&&(s=.7),n.properties.fade=s}}catch(o){i.e(o)}finally{i.f()}a.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}},{key:"clickedOnSpiderLink",value:function(e){if(!e.originalEvent.stopPropagating){var t=e.features[0].properties,a=t.daily*this.scaleFactor,i=0,n=t.dest+":"+t.orig;this.linkData[n]&&(i=this.linkData[n].daily*this.scaleFactor);var r=a+i,s="<h1>".concat(r," Bidirectional Trips</h1><br/>");s+="<p> -----------------------------</p>",s+="<p>".concat(a," trips : ").concat(i," reverse trips</p>"),new v.a.Popup({closeOnClick:!0}).setLngLat(e.lngLat).setHTML(s).addTo(this.mymap)}}},{key:"convertRegionColors",value:function(e){var t,a=Object(Q["a"])(e.features);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.properties){var n=this.isOrigin?i.properties.dailyFrom:i.properties.dailyTo,r=n/this.maxZonalTotal,s=128+127*(1-r);s||(s=255),i.properties.blue=s}}}catch(o){a.e(o)}finally{a.f()}}},{key:"handleCentroidsForTimeOfDayChange",value:function(e){var t,a={type:"FeatureCollection",features:[]},i=Object(Q["a"])(this.geojson.features);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=_n["centerOfMass"](n);r.properties.id=n.id;var s=this.calculateCentroidValuesForZone(e,n);r.properties.dailyFrom=s.from*this.scaleFactor,r.properties.dailyTo=s.to*this.scaleFactor,this.dailyFrom=r.properties.dailyFrom,this.dailyTo=r.properties.dailyTo,r.properties.widthFrom=Math.min(35,Math.max(12,Math.pow(this.dailyFrom/this.scaleFactor,.3)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r.properties.widthTo=Math.min(35,Math.max(12,Math.pow(this.dailyTo/this.scaleFactor,.3)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),n.properties||(n.properties={}),n.properties.dailyFrom=s.from,n.properties.dailyTo=s.to,r.properties.dailyFrom+r.properties.dailyTo>0&&(a.features.push(r),n.properties&&(this.centroids[n.properties[this.idColumn]]=r))}}catch(l){i.e(l)}finally{i.f()}this.centroidSource=a;var o=this.mymap;o.getSource("centroids").setData(this.centroidSource),this.updateCentroidLabels()}},{key:"calculateCentroidValuesForZone",value:function(e,t){var a=0,i=0;if("All >>"===e)return a=Math.round(this.marginals.rowTotal[t.id]),i=Math.round(this.marginals.colTotal[t.id]),{from:a,to:i};var n=this.marginals.from[t.id],r=this.marginals.to[t.id];if(Array.isArray(e)){var s=this.headers.indexOf(e[0])-1;s<0&&(s=0);for(var o=this.headers.indexOf(e[1])-1,l=s;l<=o;l++)a+=n?Math.round(n[l]):0,i+=r?Math.round(r[l]):0;return{from:a,to:i}}var c=this.headers.indexOf(e)-1;return a=n?Math.round(n[c]):0,i=r?Math.round(r[c]):0,{from:a,to:i}}},{key:"buildCentroids",value:function(e){var t,a={type:"FeatureCollection",features:[]},i=Object(Q["a"])(e.features);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(n.id){var r=_n["centerOfMass"](n);r.properties.id=n.id,r.id=n.id;var s=Math.round(this.marginals.rowTotal[n.id]),o=Math.round(this.marginals.colTotal[n.id]);s||(s=0),o||(o=0),r.properties.dailyFrom=s*this.scaleFactor,r.properties.dailyTo=o*this.scaleFactor,this.dailyFrom=r.properties.dailyFrom,this.dailyTo=r.properties.dailyTo,r.properties.widthFrom=Math.min(70,Math.max(12,Math.sqrt(this.dailyFrom/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r.properties.widthTo=Math.min(70,Math.max(12,Math.sqrt(this.dailyTo/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),s&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,s)),o&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,o)),n.properties||(n.properties={}),n.properties.dailyFrom=s,n.properties.dailyTo=o,r.properties.dailyFrom+r.properties.dailyTo>0&&(a.features.push(r),n.properties&&(this.centroids[n.id]=r),this.updateMapExtent(r.geometry.coordinates))}}}catch(c){i.e(c)}finally{i.f()}this.centroidSource=a,this.mymap.addSource("centroids",{data:this.centroidSource,type:"geojson"}),this.updateCentroidLabels();var l=this;this.mymap.on("click","centroid-layer",(function(e){l.clickedOnCentroid(e)})),this.mymap.on("mousemove","centroid-layer",(function(e){l.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","centroid-layer",(function(){l.mymap.getCanvas().style.cursor="grab"}))}},{key:"setMapExtent",value:function(){localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:50,bottom:100,right:100,left:300},animate:!1};this.mymap.fitBounds(this._mapExtentXYXY,e)}},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"processShapefile",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Constructing network...",e.next=3,wn["a"](t.shpFile,t.dbfFile);case 3:return a=e.sent,a.features.length>150&&(this.lineFilter=10),this.loadingText="Calculating coordinates...",e.next=8,Object(qe["forEachAsync"])(a.features,(function(e){!i.idColumn&&e.properties&&(i.idColumn=Object.keys(e.properties)[0]),e.properties&&(e.id=e.properties[i.idColumn]);try{"MultiPolygon"===e.geometry.type?i.convertMultiPolygonCoordinatesToWGS84(e):i.convertPolygonCoordinatesToWGS84(e)}catch(t){console.error("ERR with feature: "+e),console.error(t)}}));case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,a=Object(Q["a"])(e.geometry.coordinates);try{for(a.s();!(t=a.n()).done;){var i,n=t.value,r=[],s=Object(Q["a"])(n);try{for(s.s();!(i=s.n()).done;){var o=i.value,l=En.toLngLat(this.projection,o);r.push(l)}}catch(c){s.e(c)}finally{s.f()}n.length=0,n.push.apply(n,r)}}catch(c){a.e(c)}finally{a.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,a=Object(Q["a"])(e.geometry.coordinates);try{for(a.s();!(t=a.n()).done;){var i,n=t.value,r=n[0],s=[],o=Object(Q["a"])(r);try{for(o.s();!(i=o.n()).done;){var l=i.value,c=Object(Tn["a"])(this.projection,"WGS84",l);s.push(c)}}catch(u){o.e(u)}finally{o.f()}n[0]=s}}catch(u){a.e(u)}finally{a.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,a=[],i=Object(Q["a"])(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;Array.isArray(n[0])?a.push(this.recurseWGS84(n)):a.push(Object(Tn["a"])(this.projection,"WGS84",n))}}catch(r){i.e(r)}finally{i.f()}return a}},{key:"getDailyDataSummary",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},a={},i={},n={},e.next=6,Object(qe["forEachAsync"])(Object.keys(this.zoneData),(function(e){i[e]=Array(s.headers.length-1).fill(0);for(var r=0,o=Object.keys(s.zoneData[e]);r<o.length;r++){var l=o[r];t[e]||(t[e]=0),a[l]||(a[l]=0),s.dailyData[e][l]&&(t[e]+=s.dailyData[e][l],a[l]+=s.dailyData[e][l]),n[l]||(n[l]=Array(s.headers.length-1).fill(0));for(var c=0;c<s.headers.length-1;c++)s.zoneData[e][l][c]&&(i[e][c]+=s.zoneData[e][l][c],n[l][c]+=s.zoneData[e][l][c])}}));case 6:for(r in this.zoneData);return e.abrupt("return",{rowTotal:t,colTotal:a,from:i,to:n});case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processHourlyData",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Processing hourly data...",a=t.split("\n"),i=a[0].indexOf(";")>0?";":",",n=a[0].split(i).map((function(e){return e.trim()})),this.rowName=n[0],this.colName=n[1],this.headers=[Kr].concat(n.slice(2)),e.next=9,Object(qe["forEachAsync"])(a.slice(1),(function(e){var t=e.split(i),a=t.slice(2).map((function(e){return parseFloat(e)})),n=t[0],s=t[1];r.zoneData[n]||(r.zoneData[n]={}),r.zoneData[n][s]=a;var o=a.reduce((function(e,t){return e+t}),0);if(r.dailyData[n]||(r.dailyData[n]={}),r.dailyData[n][s]=o,0!==o){var l=String(t[0])+":"+String(t[1]);r.linkData[l]={orig:t[0],dest:t[1],daily:o,values:a}}}));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this._mapExtentXYXY[0]=Math.min(this._mapExtentXYXY[0],e[0]),this._mapExtentXYXY[1]=Math.min(this._mapExtentXYXY[1],e[1]),this._mapExtentXYXY[2]=Math.max(this._mapExtentXYXY[2],e[0]),this._mapExtentXYXY[3]=Math.max(this._mapExtentXYXY[3],e[1])}},{key:"addGeojsonToMap",value:function(e){this.addGeojsonLayers(e),this.addNeighborhoodHoverEffects()}},{key:"addGeojsonLayers",value:function(e){this.mymap.addSource("shpsource",{data:e,type:"geojson"}),this.mymap.addLayer({id:"shplayer-fill",source:"shpsource",type:"fill",paint:{"fill-color":["rgb",["get","blue"],["get","blue"],255],"fill-opacity":.5}},"road-primary"),this.mymap.addLayer({id:"shplayer-border",source:"shpsource",type:"line",paint:{"line-color":"#66f","line-opacity":.5,"line-width":["case",["boolean",["feature-state","hover"],!1],3,1]}},"centroid-layer")}},{key:"addNeighborhoodHoverEffects",value:function(){var e=this;this.mymap.on("mousemove","shplayer-fill",(function(t){var a=e.mymap;t.features.length>0&&(e.hoveredStateId&&a.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=t.features[0].properties[e.idColumn],a.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!0}))})),this.mymap.on("mouseleave","shplayer-fill",(function(){var t=e.mymap;e.hoveredStateId&&t.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=null}))}},{key:"offsetLineByMeters",value:function(e,t){try{var a=_n["lineOffset"](e,t,{units:"meters"});return a}catch(i){}return e}},{key:"pressedEscape",value:function(){this.unselectAllCentroids()}},{key:"pressedArrowKey",value:function(e){}},{key:"changedTimeSlider",value:function(e){this.currentTimeBin=e;var t=this.currentScale/500*this.scaleFactor;if(0==this.showTimeRange)this.mymap.setPaintProperty("spider-layer","line-width",["*",t,["get",e]]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,["get",e]]);else{var a,i=["+"],n=!1,r=Object(Q["a"])(this.headers);try{for(r.s();!(a=r.n()).done;){var s=a.value;s===e[0]&&(n=!0),s!==Kr&&(n&&i.push(["get",s]),s===e[1]&&(n=!1))}}catch(o){r.e(o)}finally{r.f()}this.mymap.setPaintProperty("spider-layer","line-width",["*",t,i]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,i])}this.handleCentroidsForTimeOfDayChange(e)}},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedLineFilter",value:function(e){this.lineFilter="All"===e?1/0:e,this.updateSpiderLinks()}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],ts.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],ts.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],ts.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],ts.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],ts.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("showTimeRange")],ts.prototype,"clickedRange",null),Object(p["a"])([Object(b["d"])("showCentroids")],ts.prototype,"clickedShowCentroids",null),Object(p["a"])([Object(b["d"])("showCentroidLabels")],ts.prototype,"clickedShowCentroidBubbles",null),ts=Object(p["a"])([Object(b["a"])({components:{LeftDataPanel:zn,LegendBox:Er,LineFilterSlider:zr,ScaleBox:Yr,ScaleSlider:Yn,TimeSlider:Zr}})],ts),x.commit("registerPlugin",{kebabName:"aggregate-od",prettyName:"Origin/Destination Patterns",description:"Depicts aggregate O/D flows between areas.",filePatterns:["viz-od*.y?(a)ml"],component:ts});var as,is=ts,ns=is,rs=(a("88f6"),Object(E["a"])(ns,jr,Or,!1,null,"8d93734a",null)),ss=rs.exports,os=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container"}},[!e.thumbnail&&e.loadingText?a("div",{staticClass:"status-blob"},[a("p",[e._v(e._s(e.loadingText))])]):e._e(),e.routesOnLink.length>0?a("left-data-panel",{staticClass:"left-panel",attrs:{title:"Transit routes on selected link:"}},[a("div",{staticClass:"dashboard-panel"},[0===e.routesOnLink.length?a("p",{staticClass:"details help-text",staticStyle:{"margin-top":"20px"}},[e._v("Select a link to see the routes traversing it.")]):e._e(),a("div",{staticClass:"route-list"},e._l(e.routesOnLink,(function(t){return a("div",{key:t.uniqueRouteID,staticClass:"route",class:{highlightedRoute:e.selectedRoute&&t.id===e.selectedRoute.id},on:{click:function(a){return e.showRouteDetails(t.id)}}},[a("h3",{staticClass:"mytitle"},[e._v(e._s(t.id))]),a("p",{staticClass:"details"},[a("b",[e._v(e._s(t.departures)+" departures")])]),a("p",{staticClass:"details"},[e._v("First: "+e._s(t.firstDeparture))]),a("p",{staticClass:"details"},[e._v("Last: "+e._s(t.lastDeparture))])])})),0)])]):e._e(),a("div",{staticClass:"map-container",class:{"hide-thumbnail":!e.thumbnail}},[a("div",{attrs:{id:"mymap"}},e._l(e.stopMarkers,(function(e){return a("div",{key:e.i,staticClass:"stop-marker",style:{transform:"translate(-50%,-50%) rotate("+e.bearing+"deg)",left:e.xy.x+"px",top:e.xy.y+"px"}})})),0)]),e.thumbnail?e._e():a("legend-box",{staticClass:"legend",attrs:{rows:e.legendRows}})],1)},ls=[],cs=(a("6062"),a("6b0c")),us=a.n(cs);(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(as||(as={}));var hs=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.call(this,new us.a)}return Object(h["a"])(a,[{key:"createNodesAndLinks",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(as.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(as.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(as.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(li,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new a,e.next=3,i.initialize(t);case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),a}(hi),ds=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"legend-container"}},[a("p",{staticClass:"title"},[e._v("Legend")]),e._l(e.rows,(function(t){return a("div",{key:t[0],staticClass:"legend-item"},[a("div",{staticClass:"legend-col-1",style:{"background-color":t[0]}}),a("span",{staticClass:"legend-col-2"},[e._v(e._s(t[1]))])])}))],2)},ms=[],ps=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){return Object(u["a"])(this,a),t.apply(this,arguments)}return Object(h["a"])(a,[{key:"created",value:function(){console.log(this.rows)}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({type:Array,required:!0})],ps.prototype,"rows",void 0),ps=Object(p["a"])([b["a"]],ps);var fs=ps,vs=fs,bs=(a("677a"),Object(E["a"])(vs,ds,ms,!1,null,"cb0d8438",null)),gs=bs.exports,ys="EPSG:31468",Ss=16,ks=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.vizDetails={transitSchedule:"",network:"",projection:"",title:"",description:""},e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.loadingText="MATSim Transit Inspector",e.project={},e.projection=ys,e.routesOnLink=[],e.selectedRoute={},e.stopMarkers=[],e}return Object(h["a"])(a,[{key:"created",value:function(){this._attachedRouteLayers=[],this._departures={},this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0,this._network={nodes:{},links:{}},this._routeData={},this._stopFacilities={},this._transitLines={},this.selectedRoute=null}},{key:"destroyed",value:function(){x.commit("setFullScreen",!1)}},{key:"authenticationChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this._roadFetcher&&this._roadFetcher.destroy(),this._transitFetcher&&this._transitFetcher.destroy(),this._transitHelper&&this._transitHelper.destroy()}},{key:"mounted",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.setupMap();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t),this.myState.fileSystem=t;var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=Fe.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.fileSystem.url);case 10:a=this.vizDetails.title?this.vizDetails.title:"Transit Network",this.$emit("title",a),this.projection=this.vizDetails.projection,Cn.a.done();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"legendRows",get:function(){return[["#a03919","Rail"],["#448","Bus"]]}},{key:"isMobile",value:function(){var e=window,t=document,a=t.documentElement,i=t.getElementsByTagName("body")[0],n=e.innerWidth||a.clientWidth||i.clientWidth;e.innerHeight||a.clientHeight||i.clientHeight;return n<640}},{key:"setupMap",value:function(){this.mymap=new v.a.Map({bearing:0,container:"mymap",logoPosition:"bottom-right",style:"mapbox://styles/mapbox/dark-v9",pitch:0});try{var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(console.log({extent:e}),e){var t=JSON.parse(e);this.isMobile();this.thumbnail,this.mymap.fitBounds(t,{animate:!1})}}catch(a){console.log({E:a})}this.mymap.on("load",this.mapIsReady),this.mymap.on("move",this.handleMapMotion),this.mymap.on("zoom",this.handleMapMotion),this.mymap.on("click",this.handleEmptyClick),this.mymap.keyboard.disable(),this.mymap.addControl(new v.a.NavigationControl,"top-right")}},{key:"handleMapMotion",value:function(){this.stopMarkers.length>0&&this.showTransitStops()}},{key:"handleEmptyClick",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute(),this.removeAttachedRoutes(),this.routesOnLink=[]}},{key:"showRouteDetails",value:function(e){(e||this.selectedRoute)&&(console.log({routeID:e}),e?this.showTransitRoute(e):this.showTransitRoute(this.selectedRoute.id),this.showTransitStops())}},{key:"mapIsReady",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadNetworks();case 2:t=e.sent,t&&this.processInputs(t),this.setupKeyListeners();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"loadNetworks",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,console.log(this.vizDetails),this.myState.fileSystem){e.next=4;break}return e.abrupt("return");case 4:return this.loadingText="Loading networks...",e.next=7,pi.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 7:return this._roadFetcher=e.sent,e.next=10,pi.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.transitSchedule});case 10:return this._transitFetcher=e.sent,t=this._roadFetcher.fetchXML(),a=this._transitFetcher.fetchXML(),e.next=15,Promise.all([t,a]);case 15:return i=e.sent,this._roadFetcher.destroy(),this._transitFetcher.destroy(),e.abrupt("return",{roadXML:i[0],transitXML:i[1]});case 21:return e.prev=21,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Preparing...",e.next=3,hs.create({xml:t,projection:this.projection});case 3:return this._transitHelper=e.sent,this.loadingText="Crunching road network...",e.next=7,this._transitHelper.createNodesAndLinks();case 7:return this.loadingText="Converting coordinates...",e.next=10,this._transitHelper.convertCoordinates();case 10:return this.loadingText="Crunching transit network...",e.next=13,this._transitHelper.processTransit();case 13:return a=e.sent,this._network=a.network,this._routeData=a.routeData,this._stopFacilities=a.stopFacilities,this._transitLines=a.transitLines,this._mapExtentXYXY=a.mapExtent,this.loadingText="Summarizing departures...",e.next=22,this.processDepartures();case 22:return e.next=24,this.constructDepartureFrequencyGeoJson();case 24:return i=e.sent,e.next=27,this.addTransitToMap(i);case 27:localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY)),this.mymap.fitBounds(this._mapExtentXYXY,{padding:{top:2,bottom:2,right:2,left:2},animate:!1}),this.loadingText="",Cn.a.done();case 31:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addLinksToMap",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.constructGeoJsonFromLinkData(),this.mymap.addSource("link-data",{data:t,type:"geojson"}),this.mymap.addLayer({id:"link-layer",source:"link-data",type:"line",paint:{"line-opacity":1,"line-width":3,"line-color":"#ccf"}});case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processDepartures",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t in this.loadingText="Processing departures",this._transitLines)if(this._transitLines.hasOwnProperty(t)){a=this._transitLines[t],i=Object(Q["a"])(a.transitRoutes);try{for(i.s();!(n=i.n()).done;){r=n.value,s=Object(Q["a"])(r.route);try{for(s.s();!(o=s.n()).done;)l=o.value,l in this._departures||(this._departures[l]={total:0,routes:new Set}),this._departures[l].total+=r.departures,this._departures[l].routes.add(r.id),this._maximum=Math.max(this._maximum,this._departures[l].total)}catch(c){s.e(c)}finally{s.f()}}}catch(c){i.e(c)}finally{i.f()}}case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addTransitToMap",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.mymap.addSource("transit-source",{data:t,type:"geojson"}),this.mymap.addLayer({id:"transit-link",source:"transit-source",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-color":["get","color"]}}),a=this,this.mymap.on("click","transit-link",(function(e){a.clickedOnTransitLink(e)})),this.mymap.on("mousemove","transit-link",(function(e){a.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","transit-link",(function(){a.mymap.getCanvas().style.cursor="grab"}));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"constructGeoJsonFromLinkData",value:function(){var e=[];for(var t in this._network.links)if(this._network.links.hasOwnProperty(t)){var a=this._network.links[t],i=this._network.nodes[a.from],n=this._network.nodes[a.to],r=[[i.x,i.y],[n.x,n.y]],s={type:"Feature",geometry:{type:"LineString",coordinates:r},properties:{id:t,color:"#aaa"}};e.push(s)}return this._linkData={type:"FeatureCollection",features:e},this._linkData}},{key:"constructDepartureFrequencyGeoJson",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u,h,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(a in this.loadingText="Construct departure frequencies",t=[],this._departures)if(this._departures.hasOwnProperty(a)){i=this._network.links[a],n=[[this._network.nodes[i.from].x,this._network.nodes[i.from].y],[this._network.nodes[i.to].x,this._network.nodes[i.to].y]],r=this._departures[a].total,s=.25+.75*(r-1)/this._maximum,o=Math.floor(Ss*s),l=!0,c=Object(Q["a"])(this._departures[a].routes);try{for(c.s();!(u=c.n()).done;)h=u.value,"bus"===this._routeData[h].transportMode&&(l=!1)}catch(m){c.e(m)}finally{c.f()}d={type:"Feature",geometry:{type:"LineString",coordinates:n},properties:{width:Math.max(3,.01*this._departures[a].total),color:l?"#a03919":Os[o],colorBin:o,departures:r,id:a,isRail:l,from:i.from,to:i.to}},d=this.offsetLineByMeters(d,-10),t.push(d)}return t.sort((function(e,t){return e.isRail&&!t.isRail?-1:t.isRail&&!e.isRail?1:0})),e.abrupt("return",{type:"FeatureCollection",features:t});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"offsetLineByMeters",value:function(e,t){try{var a=_n["lineOffset"](e,t,{units:"meters"});return a}catch(i){}return e}},{key:"removeStopMarkers",value:function(){this.stopMarkers=[]}},{key:"showTransitStops",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u,h,d,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.removeStopMarkers(),t=this.selectedRoute,"stopmarker",a=this.mymap.getBearing(),n=Object(Q["a"])(t.routeProfile.entries());try{for(n.s();!(r=n.n()).done;)s=Object(bt["a"])(r.value,2),o=s[0],l=s[1],c=[this._stopFacilities[l.refId].x,this._stopFacilities[l.refId].y],o<t.routeProfile.length-1&&(u=_n["point"]([c[0],c[1]]),h=_n["point"]([this._stopFacilities[t.routeProfile[o+1].refId].x,this._stopFacilities[t.routeProfile[o+1].refId].y]),i=_n["bearing"](u,h)-a),d=this.mymap.project([c[0],c[1]]),m={i:o,bearing:i,xy:{x:Math.floor(d.x),y:Math.floor(d.y)}},this.stopMarkers.push(m)}catch(p){n.e(p)}finally{n.f()}case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showTransitRoute",value:function(e){if(e){var t=this._routeData[e];console.log({SELECTED_ROUTE:t}),this.selectedRoute=t;var a=this.mymap.getSource("selected-route-data");a?a.setData(t.geojson):this.mymap.addSource("selected-route-data",{data:t.geojson,type:"geojson"}),this.mymap.getLayer("selected-route")||this.mymap.addLayer({id:"selected-route",source:"selected-route-data",type:"line",paint:{"line-opacity":1,"line-width":5,"line-color":"#097c43"}})}}},{key:"removeSelectedRoute",value:function(){this.selectedRoute&&(this.mymap.removeLayer("selected-route"),this.selectedRoute=null)}},{key:"clickedOnTransitLink",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute();var t,a=e.features[0].properties,i=this._departures[a.id].routes,n=[],r=Object(Q["a"])(i);try{for(r.s();!(t=r.n()).done;){var s=t.value;n.push(this._routeData[s])}}catch(o){r.e(o)}finally{r.f()}n.sort((function(e,t){return e.departures>t.departures?-1:1})),this.routesOnLink=n,this.highlightAllAttachedRoutes(),n.length>0&&this.showRouteDetails(n[0].id)}},{key:"removeAttachedRoutes",value:function(){var e,t=Object(Q["a"])(this._attachedRouteLayers);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.mymap.removeLayer("route-"+a),this.mymap.removeSource("source-route-"+a)}}catch(i){t.e(i)}finally{t.f()}this._attachedRouteLayers=[]}},{key:"highlightAllAttachedRoutes",value:function(){this.removeAttachedRoutes();var e,t=Object(Q["a"])(this.routesOnLink);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.mymap.addSource("source-route-"+a.id,{data:a.geojson,type:"geojson"}),this.mymap.addLayer({id:"route-"+a.id,source:"source-route-"+a.id,type:"line",paint:{"line-opacity":.7,"line-width":8,"line-color":"#ccff33"}}),this._attachedRouteLayers.push(a.id)}}catch(i){t.e(i)}finally{t.f()}}},{key:"pressedEscape",value:function(){this.removeSelectedRoute(),this.removeStopMarkers(),this.removeAttachedRoutes(),this.selectedRoute=null,this.routesOnLink=[]}},{key:"pressedArrowKey",value:function(e){if(this.selectedRoute){var t=this.routesOnLink.indexOf(this.selectedRoute);t+=e,t<0||t>=this.routesOnLink.length||this.showRouteDetails(this.routesOnLink[t].id)}}}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],ks.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],ks.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],ks.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],ks.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],ks.prototype,"authenticationChanged",null),ks=Object(p["a"])([Object(b["a"])({components:{LeftDataPanel:zn,LegendBox:gs}})],ks),x.commit("registerPlugin",{kebabName:"transit-supply",prettyName:"Transit Routes",description:"The scheduled transit routes on a network",filePatterns:["viz-transit*.y?(a)ml"],component:ks});var js=ks,Os=hn()({colormap:"viridis",nshades:Ss}),ws=js,xs=(a("44bf"),Object(E["a"])(ws,os,ls,!1,null,"13d5446f",null)),Cs=xs.exports,Ts=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:e.thumbnail?"0 0":"0 20px 20px 20px"},attrs:{id:"container"}},[e.thumbnail?e._e():a("h3",[e._v(e._s(e.title))]),a("div",{staticClass:"vid-container"},[e.movieSource?a("video-player",{ref:"videoPlayer",staticClass:"vjs-default-skin vjs-big-play-centered",attrs:{options:e.playerOptions}}):e._e()],1)])},_s=[],Rs=a("d6d3"),Es=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.movieSource="",e.title="",e.playerOptions={muted:!1,language:"en",playbackRates:[.5,1,1.5,2,5],preload:"metadata",responsive:!0,fluid:!0,playsInline:!0,controls:!0,sources:[]},e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.aspect=0,e}return Object(h["a"])(a,[{key:"destroyed",value:function(){window.removeEventListener("resize",this.onResize),this.thumbnail||x.commit("setFullScreen",!1)}},{key:"mounted",value:function(){if(this.thumbnail||x.commit("setFullScreen",!0),this.yamlConfig){var e=this.getFileSystem(this.$route.name);this.buildMovieSource(e.svn,this.subfolder+"/",this.yamlConfig)}else this.buildRouteFromUrl();this.getVizDetails(),this.thumbnail||this.generateBreadcrumbs(),this.thumbnail||window.addEventListener("resize",this.onResize)}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"buildMovieSource",value:function(e,t,a){this.movieSource="".concat(e,"/").concat(t).concat(a),this.playerOptions.sources.push({type:"video/mp4",src:this.movieSource})}},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length&&(t=x.state.svnProjects.filter((function(t){return t.url===e.substring(8)}))),0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t);var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n,this.buildMovieSource(t.svn,i,n)}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"onResize",value:function(){var e=document.getElementsByClassName("vid-container")[0],t=document.getElementsByClassName("video-js")[0];this.aspect||(this.aspect=t.clientHeight/t.clientWidth);e.clientWidth;var a=window.innerHeight,i=window.innerWidth;e.style.width="100%",e.style.margin="auto auto";var n=a-120,r=Math.floor(n/this.aspect);t.style.width="".concat(r,"px"),t.style.height="".concat(r*this.aspect,"px"),e.style.width="".concat(r,"px"),e.style.height="".concat(r*this.aspect,"px");var s=i-60;if(t.clientWidth>s){var o=s;t.style.width="".concat(o,"px"),t.style.height="".concat(o*this.aspect,"px"),e.style.width="".concat(o,"px"),e.style.height="".concat(o*this.aspect,"px")}}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.getFileSystem(this.$route.params.project),t){e.next=3;break}return e.abrupt("return",[]);case 3:a=[{label:t.name,url:"/"+t.url}],i=this.myState.subfolder.split("/"),n="/",r=Object(Q["a"])(i),e.prev=7,r.s();case 9:if((s=r.n()).done){e.next=17;break}if(o=s.value,o){e.next=13;break}return e.abrupt("continue",15);case 13:n+=o+"/",a.push({label:o,url:"/"+t.url+n});case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](7),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:return x.commit("setBreadCrumbs",a),e.abrupt("return",a);case 27:case"end":return e.stop()}}),e,this,[[7,19,22,25]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.title=this.myState.yamlConfig.replace(/_/g," "),this.title=this.title.substring(0,this.title.lastIndexOf(".")),this.title&&this.$emit("title",this.title);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],Es.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Es.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Es.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],Es.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("yamlConfig")],Es.prototype,"changedYaml",null),Object(p["a"])([Object(b["d"])("subfolder")],Es.prototype,"changedSubfolder",null),Es=Object(p["a"])([Object(b["a"])({components:{"video-player":Rs["videoPlayer"]}})],Es),x.commit("registerPlugin",{kebabName:"video-player",prettyName:"Video",description:"",filePatterns:["*.mp4"],component:Es});var Ds=Es,Fs=Ds,As=(a("8838"),Object(E["a"])(Fs,Ts,_s,!1,null,"16e5d11d",null)),Ls=As.exports,Ps=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.myState.yamlConfig?a("div",{attrs:{id:"container"}},[a("img",{staticClass:"medium-zoom",attrs:{src:e.myState.imageData}})]):e._e()},Ms=[],zs=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.matsimPngTitles={"modestats.png":"Mode statistics","ph_modestats.png":"Passenger hours traveled per mode","pkm_modestats.png":"Passenger km traveled per mode","scorestats.png":"Score statistics","stopwatch.png":"Stopwatch: computation time","traveldistancestatslegs.png":"Leg travel distance","traveldistancestatstrips.png":"Trip travel distance"},e}return Object(h["a"])(a,[{key:"mounted",value:function(){this.yamlConfig||this.buildRouteFromUrl(),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new ka(t);var a=1+e.pathMatch.lastIndexOf("/"),i=e.pathMatch.substring(0,a),n=e.pathMatch.substring(a);this.myState.subfolder=i,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:if(t=e.sent,t){e.next=7;break}return console.log("no blob! :-("),e.abrupt("return");case 7:return e.next=9,Ve.a.dataurl(t);case 9:a=e.sent,this.myState.imageData=a,i=this.matsimPngTitles[this.yamlConfig]?this.matsimPngTitles[this.yamlConfig]:this.yamlConfig,this.$emit("title",i),e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](0),console.error({e:e.t0}),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(){return e.apply(this,arguments)}return t}()}]),a}(b["c"]);Object(p["a"])([Object(b["b"])({required:!1})],zs.prototype,"fileApi",void 0),Object(p["a"])([Object(b["b"])({required:!1})],zs.prototype,"subfolder",void 0),Object(p["a"])([Object(b["b"])({required:!1})],zs.prototype,"yamlConfig",void 0),Object(p["a"])([Object(b["b"])({required:!1})],zs.prototype,"thumbnail",void 0),Object(p["a"])([Object(b["d"])("yamlConfig")],zs.prototype,"changedYaml",null),Object(p["a"])([Object(b["d"])("subfolder")],zs.prototype,"changedSubfolder",null),zs=Object(p["a"])([Object(b["a"])({components:{}})],zs),x.commit("registerPlugin",{kebabName:"image-view",prettyName:"Image",description:"",filePatterns:["!(*thumbnail*).(png|jpg)"],component:zs});var Ns=zs,Is=Ns,Vs=(a("358c"),Object(E["a"])(Is,Ps,Ms,!1,null,"508c8a0c",null)),Bs=Vs.exports,Hs={VehicleAnimation:Ta,XyHexagons:Ua,AgentAnimation:Ni,LinksGl:kn,LinkVolumes:ar,SankeyDiagram:mr,VegaLite:kr,AggregateOd:ss,TransitSupply:Cs,VideoPlayer:Ls,ImageView:Bs},qs=Hs,Ys=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.mdRenderer=new Te.a,e.myState={errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",svnProject:e.svnp,svnRoot:void 0,subfolder:"",vizes:[],summary:!1},e.summaryYamlFilename="viz-summary.yml",e}return Object(h["a"])(a,[{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length&&(t=x.state.svnProjects.filter((function(t){return t.url===e.substring(8)}))),0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"generateBreadcrumbs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnProject){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.svnProject.name,url:"/"+this.myState.svnProject.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:i+=s+"/",t.push({label:s,url:"/"+this.myState.svnProject.url+i});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:if(e.prev=24,!this.myState.svnRoot){e.next=31;break}return e.next=28,this.myState.svnRoot.getFileText(this.myState.subfolder+"/metadata.yml");case 28:o=e.sent,l=Fe.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u}));case 31:e.next=35;break;case 33:e.prev=33,e.t1=e["catch"](24);case 35:return x.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,33]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"mounted",value:function(){this.updateRoute()}},{key:"clickedVisualization",value:function(e,t){var a=this.myState.vizes[e];if("image-view"!==a.component&&this.myState.svnProject){var i="/v/".concat(a.component,"/").concat(this.myState.svnProject.url,"/").concat(this.myState.subfolder,"/").concat(a.config);t?window.open(i,"_blank"):this.$router.push({path:i})}}},{key:"updateTitle",value:function(e,t){this.myState.vizes[e].title=t}},{key:"updateRoute",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$route.name){e.next=2;break}return e.abrupt("return");case 2:if(t=this.getFileSystem(this.$route.name),this.myState.svnProject=t,this.myState.subfolder=this.$route.params.pathMatch?this.$route.params.pathMatch:"",this.myState.svnProject){e.next=7;break}return e.abrupt("return");case 7:this.myState.svnRoot=new ka(this.myState.svnProject),this.generateBreadcrumbs(),this.fetchFolderContents();case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.updateRoute()}},{key:"filesChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.vizes=[],0!==this.myState.files.length){e.next=3;break}return e.abrupt("return");case 3:if(this.showReadme(),this.myState.summary=-1!==this.myState.files.indexOf(this.summaryYamlFilename),!this.myState.summary){e.next=10;break}return e.next=8,this.buildCuratedSummaryView();case 8:e.next=11;break;case 10:this.buildShowEverythingView();case 11:return e.next=13,this.$nextTick();case 13:Object(_e["a"])(".medium-zoom",{background:"#444450"});case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showReadme",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="readme.md",-1!==this.myState.files.indexOf(t)){e.next=5;break}this.myState.readme="",e.next=11;break;case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+t);case 9:a=e.sent,this.myState.readme=this.mdRenderer.render(a);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildShowEverythingView",value:function(){var e,t=Object(Q["a"])(this.globalState.visualizationTypes.values());try{for(t.s();!(e=t.n()).done;){var a,i=e.value,n=Ee()(this.myState.files,i.filePatterns),r=Object(Q["a"])(n);try{for(r.s();!(a=r.n()).done;){var s=a.value;this.myState.vizes.push({component:i.kebabName,config:s,title:"◆"})}}catch(o){r.e(o)}finally{r.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"buildCuratedSummaryView",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u,h,d,m,p,f,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return e.t0=Fe.a,e.next=5,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+this.summaryYamlFilename);case 5:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),console.log(t),a=Object(Q["a"])(t.plugins),e.prev=9,a.s();case 11:if((i=a.n()).done){e.next=44;break}if(n=i.value,r=this.globalState.visualizationTypes.get(n),r){e.next=16;break}return e.abrupt("continue",42);case 16:if(!t[r.kebabName]){e.next=39;break}s=Object(Q["a"])(t[r.kebabName]),e.prev=18,s.s();case 20:if((o=s.n()).done){e.next=29;break}return l=o.value,e.next=24,this.findMatchingFiles(l);case 24:c=e.sent,u=Object(Q["a"])(c);try{for(u.s();!(h=u.n()).done;)d=h.value,this.myState.vizes.push({component:r.kebabName,config:d,title:d})}catch(b){u.e(b)}finally{u.f()}case 27:e.next=20;break;case 29:e.next=34;break;case 31:e.prev=31,e.t2=e["catch"](18),s.e(e.t2);case 34:return e.prev=34,s.f(),e.finish(34);case 37:e.next=42;break;case 39:m=Ee()(this.myState.files,r.filePatterns),p=Object(Q["a"])(m);try{for(p.s();!(f=p.n()).done;)v=f.value,this.myState.vizes.push({component:r.kebabName,config:v,title:"◆"})}catch(b){p.e(b)}finally{p.f()}case 42:e.next=11;break;case 44:e.next=49;break;case 46:e.prev=46,e.t3=e["catch"](9),a.e(e.t3);case 49:return e.prev=49,a.f(),e.finish(49);case 52:case"end":return e.stop()}}),e,this,[[9,46,49,52],[18,31,34,37]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"findMatchingFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.myState.files.indexOf(t)>-1)){e.next=2;break}return e.abrupt("return",[t]);case 2:if(a=Ee()(this.myState.files,t),!a.length){e.next=5;break}return e.abrupt("return",a);case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return",[]);case 7:return e.prev=7,i=t.split("/"),n=this.myState.subfolder+"/"+i[0],console.log(n),e.next=13,this.myState.svnRoot.getDirectory(n);case 13:return r=e.sent,s=Ee()(r.files,i[1]),e.abrupt("return",s.map((function(e){return i[0]+"/"+e})));case 18:e.prev=18,e.t0=e["catch"](7);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,this,[[7,18]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchFolderContents",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return",[]);case 2:return this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.files=[],e.prev=5,e.next=8,this.myState.svnRoot.getDirectory(this.myState.subfolder);case 8:t=e.sent,console.log(t),a=t.dirs.filter((function(e){return!e.startsWith(".")})).sort(),i=t.files.filter((function(e){return!e.startsWith(".")})).sort(),this.myState.errorStatus="",this.myState.folders=a,this.myState.files=i,e.next=33;break;case 17:e.prev=17,e.t0=e["catch"](5),console.log("BAD PAGE"),console.log({eeee:e.t0}),this.myState.folders=[],this.myState.files=[],this.myState.errorStatus="<h3>",e.t0.status&&(this.myState.errorStatus+="".concat(e.t0.status," ")),e.t0.statusText&&(this.myState.errorStatus+="".concat(e.t0.statusText)),"<h3>"===this.myState.errorStatus&&(this.myState.errorStatus+="Error"),this.myState.errorStatus+="</h3>",e.t0.url&&(this.myState.errorStatus+="<p>".concat(e.t0.url,"</p>")),e.t0.message&&(this.myState.errorStatus+="<p>".concat(e.t0.message,"</p>")),"<h3>Error</h3>"===this.myState.errorStatus&&(this.myState.errorStatus=""+e.t0),this.myState.svnProject&&(this.myState.errorStatus+="<p><i>".concat(this.myState.svnProject.svn,"/").concat(this.myState.subfolder,"</i></p>")),this.myState.svnProject&&this.myState.svnProject.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.svnProject.url);case 33:return e.prev=33,this.myState.isLoading=!1,e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[5,17,33,36]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"openOutputFolder",value:function(e,t){if(!this.myState.isLoading&&this.myState.svnProject){var a="/"+this.myState.svnProject.url+"/"+this.myState.subfolder+"/"+e;t?window.open(a,"_blank"):this.$router.push({path:a})}}}]),a}(b["c"]);Object(p["a"])([Object(b["d"])("$route")],Ys.prototype,"updateRoute",null),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],Ys.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("myState.files")],Ys.prototype,"filesChanged",null),Ys=Object(p["a"])([Object(b["a"])({components:qs,props:{}})],Ys);var Us=Ys,Gs=Us,Ws=(a("cda0"),Object(E["a"])(Gs,we,xe,!1,null,"2af8487f",null)),$s=Ws.exports,Xs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"project-component"}},[a("div",{staticClass:"main-area"},[e.myState.svnProject?a("div",{staticClass:"project-bar"},[a("div",{staticClass:"details"},[a("div",{staticClass:"details-column"},[a("h2",[e._v(e._s(e.globalState.breadcrumbs[e.globalState.breadcrumbs.length-1].label))]),a("p",[e._v(e._s(e.myState.svnProject.description))]),a("p",[e._v("Some cool description of the project and presented scenarios")])]),a("div",{staticClass:"details-column"},[e.myState.svnProject?a("img",{attrs:{width:"500",src:e.myState.svnProject.thumbnail}}):e._e()])])]):e._e(),e.myState.svnProject?a("div",{staticClass:"details"},[e.myState.errorStatus?a("div",{staticClass:"badnews",domProps:{innerHTML:e._s(e.myState.errorStatus)}}):e._e(),a("div",{staticClass:"readme-header"},[e.myState.readme?a("div",{staticClass:"curate-content markdown",domProps:{innerHTML:e._s(e.myState.readme)}}):e._e()]),e.projectYaml.length?a("div",{staticClass:"curate-content"},[a("hr"),a("h3",[e._v("Simulation results")]),a("p",[e._v("The following links lead to the results of various simulation experiments")]),a("div",{staticClass:"viz-table"},e._l(e.projectYaml,(function(t){return a("div",{key:t.title,staticClass:"folder",class:{fade:e.myState.isLoading},on:{click:[function(a){return e.openOutputFolder(t.folder,!1)},function(a){return a.ctrlKey?e.openOutputFolder(t.folder,!0):null},function(a){return a.metaKey?e.openOutputFolder(t.folder,!0):null}],mouseup:function(a){return"button"in a&&1!==a.button?null:e.openOutputFolder(t.folder,!0)}}},[a("div",{staticClass:"banner"},[a("h3",[e._v(e._s(t.title))]),a("p",[e._v(e._s(t.description))])]),a("div",{staticClass:"notes"},[t.notes?a("ul",e._l(t.notes,(function(t){return a("li",{staticClass:"notes-item"},[e._v(e._s(t))])})),0):e._e()])])})),0)]):e._e(),e.myState.vizes.length?a("div",{staticClass:"curate-content"},[a("hr"),a("h3",[e._v("Overview")]),a("div",{staticClass:"viz-table"},e._l(e.myState.vizes,(function(t,i){return a("div",{key:t.config,staticClass:"viz-item",on:{click:[function(t){return e.clickedVisualization(i,!1)},function(t){return t.ctrlKey?e.clickedVisualization(i,!0):null},function(t){return t.metaKey?e.clickedVisualization(i,!0):null}],mouseup:function(t){return"button"in t&&1!==t.button?null:e.clickedVisualization(i,!0)}}},[a("div",{staticClass:"viz-frame"},[a("p",[e._v(e._s(t.title))]),a(t.component,{tag:"component",style:{"pointer-events":"image-view"===t.component?"auto":"none"},attrs:{yamlConfig:t.config,fileApi:e.myState.svnRoot,subfolder:e.myState.subfolder,thumbnail:!0},on:{title:function(t){return e.updateTitle(i,t)}}})],1)])})),0)]):e._e()]):e._e()]),a("colophon",{staticClass:"colophon"})],1)},Js=[],Zs=qs;Zs.Colophon=F;var Ks=function(e){Object(d["a"])(a,e);var t=Object(m["a"])(a);function a(){var e;return Object(u["a"])(this,a),e=t.apply(this,arguments),e.globalState=x.state,e.mdRenderer=new Te.a,e.myState={errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",svnProject:e.svnp,svnRoot:void 0,subfolder:"",vizes:[],summary:!1},e.summaryYamlFilename="viz-summary.yml",e.projectYaml=[],e}return Object(h["a"])(a,[{key:"getFileSystem",value:function(e){var t=x.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.svnProject)return[];var e,t=[{label:this.myState.svnProject.name,url:"/"+this.myState.svnProject.url}],a=this.myState.subfolder.split("/"),i="/",n=Object(Q["a"])(a);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(i+=r+"/",t.push({label:r,url:"/"+this.myState.svnProject.url+i}))}}catch(s){n.e(s)}finally{n.f()}return x.commit("setBreadCrumbs",t),t}},{key:"mounted",value:function(){this.updateRoute()}},{key:"clickedVisualization",value:function(e,t){var a=this.myState.vizes[e];if("image-view"!==a.component&&this.myState.svnProject){var i="/v/".concat(a.component,"/").concat(this.myState.svnProject.url,"/").concat(this.myState.subfolder,"/").concat(a.config);t?window.open(i,"_blank"):this.$router.push({path:i})}}},{key:"updateTitle",value:function(e,t){this.myState.vizes[e].title=t}},{key:"updateRoute",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$route.name){e.next=2;break}return e.abrupt("return");case 2:if(t=this.getFileSystem(this.$route.name),this.myState.svnProject=t,this.myState.subfolder=this.$route.params.pathMatch?this.$route.params.pathMatch:"",this.myState.svnProject){e.next=7;break}return e.abrupt("return");case 7:return this.myState.svnRoot=new ka(this.myState.svnProject),this.generateBreadcrumbs(),e.next=11,this.loadYaml();case 11:this.fetchFolderContents();case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.updateRoute()}},{key:"filesChanged",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.vizes=[],0!==this.myState.files.length){e.next=3;break}return e.abrupt("return");case 3:if(this.showReadme(),this.myState.summary=-1!==this.myState.files.indexOf(this.summaryYamlFilename),!this.myState.summary){e.next=10;break}return e.next=8,this.buildCuratedSummaryView();case 8:e.next=11;break;case 10:this.buildShowEverythingView();case 11:return e.next=13,this.$nextTick();case 13:Object(_e["a"])(".medium-zoom",{background:"#444450"});case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showReadme",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="readme.md",-1!==this.myState.files.indexOf(t)){e.next=5;break}this.myState.readme="",e.next=11;break;case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+t);case 9:a=e.sent,this.myState.readme=this.mdRenderer.render(a);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildShowEverythingView",value:function(){var e,t=Object(Q["a"])(this.globalState.visualizationTypes.values());try{for(t.s();!(e=t.n()).done;){var a,i=e.value,n=Ee()(this.myState.files,i.filePatterns),r=Object(Q["a"])(n);try{for(r.s();!(a=r.n()).done;){var s=a.value;this.myState.vizes.push({component:i.kebabName,config:s,title:"◆"})}}catch(o){r.e(o)}finally{r.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"buildCuratedSummaryView",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c,u,h,d,m,p,f,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return e.t0=Fe.a,e.next=5,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+this.summaryYamlFilename);case 5:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),a=Object(Q["a"])(t.plugins),e.prev=8,a.s();case 10:if((i=a.n()).done){e.next=43;break}if(n=i.value,r=this.globalState.visualizationTypes.get(n),r){e.next=15;break}return e.abrupt("continue",41);case 15:if(!t[r.kebabName]){e.next=38;break}s=Object(Q["a"])(t[r.kebabName]),e.prev=17,s.s();case 19:if((o=s.n()).done){e.next=28;break}return l=o.value,e.next=23,this.findMatchingFiles(l);case 23:c=e.sent,u=Object(Q["a"])(c);try{for(u.s();!(h=u.n()).done;)d=h.value,this.myState.vizes.push({component:r.kebabName,config:d,title:d})}catch(b){u.e(b)}finally{u.f()}case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t2=e["catch"](17),s.e(e.t2);case 33:return e.prev=33,s.f(),e.finish(33);case 36:e.next=41;break;case 38:m=Ee()(this.myState.files,r.filePatterns),p=Object(Q["a"])(m);try{for(p.s();!(f=p.n()).done;)v=f.value,this.myState.vizes.push({component:r.kebabName,config:v,title:"◆"})}catch(b){p.e(b)}finally{p.f()}case 41:e.next=10;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e["catch"](8),a.e(e.t3);case 48:return e.prev=48,a.f(),e.finish(48);case 51:case"end":return e.stop()}}),e,this,[[8,45,48,51],[17,30,33,36]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"findMatchingFiles",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.myState.files.indexOf(t)>-1)){e.next=2;break}return e.abrupt("return",[t]);case 2:if(a=Ee()(this.myState.files,t),!a.length){e.next=5;break}return e.abrupt("return",a);case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return",[]);case 7:return e.prev=7,i=t.split("/"),n=this.myState.subfolder+"/"+i[0],console.log(n),e.next=13,this.myState.svnRoot.getDirectory(n);case 13:return r=e.sent,s=Ee()(r.files,i[1]),e.abrupt("return",s.map((function(e){return i[0]+"/"+e})));case 18:e.prev=18,e.t0=e["catch"](7);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,this,[[7,18]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadYaml",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r,s,o,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return",[]);case 2:return this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.folders=[],this.myState.files=[],t=[],e.prev=7,e.next=10,this.myState.svnRoot.getFileText("runs.yml");case 10:a=e.sent,t=Fe.a.parse(a),e.next=22;break;case 14:return e.prev=14,e.t0=e["catch"](7),console.log("here"),e.next=19,this.myState.svnRoot.getDirectory("");case 19:i=e.sent,console.log({contents:i}),i.dirs.length&&(t=i.dirs.map((function(e){return{folder:e}})));case 22:console.log({runs:t}),n=Object(Q["a"])(t),e.prev=24,n.s();case 26:if((r=n.n()).done){e.next=45;break}return s=r.value,o=s.folder,"".concat(this.myState.svnRoot,"/"),e.prev=30,e.next=33,this.myState.svnRoot.getFileText("".concat(o,"/metadata.yml"));case 33:l=e.sent,c=Fe.a.parse(l),c.folder=o,this.projectYaml.push(c),e.next=43;break;case 39:e.prev=39,e.t1=e["catch"](30),console.warn("no metadata for",o),this.projectYaml.push({title:o,folder:o,notes:[]});case 43:e.next=26;break;case 45:e.next=50;break;case 47:e.prev=47,e.t2=e["catch"](24),n.e(e.t2);case 50:return e.prev=50,n.f(),e.finish(50);case 53:console.log({projectYaml:this.projectYaml});case 54:case"end":return e.stop()}}),e,this,[[7,14],[24,47,50,53],[30,39]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"fetchFolderContents",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return",[]);case 2:return this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.files=[],e.prev=5,e.next=8,this.myState.svnRoot.getDirectory(this.myState.subfolder);case 8:t=e.sent,a=t.dirs.filter((function(e){return!e.startsWith(".")})).sort(),i=t.files.filter((function(e){return!e.startsWith(".")})).sort(),this.myState.errorStatus="",this.myState.folders=a,this.myState.files=i,e.next=32;break;case 16:e.prev=16,e.t0=e["catch"](5),console.log("BAD PAGE"),console.log({eeee:e.t0}),this.myState.folders=[],this.myState.files=[],this.myState.errorStatus="<h3>",e.t0.status&&(this.myState.errorStatus+="".concat(e.t0.status," ")),e.t0.statusText&&(this.myState.errorStatus+="".concat(e.t0.statusText)),"<h3>"===this.myState.errorStatus&&(this.myState.errorStatus+="Error"),this.myState.errorStatus+="</h3>",e.t0.url&&(this.myState.errorStatus+="<p>".concat(e.t0.url,"</p>")),e.t0.message&&(this.myState.errorStatus+="<p>".concat(e.t0.message,"</p>")),"<h3>Error</h3>"===this.myState.errorStatus&&(this.myState.errorStatus=""+e.t0),this.myState.svnProject&&(this.myState.errorStatus+="<p><i>".concat(this.myState.svnProject.svn,"/").concat(this.myState.subfolder,"</i></p>")),this.myState.svnProject&&this.myState.svnProject.need_password&&401===e.t0.status&&x.commit("requestLogin",this.myState.svnProject.url);case 32:return e.prev=32,this.myState.isLoading=!1,e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[5,16,32,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"openOutputFolder",value:function(e,t){if(!this.myState.isLoading&&this.myState.svnProject){var a="/"+this.myState.svnProject.url+"/"+this.myState.subfolder+"/"+e;t?window.open(a,"_blank"):this.$router.push({path:a})}}}]),a}(b["c"]);Object(p["a"])([Object(b["d"])("$route")],Ks.prototype,"updateRoute",null),Object(p["a"])([Object(b["d"])("globalState.authAttempts")],Ks.prototype,"authenticationChanged",null),Object(p["a"])([Object(b["d"])("myState.files")],Ks.prototype,"filesChanged",null),Ks=Object(p["a"])([Object(b["a"])({components:Zs,props:{}})],Ks);var Qs=Ks,eo=Qs,to=(a("e260c"),Object(E["a"])(eo,Xs,Js,!1,null,"c59d1832",null)),ao=to.exports;s["default"].use(ee["a"]);var io=[{path:"/motus-viz/",name:"Home",component:Oe},{path:"*",redirect:"/motus-viz/"}];function no(){var e,t=[],a=Object(Q["a"])(x.state.svnProjects);try{for(a.s();!(e=a.n()).done;){var i=e.value;t.push({path:"/motus-viz/"+i.url,name:i.url,component:ao}),t.push({path:"/motus-viz/"+i.url+"/*",name:"project:"+i.url,component:$s})}}catch(n){a.e(n)}finally{a.f()}return t}function ro(){var e,t=[],a=Object(Q["a"])(x.state.visualizationTypes.values());try{for(a.s();!(e=a.n()).done;){var i=e.value;t.push({path:"/motus-viz/v/"+i.kebabName+"/:project/*",name:i.kebabName,component:i.component,props:function(e){return{project:e.params.project}}})}}catch(n){a.e(n)}finally{a.f()}return t}var so=new ee["a"]({mode:"history",base:"",routes:no().concat(ro()).concat(io),scrollBehavior:function(e,t,a){return a||{x:0,y:0}}}),oo=so,lo=a("289d");s["default"].use(ja["VuePlugin"]),s["default"].use(lo["a"],{defaultIconPack:"mdi",defaultInputHasCounter:!1}),s["default"].config.productionTip=!1,new s["default"]({router:oo,store:x,render:function(e){return e(K)}}).$mount("#app")},cda0:function(e,t,a){"use strict";a("2af4")},cec5:function(e,t,a){"use strict";a("12fd")},cf49:function(e,t,a){},d1f5:function(e,t,a){"use strict";a.r(t),a.d(t,"OrbitControls",(function(){return n})),a.d(t,"MapControls",(function(){return r}));a("d3b7"),a("ddb0"),a("4c53");var i=a("5a89"),n=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new i["x"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:i["k"].PAN,MIDDLE:i["k"].DOLLY,RIGHT:i["k"].PAN},this.touches={ONE:i["s"].PAN,TWO:i["s"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(n),a.update(),l=o.NONE},this.update=function(){var t=new i["x"],r=(new i["o"]).setFromUnitVectors(e.up,new i["x"](0,1,0)),s=r.clone().inverse(),f=new i["x"],v=new i["o"];return function(){var e=a.object.position;return t.copy(e).sub(a.target),t.applyQuaternion(r),u.setFromVector3(t),a.autoRotate&&l===o.NONE&&C(w()),a.enableDamping?(u.theta+=h.theta*a.dampingFactor,u.phi+=h.phi*a.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi),u.theta=Math.max(a.minAzimuthAngle,Math.min(a.maxAzimuthAngle,u.theta)),u.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=d,u.radius=Math.max(a.minDistance,Math.min(a.maxDistance,u.radius)),!0===a.enableDamping?a.target.addScaledVector(m,a.dampingFactor):a.target.add(m),t.setFromSpherical(u),t.applyQuaternion(s),e.copy(a.target).add(t),a.object.lookAt(a.target),!0===a.enableDamping?(h.theta*=1-a.dampingFactor,h.phi*=1-a.dampingFactor,m.multiplyScalar(1-a.dampingFactor)):(h.set(0,0,0),m.set(0,0,0)),d=1,!!(p||f.distanceToSquared(a.object.position)>c||8*(1-v.dot(a.object.quaternion))>c)&&(a.dispatchEvent(n),f.copy(a.object.position),v.copy(a.object.quaternion),p=!1,!0)}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",oe,!1),a.domElement.removeEventListener("mousedown",Q,!1),a.domElement.removeEventListener("wheel",ae,!1),a.domElement.removeEventListener("touchstart",ne,!1),a.domElement.removeEventListener("touchend",se,!1),a.domElement.removeEventListener("touchmove",re,!1),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),a.domElement.removeEventListener("keydown",ie,!1)};var a=this,n={type:"change"},r={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=o.NONE,c=1e-6,u=new i["r"],h=new i["r"],d=1,m=new i["x"],p=!1,f=new i["w"],v=new i["w"],b=new i["w"],g=new i["w"],y=new i["w"],S=new i["w"],k=new i["w"],j=new i["w"],O=new i["w"];function w(){return 2*Math.PI/60/60*a.autoRotateSpeed}function x(){return Math.pow(.95,a.zoomSpeed)}function C(e){h.theta-=e}function T(e){h.phi-=e}var _=function(){var e=new i["x"];return function(t,a){e.setFromMatrixColumn(a,0),e.multiplyScalar(-t),m.add(e)}}(),R=function(){var e=new i["x"];return function(t,i){!0===a.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),m.add(e)}}(),E=function(){var e=new i["x"];return function(t,i){var n=a.domElement;if(a.object.isPerspectiveCamera){var r=a.object.position;e.copy(r).sub(a.target);var s=e.length();s*=Math.tan(a.object.fov/2*Math.PI/180),_(2*t*s/n.clientHeight,a.object.matrix),R(2*i*s/n.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(_(t*(a.object.right-a.object.left)/a.object.zoom/n.clientWidth,a.object.matrix),R(i*(a.object.top-a.object.bottom)/a.object.zoom/n.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function D(e){a.object.isPerspectiveCamera?d/=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function F(e){a.object.isPerspectiveCamera?d*=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function A(e){f.set(e.clientX,e.clientY)}function L(e){k.set(e.clientX,e.clientY)}function P(e){g.set(e.clientX,e.clientY)}function M(e){v.set(e.clientX,e.clientY),b.subVectors(v,f).multiplyScalar(a.rotateSpeed);var t=a.domElement;C(2*Math.PI*b.x/t.clientHeight),T(2*Math.PI*b.y/t.clientHeight),f.copy(v),a.update()}function z(e){j.set(e.clientX,e.clientY),O.subVectors(j,k),O.y>0?D(x()):O.y<0&&F(x()),k.copy(j),a.update()}function N(e){y.set(e.clientX,e.clientY),S.subVectors(y,g).multiplyScalar(a.panSpeed),E(S.x,S.y),g.copy(y),a.update()}function I(){}function V(e){e.deltaY<0?F(x()):e.deltaY>0&&D(x()),a.update()}function B(e){var t=!1;switch(e.keyCode){case a.keys.UP:E(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:E(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:E(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:E(-a.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),a.update())}function H(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,a)}}function q(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,a)}}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+a*a);k.set(0,i)}function U(e){a.enableZoom&&Y(e),a.enablePan&&q(e)}function G(e){a.enableZoom&&Y(e),a.enableRotate&&H(e)}function W(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,i)}b.subVectors(v,f).multiplyScalar(a.rotateSpeed);var n=a.domElement;C(2*Math.PI*b.x/n.clientHeight),T(2*Math.PI*b.y/n.clientHeight),f.copy(v)}function $(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,i)}S.subVectors(y,g).multiplyScalar(a.panSpeed),E(S.x,S.y),g.copy(y)}function X(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);j.set(0,n),O.set(0,Math.pow(j.y/k.y,a.zoomSpeed)),D(O.y),k.copy(j)}function J(e){a.enableZoom&&X(e),a.enablePan&&$(e)}function Z(e){a.enableZoom&&X(e),a.enableRotate&&W(e)}function K(){}function Q(e){if(!1!==a.enabled){var t;switch(e.preventDefault(),a.domElement.focus?a.domElement.focus():window.focus(),e.button){case 0:t=a.mouseButtons.LEFT;break;case 1:t=a.mouseButtons.MIDDLE;break;case 2:t=a.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i["k"].DOLLY:if(!1===a.enableZoom)return;L(e),l=o.DOLLY;break;case i["k"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enablePan)return;P(e),l=o.PAN}else{if(!1===a.enableRotate)return;A(e),l=o.ROTATE}break;case i["k"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enableRotate)return;A(e),l=o.ROTATE}else{if(!1===a.enablePan)return;P(e),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&(document.addEventListener("mousemove",ee,!1),document.addEventListener("mouseup",te,!1),a.dispatchEvent(r))}}function ee(e){if(!1!==a.enabled)switch(e.preventDefault(),l){case o.ROTATE:if(!1===a.enableRotate)return;M(e);break;case o.DOLLY:if(!1===a.enableZoom)return;z(e);break;case o.PAN:if(!1===a.enablePan)return;N(e);break}}function te(e){!1!==a.enabled&&(I(),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),a.dispatchEvent(s),l=o.NONE)}function ae(e){!1===a.enabled||!1===a.enableZoom||l!==o.NONE&&l!==o.ROTATE||(e.preventDefault(),e.stopPropagation(),a.dispatchEvent(r),V(e),a.dispatchEvent(s))}function ie(e){!1!==a.enabled&&!1!==a.enableKeys&&!1!==a.enablePan&&B(e)}function ne(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(a.touches.ONE){case i["s"].ROTATE:if(!1===a.enableRotate)return;H(e),l=o.TOUCH_ROTATE;break;case i["s"].PAN:if(!1===a.enablePan)return;q(e),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(a.touches.TWO){case i["s"].DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;U(e),l=o.TOUCH_DOLLY_PAN;break;case i["s"].DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;G(e),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&a.dispatchEvent(r)}}function re(e){if(!1!==a.enabled)switch(e.preventDefault(),e.stopPropagation(),l){case o.TOUCH_ROTATE:if(!1===a.enableRotate)return;W(e),a.update();break;case o.TOUCH_PAN:if(!1===a.enablePan)return;$(e),a.update();break;case o.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;J(e),a.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;Z(e),a.update();break;default:l=o.NONE}}function se(e){!1!==a.enabled&&(K(),a.dispatchEvent(s),l=o.NONE)}function oe(e){!1!==a.enabled&&e.preventDefault()}a.domElement.addEventListener("contextmenu",oe,!1),a.domElement.addEventListener("mousedown",Q,!1),a.domElement.addEventListener("wheel",ae,!1),a.domElement.addEventListener("touchstart",ne,!1),a.domElement.addEventListener("touchend",se,!1),a.domElement.addEventListener("touchmove",re,!1),a.domElement.addEventListener("keydown",ie,!1),-1===a.domElement.tabIndex&&(a.domElement.tabIndex=0),this.update()};n.prototype=Object.create(i["e"].prototype),n.prototype.constructor=n;var r=function(e,t){n.call(this,e,t),this.mouseButtons.LEFT=i["k"].PAN,this.mouseButtons.RIGHT=i["k"].ROTATE,this.touches.ONE=i["s"].PAN,this.touches.TWO=i["s"].DOLLY_ROTATE};r.prototype=Object.create(i["e"].prototype),r.prototype.constructor=r},d429:function(e,t,a){},d469:function(e,t,a){"use strict";a("d6f3")},d6f3:function(e,t,a){},da6a:function(e,t,a){"use strict";a("7995")},e046:function(e,t,a){e.exports=a.p+"img/vsp-logo-left.5106857d.png"},e0fd:function(e,t,a){"use strict";a("64f3")},e260c:function(e,t,a){"use strict";a("39e4")},e6e2:function(e,t,a){},e9b2:function(e,t,a){"use strict";a.r(t),t["default"]="// vertex shader: agent positions\n\nuniform float simulationTime;\nuniform float showSusceptible;\n\nattribute vec3 position2;  // x,y,t\n\n// this gets passed from vertex to fragment shader\nvarying float skip;\nvarying float atRest;\n\nfloat calculateSize() {\n\n    float small = 2.0;\n    float med = 5.0;\n    float big = 8.0;\n\n    // if (myInfectionStatus == 0.0) return small;\n    // else if (myInfectionStatus == 1.0) return big;\n    // else if (myInfectionStatus < 6.0) return med;\n\n    return med;\n}\n\nfloat calculateTimestep(in vec3 point1, in vec3 point2) {\n\n    atRest = 0.0;\n\n    if (point1 == point2) {\n        atRest = 1.0;\n        return 0.0;\n    }\n\n    // position vars have time in the .z to save some space\n    if (simulationTime < position.z) return 0.0;\n    if (simulationTime > position2.z) return 1.0;\n\n    float progress = simulationTime - position.z;\n    float duration = position2.z - position.z;\n\n    return progress / duration;\n}\n\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n\n    if (timestepFraction == 0.0) {\n\n        return point1;\n\n    } else if (timestepFraction >= 1.0 ) {\n\n        return point2;\n\n    } else {\n\n        vec3 direction = point2 - point1;\n\n        return (direction * timestepFraction) + point1;\n    }\n}\n\n\nvoid main() {\n\n    // don't do anything if this trip is currently out of time bounds\n    if (simulationTime < position.z || simulationTime > position2.z) {\n        gl_PointSize = 0.0;\n        gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n        skip = 1.0;\n        return;\n\n    } else {\n\n        // figure out z-index based on whether it is moving\n        float zIndex = atRest == 1.0 ? 0.2 : 0.3;\n\n        // unpack coords from position buffers - x,y,time. Deal w/ z later\n        vec3 point1 = vec3(position.xy, zIndex);\n        vec3 point2 = vec3(position2.xy, zIndex);\n\n        float timestepFraction = calculateTimestep(point1, point2);\n\n        vec3 newPosition = interpolate(point1, point2, timestepFraction);\n\n        gl_PointSize = calculateSize();\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n\n        skip = 0.0;\n   }\n}\n"},ec6c:function(e,t,a){"use strict";a("55b3")},ee8b:function(e,t){},ef1a:function(e,t,a){},f759:function(e,t,a){},f863:function(e,t,a){"use strict";a.r(t),t["default"]='#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceSizes;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\n// attribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nuniform float currentTime;\n\nuniform vec2 iconStillOffsets;\n// uniform float iconStillColorModes;\nuniform vec4 iconStillFrames;\n\nattribute float instanceTimestamps;\nattribute float instanceTimestampsNext;\nattribute vec2 instanceStartPositions;\nattribute vec2 instanceEndPositions;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\nvarying float vPercentComplete;\n\nvec2 rotate_by_angle(vec2 vertex, float angle_radian) {\n  // float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n    if (timestepFraction <= 0.0) {\n        return point1;\n    } else if (timestepFraction >= 1.0 ) {\n        return point2;\n    } else {\n        vec3 direction = point2 - point1;\n        return point1 + (direction * timestepFraction);\n    }\n}\n\nvoid main(void) {\n\n  // Calculate progress\n  // (skip everything else if this vertex is outside the time window)\n\n  if (currentTime < instanceTimestamps) {\n    vPercentComplete = -1.0;\n    return;\n\n  } else if (currentTime > instanceTimestampsNext) {\n    vPercentComplete = -1.0;\n    return;\n\n  } else {\n    vPercentComplete = (currentTime - instanceTimestamps) /\n                       (instanceTimestampsNext - instanceTimestamps);\n  }\n\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 startPosition = vec3(instanceStartPositions, 5.0);\n  vec3 endPosition = vec3(instanceEndPositions, 5.0);\n\n  // are we stationary/still\n  bool still = (instanceStartPositions == instanceEndPositions);\n\n  vec2 iconSize = still ? iconStillFrames.zw : instanceIconFrames.zw;\n  // convert size in meters to pixels, then scaled and clamp\n  // project meters to pixels and clamp to limits\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n\n  // figure out angle\n  float angle = 0.0;\n  if (!still) {\n    vec3 point1 = project_position_to_clipspace(startPosition, vec3(0.0), vec3(0.0)).xyz;\n    vec3 point2 = project_position_to_clipspace(endPosition, vec3(0.0), vec3(0.0)).xyz;\n    vec3 direction = normalize(point2 - point1);\n    angle = atan( direction.y / direction.x);\n    if (direction.x < 0.0) angle = angle - PI;\n  }\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + (still ? iconStillOffsets : instanceOffsets);\n  pixelOffset = rotate_by_angle(pixelOffset, angle) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  vec3 newPosition = interpolate(\n    startPosition,\n    endPosition,\n    vPercentComplete);\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), vec3(0.0));\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(newPosition, offset_common, vec3(0.0));\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec2 upperleft = (still ? iconStillFrames.xy : instanceIconFrames.xy);\n\n  vTextureCoords = mix(\n    upperleft,\n    upperleft + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = still ?  0.0 : 1.0;\n}\n'},fc60:function(e,t,a){"use strict";a("1bf3")},fe05:function(e,t,a){"use strict";a("553b")}});